#!/usr/bin/env python3
# Script para crear archivos en RunPod
import base64
from pathlib import Path

# detector.py
print('ðŸ“¤ Creando detector.py...')
data_chunks = [
    '''IiIiClNBTSAzIE9iamVjdCBEZXRlY3RvcgpEZXRlY3RzIGFsbCBvYmplY3RzIGluIGFuIGltYWdlIHVzaW5nIFNlZ21lbnQgQW55dGhpbmcgTW9kZWwgMy4KVXNlcyB0ZXh0IHByb21wdHMgZm9yIGNvbmNlcHQtYmFzZWQgZGV0ZWN0aW9uLgpNYXggMzUwIGxpbmVzLgoiIiIKaW1wb3J0IHRvcmNoCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgY3YyCmltcG9ydCBsb2dnaW5nCmltcG9ydCBwbGF0Zm9ybQpmcm9tIHR5cGluZyBpbXBvcnQgTGlzdCwgRGljdCwgQW55LCBUdXBsZSwgT3B0aW9uYWwKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gUElMIGltcG9ydCBJbWFnZQoKdHJ5OgogICAgZnJvbSBzYW0zLm1vZGVsX2J1aWxkZXIgaW1wb3J0IGJ1aWxkX3NhbTNfaW1hZ2VfbW9kZWwKICAgIGZyb20gc2FtMy5tb2RlbC5zYW0zX2ltYWdlX3Byb2Nlc3NvciBpbXBvcnQgU2FtM1Byb2Nlc3NvcgogICAgU0FNM19BVkFJTEFCTEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIFNBTTNfQVZBSUxBQkxFID0gRmFsc2UKICAgIGxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQogICAgbG9nZ2VyLmVycm9yKCJTQU0gMyBub3QgaW5zdGFsbGVkLiBJbnN0YWxsIHdpdGg6IHBpcCBpbnN0YWxsIC1lIGdpdCtodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2tyZXNlYXJjaC9zYW0zLmdpdCIpCgpsb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCgpkZWYgZW5oYW5jZV9mb3JfZGV0ZWN0aW9uKGltYWdlOiBucC5uZGFycmF5KSAtPiBucC5uZGFycmF5OgogICAgIiIiRW5oYW5jZSBpbWFnZSB3aXRoIENMQUhFIGZvciBiZXR0ZXIgZGV0ZWN0aW9uIG9mIGRhcmsgb2JqZWN0cy4iIiIKICAgIGxhYiA9IGN2Mi5jdnRDb2xvcihpbWFnZSwgY3YyLkNPTE9SX0JHUjJMQUIpCiAgICBsLCBhLCBiID0gY3YyLnNwbGl0KGxhYikKICAgIGNsYWhlID0gY3YyLmNyZWF0ZUNMQUhFKGNsaXBMaW1pdD0yLjAsIHRpbGVHcmlkU2l6ZT0oOCwgOCkpCiAgICBsX2VuaGFuY2VkID0gY2xhaGUuYXBwbHkobCkKICAgIHJldHVybiBjdjIuY3Z0Q29sb3IoY3YyLm1lcmdlKFtsX2VuaGFuY2VkLCBhLCBiXSksIGN2Mi5DT0xPUl9MQUIyQkdSKQoKCmNsYXNzIFNBTTNEZXRlY3RvcjoKICAgICIiIkRldGVjdHMgb2JqZWN0cyB1c2luZyBTQU0gMyB3aXRoIGNvbmNlcHQtYmFzZWQgc2VnbWVudGF0aW9uLiIiIgogICAgCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBkZXZpY2U6IHN0ciA9ICJtcHMiLAogICAgICAgICoqa3dhcmdzCiAgICApOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgU0FNIDMgZGV0ZWN0b3IuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZGV2aWNlOiBEZXZpY2UgdG8gcnVuIG9uIChtcHMsIGN1ZGEsIGNwdSkKICAgICAgICAgICAgKiprd2FyZ3M6IEFkZGl0aW9uYWwgcGFyYW1ldGVycyAoZm9yIGNvbXBhdGliaWxpdHkpCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IFNBTTNfQVZBSUxBQkxFOgogICAgICAgICAgICByYWlzZSBJbXBvcnRFcnJvcigKICAgICAgICAgICAgICAgICJTQU0gMyBub3QgYXZhaWxhYmxlLiBJbnN0YWxsIHdpdGg6XG4iCiAgICAgICAgICAgICAgICAiICBnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rcmVzZWFyY2gvc2FtMy5naXRcbiIKICAgICAgICAgICAgICAgICIgIGNkIHNhbTMgJiYgcGlwIGluc3RhbGwgLWUgLlxuIgogICAgICAgICAgICAgICAgIiAgIyBSZXF1ZXN0IGFjY2VzcyB0byBjaGVja3BvaW50cyBhdCBTQU0gMyBIdWdnaW5nRmFjZSByZXBvIgogICAgICAgICAgICApCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIkxvYWRpbmcgU0FNIDMuLi4iKQogICAgICAgIAogICAgICAgICMgRGV0ZWN0IGRldmljZSAoTVBTIG9ubHkgZm9yIEFwcGxlIFNpbGljb24gTWFjcywgQ1VEQSBmb3IgTlZJRElBLCBDUFUgb3RoZXJ3aXNlKQogICAgICAgICMgQ1JJVElDQUw6IEludGVsIE1hY3MgKHByZS0yMDIwKSBkbyBOT1QgaGF2ZSBNUFMsIG11c3QgdXNlIENQVQogICAgICAgIGlzX2FwcGxlX3NpbGljb24gPSBwbGF0Zm9ybS5wcm9jZXNzb3IoKSA9PSAnYXJtJyBvciAnYXJtNjQnIGluIHBsYXRmb3JtLm1hY2hpbmUoKS5sb3dlcigpCiAgICAgICAgCiAgICAgICAgaWYgZGV2aWNlID09ICJtcHMiIGFuZCB0b3JjaC5iYWNrZW5kcy5tcHMuaXNfYXZhaWxhYmxlKCkgYW5kIGlzX2FwcGxlX3NpbGljb246CiAgICAgICAgICAgIGFjdHVhbF9kZXZpY2UgPSAibXBzIgogICAgICAgICAgICBsb2dnZXIuaW5mbygi4pyFIFVzaW5nIE1QUyAoQXBwbGUgU2lsaWNvbiBHUFUpIikKICAgICAgICBlbGlmIGRldmljZSA9PSAiY3VkYSIgYW5kIHRvcmNoLmN1ZGEuaXNfYXZhaWxhYmxlKCk6CiAgICAgICAgICAgIGFjdHVhbF9kZXZpY2UgPSAiY3VkYSIKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIuKchSBVc2luZyBDVURBIChOVklESUEgR1BVKSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWN0dWFsX2RldmljZSA9ICJjcHUiCiAgICAgICAgICAgIGlmIGRldmljZSAhPSAiY3B1IjoKICAgICAgICAgICAgICAgIGlmIGRldmljZSA9PSAibXBzIjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyAgTVBTIHJlcXVlc3RlZCBidXQgbm90IGF2YWlsYWJsZSAoSW50ZWwgTWFjIGRldGVjdGVkKSIpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgICBJbnRlbCBNYWNzIChwcmUtMjAyMCkgZG8gbm90IGhhdmUgTVBTLCB1c2luZyBDUFUgaW5zdGVhZCIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYi4pqg77iPICBSZXF1ZXN0ZWQgZGV2aWNlICd7ZGV2aWNlfScgbm90IGF2YWlsYWJsZSwgdXNpbmcgJ2NwdSciKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBVc2luZyBDUFUgKEludGVsIE1hYyBvciBubyBHUFUgYXZhaWxhYmxlKSIpCiAgICAgICAgCiAgICAgICAgIyBCdWlsZCBTQU0gMyBtb2RlbCAoY2hlY2twb2ludHMgZG93bmxvYWRlZCBhdXRvbWF0aWNhbGx5IGZyb20gSHVnZ2luZ0ZhY2UpCiAgICAgICAgc2VsZi5tb2RlbCA9IGJ1aWxkX3NhbTNfaW1hZ2VfbW9kZWwoKQogICAgICAgIAogICAgICAgICMgTW92ZSBtb2RlbCB0byBkZXZpY2UgKHVzZSAudG8oKSB3aXRoIHByb3BlciBkZXZpY2Ugc3RyaW5nKQogICAgICAgIGRldmljZV9vYmogPSB0b3JjaC5kZXZpY2UoYWN0dWFsX2RldmljZSkKICAgICAgICBzZWxmLm1vZGVsID0gc2VsZi5tb2RlbC50byhkZXZpY2Vfb2JqKQogICAgICAgIAogICAgICAgICMgRW5zdXJlIGFsbCBwYXJhbWV0ZXJzIGFuZCBidWZmZXJzIGFyZSBvbiB0aGUgY29ycmVjdCBkZXZpY2UKICAgICAgICBmb3IgcGFyYW0gaW4gc2VsZi5tb2RlbC5wYXJhbWV0ZXJzKCk6CiAgICAgICAgICAgIGlmIHBhcmFtLmRldmljZSAhPSBkZXZpY2Vfb2JqOgogICAgICAgICAgICAgICAgcGFyYW0uZGF0YSA9IHBhcmFtLmRhdGEudG8oZGV2aWNlX29iaikKICAgICAgICBmb3IgYnVmZmVyIGluIHNlbGYubW9kZWwuYnVmZmVycygpOgogICAgICAgICAgICBpZiBidWZmZXIuZGV2aWNlICE9IGRldmljZV9vYmo6CiAgICAgICAgICAgICAgICBidWZmZXIuZGF0YSA9IGJ1ZmZlci5kYXRhLnRvKGRldmljZV9vYmopCiAgICAgICAgCiAgICAgICAgIyBJbml0aWFsaXplIHByb2Nlc3NvciB3aXRoIE1JTklNVU0gY29uZmlkZW5jZSB0aHJlc2hvbGQgZm9yIE1BWElNVU0gZGV0ZWN0aW9uCiAgICAgICAgIyBGSUxPU09Gw41BOiAiRGV0ZWN0YXIgVE9ETywgZmlsdHJhciBkZXNwdcOpcyBjb24gQ2xhdWRlIgogICAgICAgICMgRGVmYXVsdCBpcyAwLjUsIGJ1dCB3ZSB1c2UgMC4wMDEgdG8gY2F0Y2ggRVZFUllUSElORyAoc21hbGwgb2JqZWN0cywgc2hhZG93cywgcmVmbGVjdGlvbnMsIGZyYWdtZW50cykKICAgICAgICAjIENsYXVkZSB3aWxsIGZpbHRlciBpbnRlbGxpZ2VudGx5IC0gd2Ugd2FudCBtYXhpbXVtIHJhdyBkZXRlY3Rpb25zCiAgICAgICAgIyBQb3N0LWZpbHRlcmluZyBpbiBjb25maWcueWFtbCBpcyBtaW5pbWFsLCBDbGF1ZGUgZG9lcyB0aGUgaW50ZWxsaWdlbnQgZmlsdGVyaW5nCiAgICAgICAgc2VsZi5wcm9jZXNzb3IgPSBTYW0zUHJvY2Vzc29yKAogICAgICAgICAgICBzZWxmLm1vZGVsLCAKICAgICAgICAgICAgZGV2aWNlPWFjdHVhbF9kZXZpY2UsCiAgICAgICAgICAgIGNvbmZpZGVuY2VfdGhyZXNob2xkPTAuMDAxICAjIE3DgVhJTUEgREVURUNDScOTTjogRGV0ZWN0YSBUT0RPIChvYmpldG9zLCBzb21icmFzLCByZWZsZWpvcywgZnJhZ21lbnRvcykKICAgICAgICApCiAgICAgICAgc2VsZi5kZXZpY2UgPSBhY3R1YWxfZGV2aWNlCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUgU0FNIDMgbG9hZGVkIG9uIHthY3R1YWxfZGV2aWNlfSIpCiAgICAKICAgIGRlZiBkZXRlY3Rfb2JqZWN0cygKICAgICAgICBzZWxmLCAKICAgICAgICBpbWFnZTogbnAubmRhcnJheSwKICAgICAgICBhcHBseV9maWx0ZXJpbmc6IGJvb2wgPSBGYWxzZSwKICAgICAgICBlbmhhbmNlX2ltYWdlOiBib29sID0gRmFsc2UsCiAgICAgICAgbWluX2FyZWE6IE9wdGlvbmFsW2ludF0gPSBOb25lLAogICAgICAgIG1heF9hcmVhX3JhdGlvOiBPcHRpb25hbFtmbG9hdF0gPSBOb25lLAogICAgICAgIG1pbl9hc3BlY3RfcmF0aW86IE9wdGlvbmFsW2Zsb2F0XSA9IE5vbmUsCiAgICAgICAgbWF4X2FzcGVjdF9yYXRpbzogT3B0aW9uYWxbZmxvYXRdID0gTm9uZSwKICAgICAgICBubXNfaW91X3RocmVzaG9sZDogT3B0aW9uYWxbZmxvYXRdID0gTm9uZSwKICAgICAgICB0ZXh0X3Byb21wdDogT3B0aW9uYWxbc3RyXSA9IE5vbmUKICAgICkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgRGV0ZWN0IG9iamVjdHMgdXNpbmcgU0FNIDMuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgaW1hZ2U6IEJHUiBpbWFnZQogICAgICAgICAgICBhcHBseV9maWx0ZXJpbmc6IEFwcGx5IHNtYXJ0IGZpbHRlcmluZwogICAgICAgICAgICBlbmhhbmNlX2ltYWdlOiBBcHBseSBDTEFIRSBlbmhhbmNlbWVudAogICAgICAgICAgICB0ZXh0X3Byb21wdDogT3B0aW9uYWwgdGV4dCBwcm9tcHQgZm9yIGNvbmNlcHQtYmFzZWQgZGV0ZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChlLmcuLCAiYmFnIiwgInNob2VzIiwgImVsZWN0cm9uaWNzIikKICAgICAgICAgICAgICAgICAgICAgICAgSWYgTm9uZSwgdXNlcyBhdXRvbWF0aWMgZGV0ZWN0aW9uCiAgICAgICAgIiIiCiAgICAgICAgIyBDUklUSUNBTDogUmVzaXplIGxhcmdlIGltYWdlcyBCRUZPUkUgcHJvY2Vzc2luZyB0byBwcmV2ZW50IE1QUyBvdXQgb2YgbWVtb3J5CiAgICAgICAgIyBTQU0gMyBpbnRlcm5hbGx5IHJlc2l6ZXMgdG8gMTAwOHgxMDA4LCBidXQgbG9hZGluZyBmdWxsIDRLIGludG8gTVBTIGZpcnN0IGNhdXNlcyBPT00KICAgICAgICAjIFN0b3JlIG9yaWdpbmFsIGltYWdlIGRpbWVuc2lvbnMgZm9yIGJib3ggc2NhbGluZwogICAgICAgIG9yaWdpbmFsX3NoYXBlID0gaW1hZ2Uuc2hhcGVbOjJdICAjIChoZWlnaHQsIHdpZHRoKQogICAgICAgIG9yaWdpbmFsX2gsIG9yaWdpbmFsX3cgPSBvcmlnaW5hbF9zaGFwZQogICAgICAgIAogICAgICAgICMgQ1JJVElDQUw6IE1QUyBoYXMgbGltaXRlZCBtZW1vcnkgKDYuOCBHQiBtYXgpLCBTQU0gMyBuZWVkcyB+NS41IEdCIGp1c3QgZm9yIG1vZGVsCiAgICAgICAgIyBXZSBuZWVkIHRvIHByb2Nlc3MgYXQgbXVjaCBzbWFsbGVyIHJlc29sdXRpb24gdG8gcHJldmVudCBPT00KICAgICAgICAjIFNBTSAzIHByb2Nlc3NvciBkZWZhdWx0IGlzIDEwMDh4MTAwOCwgYnV0IGV2ZW4gdGhhdCBjYXVzZXMgT09NIG9uIE1QUwogICAgICAgICMgVXNlIDcyMHAgKDEyODB4NzIwKSB3aGljaCBpcyBlbm91Z2ggZm9yIGRldGVjdGlvbiBidXQgdXNlcyBsZXNzIG1lbW9yeQogICAgICAgIG1heF9zYW0zX2RpbWVuc2lvbiA9IDcyMCAgIyBSZWR1Y2VkIGZyb20gMTAwOCB0byBwcmV2ZW50IE1QUyBPT00KICAgICAgICBtYXhfZGltZW5zaW9uID0gbWF4KG9yaWdpbmFsX2gsIG9yaWdpbmFsX3cpCiAgICAgICAgc2NhbGUgPSAxLjAgICMgSW5pdGlhbGl6ZSBzY2FsZSAobm8gcmVzaXppbmcgYnkgZGVmYXVsdCkKICAgICAgICAKICAgICAgICAjIEFsd2F5cyByZXNpemUgbGFyZ2UgaW1hZ2VzICg0SykgdG8gNzIwcCBmb3IgU0FNIDMgcHJvY2Vzc2luZwogICAgICAgIGlmIG1heF9kaW1lbnNpb24gPiBtYXhfc2FtM19kaW1lbnNpb246CiAgICAgICAgICAgICMgQ2FsY3VsYXRlIHNjYWxlIHRvIGZpdCB3aXRoaW4gbWF4X3NhbTNfZGltZW5zaW9uIHdoaWxlIG1haW50YWluaW5nIGFzcGVjdCByYXRpbwogICAgICAgICAgICBzY2FsZSA9IG1heF9zYW0zX2RpbWVuc2lvbiAvIG1heF9kaW1lbnNpb24KICAgICAgICAgICAgbmV3X3cgPSBpbnQob3JpZ2luYWxfdyAqIHNjYWxlKQogICAgICAgICAgICBuZXdfaCA9IGludChvcmlnaW5hbF9oICogc2NhbGUpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlJlc2l6aW5nIGltYWdlIGZvciBTQU0gMzoge29yaWdpbmFsX3d9eHtvcmlnaW5hbF9ofSDihpIge25ld193fXh7bmV3X2h9IChzY2FsZToge3NjYWxlOi4yZn0pIikKICAgICAgICAgICAgaWYgb3JpZ2luYWxfdyA+PSAzODQwIG9yIG9yaWdpbmFsX2ggPj0gMjE2MDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiICDinIUgT3JpZ2luYWwgaXMgNEsgKHtvcmlnaW5hbF93fXh7b3JpZ2luYWxfaH0pIC0gQ3JvcHMgd2lsbCBiZSBleHRyYWN0ZWQgZnJvbSA0SyBmb3IgbWF4aW11bSBxdWFsaXR5IikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgIChTQU0gMyBwcm9jZXNzZXMgYXQgNzIwcCB0byBwcmV2ZW50IE9PTSwgYnV0IGNyb3BzIHVzZSBvcmlnaW5hbCB7b3JpZ2luYWxfd314e29yaWdpbmFsX2h9IHJlc29sdXRpb24pIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVzaXplIGltYWdlIGJlZm9yZSBlbmhhbmNlbWVudCAoZmFzdGVyLCBiZXR0ZXIgbWVtb3J5IHVzYWdlKQogICAgICAgICAgICBpbWFnZV9yZXNpemVkID0gY3YyLnJlc2l6ZShpbWFnZSwgKG5ld193LCBuZXdfaCksIGludGVycG9sYXRpb249Y3YyLklOVEVSX0FSRUEpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaW1hZ2VfcmVzaXplZCA9IGltYWdlCiAgICAgICAgCiAgICAgICAgaWYgZW5oYW5jZV9pbWFnZToKICAgICAgICAgICAgaW1hZ2VfcmVzaXplZCA9IGVuaGFuY2VfZm9yX2RldGVjdGlvbihpbWFnZV9yZXNpemVkKQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkFwcGxpZWQgQ0xBSEUgZW5oYW5jZW1lbnQiKQogICAgICAgIAogICAgICAgICMgQ29udmVydCBCR1IgdG8gUkdCIGFuZCBQSUwgSW1hZ2UKICAgICAgICByZ2IgPSBjdjIuY3Z0Q29sb3IoaW1hZ2VfcmVzaXplZCwgY3YyLkNPTE9SX0JHUjJSR0IpCiAgICAgICAgcGlsX2ltYWdlID0gSW1hZ2UuZnJvbWFycmF5KHJnYikKICAgICAgICAKICAgICAgICAjIFNldCBpbWFnZSBpbiBwcm9jZXNzb3IKICAgICAgICBsb2dnZXIuaW5mbygiUnVubmluZyBTQU0gMyBkZXRlY3Rpb24uLi4iKQogICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkltYWdlIHNpemU6IHtwaWxfaW1hZ2Uuc2l6ZX0sIG1vZGU6IHtwaWxfaW1hZ2UubW9kZX0iKQogICAgICAgIAogICAgICAgIGluZmVyZW5jZV9zdGF0ZSA9IHNlbGYucHJvY2Vzc29yLnNldF9pbWFnZShwaWxfaW1hZ2UpCiAgICAgICAgCiAgICAgICAgIyBGSUxPU09Gw41BOiAiRGV0ZWN0YXIgVE9ETywgZmlsdHJhciBkZXNwdcOpcyBjb24gQ2xhdWRlIgogICAgICAgICMgVXNhciBtw7psdGlwbGVzIHByb21wdHMgcGFyYSBtw6F4aW1hIGNvYmVydHVyYSAob2JqZXRvcywgY29udGVuZWRvcmVzLCBmb3JtYXMsIGV0Yy4pCiAgICAgICAgYWxsX2RldGVjdGlvbnMgPSBbXQogICAgICAgIAogICAgICAgIGlmIHRleHRfcHJvbXB0OgogICAgICAgICAgICAjIFVzYXIgcHJvbXB0IGVzcGVjw61maWNvIHNpIHNlIHByb3BvcmNpb25hCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiVXNpbmcgdGV4dCBwcm9tcHQ6ICd7dGV4dF9wcm9tcHR9JyIpCiAgICAgICAgICAgIG91dHB1dCA9IHNlbGYucHJvY2Vzc29yLnNldF90ZXh0X3Byb21wdChzdGF0ZT1pbmZlcmVuY2Vfc3RhdGUsIHByb21wdD10ZXh0X3Byb21wdCkKICAgICAgICAgICAgYWxsX2RldGVjdGlvbnMuYXBwZW5kKG91dHB1dCkKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIE9QVElNSVpBQ0nDk046IEFqdXN0YXIgbsO6bWVybyBkZSBwcm9tcHRzIHNlZ8O6biBkaXNwb3NpdGl2bwogICAgICAgICAgICAjIENQVSAoSW50ZWwgTWFjKSA9IG3DoXMgbGVudG8sIHVzYXIgbWVub3MgcHJvbXB0cyBwYXJhIHZlbG9jaWRhZAogICAgICAgICAgICAjIE1QUy9DVURBID0gbcOhcyByw6FwaWRvLCB1c2FyIG3DoXMgcHJvbXB0cyBwYXJhIG3DoXhpbWEgZGV0ZWNjacOzbgogICAgICAgICAgICBpZiBzZWxmLmRldmljZSA9PSAiY3B1IjoKICAgICAgICAgICAgICAgICMgQ1BVOiB1c2FyIHNvbG8gMS0yIHByb21wdHMgKG3DoXMgcsOhcGlkbykKICAgICAgICAgICAgICAgIHByb21wdHMgPSBbCiAgICAgICAgICAgICAgICAgICAgInZpc3VhbCIsICAjIERldGVjY2nDs24gZ2VuZXJhbCAob2JqZXRvcyB2aXN1YWxlcykgLSBzdWZpY2llbnRlIGVuIENQVQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5SNIE9QVElNSVpFRCBNT0RFIChDUFUpOiBVc2luZyB7bGVuKHByb21wdHMpfSBwcm9tcHQgZm9yIHNwZWVkIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgTVBTL0NVREE6IHVzYXIgbcO6bHRpcGxlcyBwcm9tcHRzIChtw6F4aW1hIGRldGVjY2nDs24pCiAgICAgICAgICAgIHByb21wdHMgPSBbCiAgICAgICAgICAgICAgICAidmlzdWFsIiwgICAgICAjIERldGVjY2nDs24gZ2VuZXJhbCAob2JqZXRvcyB2aXN1YWxlcykKICAgICAgICAgICAgICAgICJjb250YWluZXIiLCAgICMgQ29udGVuZWRvcmVzLCBmcmFzY29zLCBib3RlbGxhcywgY2FqYXMKICAgICAgICAgICAgICAgICJvYmplY3QiLCAgICAgICMgT2JqZXRvcyBnZW7DqXJpY29zCiAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi8J+UjSBNQVhJTVVNIERFVEVDVElPTiBNT0RFICh7c2VsZi5kZXZpY2UudXBwZXIoKX0pOiBVc2luZyB7bGVuKHByb21wdHMpfSBwcm9tcHRzIHRvIGRldGVjdCBFVkVSWVRISU5HIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBwcm9tcHQgaW4gcHJvbXB0czoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBzZWxmLnByb2Nlc3Nvci5zZXRfdGV4dF9wcm9tcHQoc3RhdGU9aW5mZXJlbmNlX3N0YXRlLCBwcm9tcHQ9cHJvbXB0KQogICAgICAgICAgICAgICAgICAgIGlmIG91dHB1dCBhbmQgb3V0cHV0LmdldCgiYm94ZXMiKSBpcyBub3QgTm9uZSBhbmQgbGVuKG91dHB1dC5nZXQoImJveGVzIiwgW10pKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGFsbF9kZXRlY3Rpb25zLmFwcGVuZChvdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIiAgIFByb21wdCAne3Byb21wdH0nOiB7bGVuKG91dHB1dC5nZXQoJ2JveGVzJywgW10pKX0gb2JqZWN0cyIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgICBQcm9tcHQgJ3twcm9tcHR9JyBmYWlsZWQ6IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAKICAgICAgICAjIENvbWJpbmFyIHRvZGFzIGxhcyBkZXRlY2Npb25lcwogICAgICAgIGFsbF9tYXNrcyA9IFtdCiAgICAgICAgYWxsX2JveGVzID0gW10KICAgICAgICBhbGxfc2NvcmVzID0gW10KICAgICAgICAKICAgICAgICBmb3Igb3V0cHV0IGluIGFsbF9kZXRlY3Rpb25zOgogICAgICAgICAgICBtYXNrcyA9IG91dHB1dC5nZXQoIm1hc2tzIikKICAgICAgICAgICAgYm94ZXMgPSBvdXRwdXQuZ2V0KCJib3hlcyIpCiAgICAgICAgICAgIHNjb3JlcyA9IG91dHB1dC5nZXQoInNjb3JlcyIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBtYXNrcyBpcyBub3QgTm9uZSBhbmQgYm94ZXMgaXMgbm90IE5vbmUgYW5kIHNjb3JlcyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGFsbF9tYXNrcy5hcHBlbmQobWFza3MpCiAgICAgICAgICAgICAgICBhbGxfYm94ZXMuYXBwZW5kKGJveGVzKQogICAgICAgICAgICAgICAgYWxsX3Njb3Jlcy5hcHBlbmQoc2NvcmVzKQogICAgICAgIAogICAgICAgIGlmIG5vdCBhbGxfbWFza3M6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCLimqDvuI8gIE5vIGRldGVjdGlvbnMgZnJvbSBhbnkgcHJvbXB0IikKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgCiAgICAgICAgIyBDb25jYXRlbmFyIHRvZGFzIGxhcyBkZXRlY2Npb25lcwogICAgICAgIG1hc2tzID0gdG9yY2guY2F0KGFsbF9tYXNrcywgZGltPTApIGlmIGxlbihhbGxfbWFza3MpID4gMSBlbHNlIGFsbF9tYXNrc1swXQogICAgICAgIGJveGVzID0gdG9yY2guY2F0KGFsbF9ib3hlcywgZGltPTApIGlmIGxlbihhbGxfYm94ZXMpID4gMSBlbHNlIGFsbF9ib3hlc1swXQogICAgICAgIHNjb3JlcyA9IHRvcmNoLmNhdChhbGxfc2NvcmVzLCBkaW09MCkgaWYgbGVuKGFsbF9zY29yZXMpID4gMSBlbHNlIGFsbF9zY29yZXNbMF0KICAgICAgICAKICAgICAgICBudW1fb2JqZWN0cyA9IGxlbihib3hlcykKICAgICAgICBsb2dnZXIuaW5mbyhmIvCflI0gU0FNIDMgbXVsdGktcHJvbXB0IGRldGVjdGlvbjoge251bV9vYmplY3RzfSB0b3RhbCBvYmplY3RzIChjb21iaW5lZCBmcm9tIHtsZW4oYWxsX2RldGVjdGlvbnMpfSBwcm9tcHRzKSIpCiAgICAgICAgCiAgICAgICAgaWYgbnVtX29iamVjdHMgPT0gMDoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIuKaoO+4jyAgU0FNIDMgcmV0dXJuZWQgMCBvYmplY3RzLiBUaGlzIG1heSBpbmRpY2F0ZToiKQogICAgICAgICAgICBsb2dnZXIud2FybmluZygiICAgLSBJbWFnZSBxdWFsaXR5IHRvbyBsb3ciKQogICAgICAgICAgICBsb2dnZXIud2FybmluZygiICAgLSBObyBvYmplY3RzIHZpc2libGUgaW4gc2NlbmUiKQogICAgICAgICAgICBsb2dnZXIud2FybmluZygiICAgLSBDb25maWRlbmNlIHRocmVzaG9sZCB0b28gaGlnaCIpCiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgIAogICAgICAgICMgT1BUSU1JWkFDScOTTjogTGltaXRhciBvYmpldG9zIGluaWNpYWxlcyBlbiBDUFUgcGFyYSB2ZWxvY2lkYWQKICAgICAgICAjIENQVSBlcyBsZW50byBwcm9jZXNhbmRvIG3DoXNjYXJhcywgbGltaXRhciBhIHRvcCA1MDAgcG9yIHNjb3JlIGFudGVzIGRlIHByb2Nlc2FyCiAgICAgICAgaWYgc2VsZi5kZXZpY2UgPT0gImNwdSIgYW5kIG51bV9vYmplY3RzID4gNTAwOgogICAgICAgICAgICAjIE9yZGVuYXIgcG9yIHNjb3JlIHkgdG9tYXIgdG9wIDUwMAogICAgICAgICAgICBzb3J0ZWRfaW5kaWNlcyA9IHRvcmNoLmFyZ3NvcnQoc2NvcmVzLCBkZXNjZW5kaW5nPVRydWUpWzo1MDBdCiAgICAgICAgICAgIG1hc2tzID0gbWFza3Nbc29ydGVkX2luZGljZXNdCiAgICAgICAgICAgIGJveGVzID0gYm94ZXNbc29ydGVkX2luZGljZXNdCiAgICAgICAgICAgIHNjb3JlcyA9IHNjb3Jlc1tzb3J0ZWRfaW5kaWNlc10KICAgICAgICAgICAgbnVtX29iamVjdHMgPSA1MDAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLimqEgT1BUSU1JWkFDScOTTiAoQ1BVKTogTGltaXRhbmRvIGEgdG9wIDUwMCBvYmpldG9zIHBvciBzY29yZSBwYXJhIHZlbG9jaWRhZCIpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmRlYnVnKGYiUHJvY2Vzc2luZyB7bnVtX29iamVjdHN9IG9iamVjdHMuLi4iKQogICAgICAgIAogICAgICAgICMgQ29udmVydCB0byBvdXIgZm9ybWF0CiAgICAgICAgZGV0ZWN0aW9ucyA9IFtdCiAgICAgICAgCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UobnVtX29iamVjdHMpOgogICAgICAgICAgICAjIEV4dHJhY3QgbWFzayAocmVtb3ZlIGJhdGNoIGFuZCBjaGFubmVsIGRpbWVuc2lvbnMpCiAgICAgICAgICAgIG1hc2sgPSBtYXNrc1tpLCAwXSAgIyBTaGFwZTogW0gsIFddCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UobWFzaywgdG9yY2guVGVuc29yKToKICAgICAgICAgICAgICAgIG1hc2tfbnAgPSBtYXNrLmNwdSgpLm51bXB5KCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG1hc2tfbnAgPSBucC5hcnJheShtYXNrKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDb252ZXJ0IG1hc2sgdG8gYm9vbGVhbiAoU0FNIDMgbWF5IHJldHVybiBmbG9hdCAwLjAtMS4wIG9yIGJvb2xlYW4pCiAgICAgICAgICAgIGlmIG1hc2tfbnAuZHR5cGUgIT0gYm9vbDoKICAgICAgICAgICAgICAgICMgVGhyZXNob2xkIGF0IDAuNSBmb3IgZmxvYXQgbWFza3MKICAgICAgICAgICAgICAgIG1hc2tfbnAgPSAobWFza19ucCA+IDAuNSkuYXN0eXBlKGJvb2wpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNjYWxlIG1hc2sgYmFjayB0byBvcmlnaW5hbCBpbWFnZSBzaXplIGlmIGltYWdlIHdhcyByZXNpemVkCiAgICAgICAgICAgIGlmIHNjYWxlICE9IDEuMDoKICAgICAgICAgICAgICAgICMgU2NhbGUgbWFzayBiYWNrIHRvIG9yaWdpbmFsIHJlc29sdXRpb24KICAgICAgICAgICAgICAgIGlmIG1hc2tfbnAuc2hhcGVbOjJdICE9IG9yaWdpbmFsX3NoYXBlOgogICAgICAgICAgICAgICAgICAgIG1hc2tfcmVzaXplZCA9IGN2Mi5yZXNpemUoCiAgICAgICAgICAgICAgICAgICAgICAgIChtYXNrX25wLmFzdHlwZShucC51aW50OCkgKiAyNTUpLAogICAgICAgICAgICAgICAgICAgICAgICAob3JpZ2luYWxfdywgb3JpZ2luYWxfaCksCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVycG9sYXRpb249Y3YyLklOVEVSX05FQVJFU1QKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgbWFza19ucCA9IChtYXNrX3Jlc2l6ZWQgPiAxMjcpLmFzdHlwZShib29sKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDYWxjdWxhdGUgYXJlYSBmcm9tIG1hc2sgKG5vdyBpbiBvcmlnaW5hbCByZXNvbHV0aW9uKQogICAgICAgICAgICBhcmVhID0gaW50KG5wLnN1bShtYXNrX25wKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ29udmVydCBib3ggZnJvbSBbeDAsIHkwLCB4MSwgeTFdIHRvIFt4LCB5LCB3LCBoXQogICAgICAgICAgICAjIFNjYWxlIGJib3ggY29vcmRpbmF0ZXMgYmFjayB0byBvcmlnaW5hbCBzaXplIGlmIGltYWdlIHdhcyByZXNpemVkCiAgICAgICAgICAgIGJveCA9IGJveGVzW2ldLmNwdSgpLm51bXB5KCkKICAgICAgICAgICAgeDAsIHkwLCB4MSwgeTEgPSBib3gKICAgICAgICAgICAgIyBFbnN1cmUgY29vcmRpbmF0ZXMgYXJlIHZhbGlkIChub24tbmVnYXRpdmUpCiAgICAgICAgICAgIHgwID0gbWF4KDAsIGZsb2F0KHgwKSkKICAgICAgICAgICAgeTAgPSBtYXgoMCwgZmxvYXQoeTApKQogICAgICAgICAgICB4MSA9IG1heCh4MCwgZmxvYXQoeDEpKSAgIyB4MSBtdXN0IGJlID49IHgwCiAgICAgICAgICAgIHkxID0gbWF4KHkwLCBmbG9hdCh5MSkpICAjIHkxIG11c3QgYmUgPj0geTAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2NhbGUgY29vcmRpbmF0ZXMgYmFjayB0byBvcmlnaW5hbCBpbWFnZSBzaXplCiAgICAgICAgICAgIGlmIHNjYWxlICE9IDEuMDoKICAgICAgICAgICAgICAgIHgwID0geDAgLyBzY2FsZQogICAgICAgICAgICAgICAgeTAgPSB5MCAvIHNjYWxlCiAgICAgICAgICAgICAgICB4MSA9IHgxIC8gc2NhbGUKICAgICAgICAgICAgICAgIHkxID0geTEgLyBzY2FsZQogICAgICAgICAgICAKICAgICAgICAgICAgeCA9IGludCh4MCkKICAgICAgICAgICAgeSA9IGludCh5MCkKICAgICAgICAgICAgdyA9IG1heCgxLCBpbnQoeDEgLSB4MCkpICAjIEVuc3VyZSB3aWR0aCA+PSAxCiAgICAgICAgICAgIGggPSBtYXgoMSwgaW50KHkxIC0geTApKSAgIyBFbnN1cmUgaGVpZ2h0ID49IDEKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRW5zdXJlIGJib3ggaXMgd2l0aGluIG9yaWdpbmFsIGltYWdlIGJvdW5kcwogICAgICAgICAgICB4ID0gbWF4KDAsIG1pbih4LCBvcmlnaW5hbF93IC0gMSkpCiAgICAgICAgICAgIHkgPSBtYXgoMCwgbWluKHksIG9yaWdpbmFsX2ggLSAxKSkKICAgICAgICAgICAgdyA9IG1heCgxLCBtaW4odywgb3JpZ2luYWxfdyAtIHgpKQogICAgICAgICAgICBoID0gbWF4KDEsIG1pbihoLCBvcmlnaW5hbF9oIC0geSkpCiAgICAgICAgICAgIAogICAgICAgICAgICBiYm94ID0gW3gsIHksIHcsIGhdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENhbGN1bGF0ZSBtYXNrIGNvdmVyYWdlIHJhdGlvIChob3cgd2VsbCBtYXNrIGNvdmVycyBiYm94KQogICAgICAgICAgICAjIFRoaXMgaGVscHMgaWRlbnRpZnkgZnJhZ21lbnRzIG9yIGJhZCBkZXRlY3Rpb25zCiAgICAgICAgICAgIGJib3hfYXJlYSA9IHcgKiBoCiAgICAgICAgICAgIGNvdmVyYWdlX3JhdGlvID0gYXJlYSAvIGJib3hfYXJlYSBpZiBiYm94X2FyZWEgPiAwIGVsc2UgMC4wCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEV4dHJhY3Qgc2NvcmUKICAgICAgICAgICAgc2NvcmUgPSBmbG9hdChzY29yZXNbaV0uaXRlbSgpIGlmIGlzaW5zdGFuY2Uoc2NvcmVzW2ldLCB0b3JjaC5UZW5zb3IpIGVsc2Ugc2NvcmVzW2ldKQogICAgICAgICAgICAKICAgICAgICAgICAgZGV0ZWN0aW9uID0gewogICAgICAgICAgICAgICAgJ2lkJzogaSwKICAgICAgICAgICAgICAgICdvcmlnaW5hbF9pbmRleCc6IGksICAjIENSSVRJQ0FMOiBTdG9yZSBvcmlnaW5hbCBpbmRleCBCRUZPUkUgc29ydGluZy9maWx0ZXJpbmcKICAgICAgICAgICAgICAgICdiYm94JzogYmJveCwgICMgTm93IGluIG9yaWdpbmFsIHJlc29sdXRpb24gKDRLKSBmb3IgY3JvcHMKICAgICAgICAgICAgICAgICdtYXNrJzogbWFza19ucCwgICMgTWFzayBpbiBvcmlnaW5hbCByZXNvbHV0aW9uICg0SykKICAgICAgICAgICAgICAgICdjb25maWRlbmNlJzogZmxvYXQoc2NvcmUpLAogICAgICAgICAgICAgICAgJ2FyZWEnOiBhcmVhLCAgIyBBcmVhIGluIG9yaWdpbmFsIHJlc29sdXRpb24KICAgICAgICAgICAgICAgICdjb3ZlcmFnZV9yYXRpbyc6IGZsb2F0KGNvdmVyYWdlX3JhdGlvKSAgIyBTdG9yZSBjb3ZlcmFnZSBmb3IgZmlsdGVyaW5nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGV0ZWN0aW9ucy5hcHBlbmQoZGV0ZWN0aW9uKQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYi8J+UjSBTQU0gMyByYXcgZGV0ZWN0aW9uOiB7bGVuKGRldGVjdGlvbnMpfSBvYmplY3RzIChiZWZvcmUgZmlsdGVyaW5nKSIpCiAgICAgICAgCiAgICAgICAgIyBMb2cgcmF3IGRldGVjdGlvbnMgZm9yIGRlYnVnZ2luZwogICAgICAgIGlmIGxlbihkZXRlY3Rpb25zKSA+IDA6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIiAgIFJhdyBkZXRlY3Rpb25zIChmaXJzdCA1KToiKQogICAgICAgICAgICBmb3IgaSwgZGV0IGluIGVudW1lcmF0ZShkZXRlY3Rpb25zWzo1XSk6CiAgICAgICAgICAgICAgICB4LCB5LCB3LCBoID0gZGV0WydiYm94J10KICAgICAgICAgICAgICAgIGFyZWEgPSBkZXQuZ2V0KCdhcmVhJywgMCkKICAgICAgICAgICAgICAgIGNvbmYgPSBkZXQuZ2V0KCdjb25maWRlbmNlJywgMC4wKQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiICAgICAje2krMX06IGJib3g9KHt4fSx7eX0se3d9LHtofSksIMOhcmVhPXthcmVhfXB4wrIsIGNvbmY9e2NvbmY6LjNmfSIpCiAgICAgICAgCiAgICAgICAgIyBBcHBseSBzbWFydCBmaWx0ZXJpbmcgaWYgZW5hYmxlZAogICAgICAgIGlmIGFwcGx5X2ZpbHRlcmluZzoKICAgICAgICAgICAgZGV0ZWN0aW9ucyA9IHNlbGYuX2ZpbHRlcl9kZXRlY3Rpb25zKAogICAgICAgICAgICAgICAgZGV0ZWN0aW9ucywKICAgICAgICAgICAgICAgIGltYWdlX3NoYXBlPW9yaWdpbmFsX3NoYXBlLCAgIyBVc2Ugb3JpZ2luYWwgc2hhcGUgKDRLKSBmb3IgZmlsdGVyaW5nIChiYm94ZXMgYXJlIGFscmVhZHkgaW4gNEspCiAgICAgICAgICAgICAgICBtaW5fYXJlYT1taW5fYXJlYSwKICAgICAgICAgICAgICAgIG1heF9hcmVhX3JhdGlvPW1heF9hcmVhX3JhdGlvLAogICAgICAgICAgICAgICAgbWluX2FzcGVjdF9yYXRpbz1taW5fYXNwZWN0X3JhdGlvLAogICAgICAgICAgICAgICAgbWF4X2FzcGVjdF9yYXRpbz1tYXhfYXNwZWN0X3JhdGlvCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAjIFNvcnQgYnkgYXJlYSAoYmlnZ2VzdCBmaXJzdCkgZm9yIGJldHRlciBmaWx0ZXJpbmcKICAgICAgICBkZXRlY3Rpb25zLnNvcnQoa2V5PWxhbWJkYSBkOiBkWydhcmVhJ10sIHJldmVyc2U9VHJ1ZSkKICAgICAgICAKICAgICAgICAjIFN0ZXAgMDogRmlsdGVyIGJ5IG1hc2sgY292ZXJhZ2UgKHJlamVjdCBkZXRlY3Rpb25zIHdpdGggdmVyeSBsb3cgY292ZXJhZ2UgPSBmcmFnbWVudHMvYmFkIGRldGVjdGlvbnMpCiAgICAgICAgIyBMb3cgY292ZXJhZ2UgKDwgMTUlKSBtZWFucyBiYm94IGlzIG11Y2ggbGFyZ2VyIHRoYW4gYWN0dWFsIG9iamVjdCA9IGxpa2VseSBmcmFnbWVudCBvciBiYWQgZGV0ZWN0aW9uCiAgICAgICAgIyBSZWxheGVkIGZyb20gMjAlIHRvIDE1JSB0byBhdm9pZCBmaWx0ZXJpbmcgdmFsaWQgb2JqZWN0cyB3aXRoIGltcGVyZmVjdCBtYXNrcwogICAgICAgIGJlZm9yZV9jb3ZlcmFnZV9maWx0ZXIgPSBsZW4oZGV0ZWN0aW9ucykKICAgICAgICBkZXRlY3Rpb25zID0gW2QgZm9yIGQgaW4gZGV0ZWN0aW9ucyBpZiBkLmdldCgnY292ZXJhZ2VfcmF0aW8nLCAxLjApID49IDAuMTVdCiAgICAgICAgZmlsdGVyZWRfYnlfY292ZXJhZ2UgPSBiZWZvcmVfY292ZXJhZ2VfZmlsdGVyIC0gbGVuKGRldGVjdGlvbnMpCiAgICAgICAgaWYgZmlsdGVyZWRfYnlfY292ZXJhZ2UgPiAwOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk4ogRmlsdGVyZWQge2ZpbHRlcmVkX2J5X2NvdmVyYWdlfSBkZXRlY3Rpb25zIHdpdGggdmVyeSBsb3cgbWFzayBjb3ZlcmFnZSAoPCAxNSUpIikKICAgICAgICAKICAgICAgICAjIE9QVElNSVpBQ0nDk046IEZpbHRyYWRvIG3DoXMgc2ltcGxlIHkgcsOhcGlkbyBlbiBDUFUKICAgICAgICBpZiBzZWxmLmRldmljZSA9PSAiY3B1IjoKICAgICAgICAgICAgIyBDUFU6IHVzYXIgZmlsdHJhZG8gc2ltcGxpZmljYWRvIChtw6FzIHLDoXBpZG8pCiAgICAgICAgICAgICMgU3RlcCAxOiBGaWx0ZXIgY29udGFpbmVkIGJveGVzIChtw6FzIHLDoXBpZG8gcXVlIGdydXBvcykKICAgICAgICAgICAgZGV0ZWN0aW9ucyA9IHNlbGYuX2ZpbHRlcl9jb250YWluZWRfYm94ZXMoZGV0ZWN0aW9ucykKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU3RlcCAyOiBTb3J0IGJ5IGNvbmZpZGVuY2UgYW5kIGFwcGx5IHNpbXBsZSBOTVMgKG3DoXMgcsOhcGlkbyBxdWUgZ3J1cG9zIGNvbXBsZWpvcykKICAgICAgICAgICAgZGV0ZWN0aW9ucy5zb3J0KGtleT1sYW1iZGEgZDogZFsnY29uZmlkZW5jZSddLCByZXZlcnNlPVRydWUpCiAgICAgICAgICAgIG5tc190aHJlc2hvbGQgPSBubXNfaW91X3RocmVzaG9sZCBpZiBubXNfaW91X3RocmVzaG9sZCBpcyBub3QgTm9uZSBlbHNlIDAuNQogICAgICAgICAgICBkZXRlY3Rpb25zID0gc2VsZi5fZmlsdGVyX2R1cGxpY2F0ZXNfbm1zKGRldGVjdGlvbnMsIGlvdV90aHJlc2hvbGQ9bm1zX3RocmVzaG9sZCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU3RlcCAzOiBGaW5hbCBzb3J0IGJ5IGFyZWEKICAgICAgICAgICAgZGV0ZWN0aW9ucy5zb3J0KGtleT1sYW1iZGEgZDogZFsnYXJlYSddLCByZXZlcnNlPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFN0ZXAgNDogTGltaXRhciBhIHRvcCAyMDAgb2JqZXRvcyBmaW5hbGVzIGVuIENQVSBwYXJhIHZlbG9jaWRhZAogICAgICAgICAgICBpZiBsZW4oZGV0ZWN0aW9ucykgPiAyMDA6CiAgICAgICAgICAgICAgICBkZXRlY3Rpb25zID0gZGV0ZWN0aW9uc1s6MjAwXQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLimqEgT1BUSU1JWkFDScOTTiAoQ1BVKTogTGltaXRhbmRvIGEgdG9wIDIwMCBvYmpldG9zIGZpbmFsZXMgcGFyYSB2ZWxvY2lkYWQiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgTVBTL0NVREE6IHVzYXIgZmlsdHJhZG8gY29tcGxldG8gKG3DoXhpbWEgY2FsaWRhZCkKICAgICAgICAjIFN0ZXAgMTogRmlsdGVyIGNvbnRhaW5lZCBib3hlcwogICAgICAgIGRldGVjdGlvbnMgPSBzZWxmLl9maWx0ZXJfY29udGFpbmVkX2JveGVzKGRldGVjdGlvbnMpCiAgICAgICAgCiAgICAgICAgIyBTdGVwIDI6IEtlZXAgbGFyZ2VzdCBpbiBncm91cHMKICAgICAgICBkZXRlY3Rpb25zID0gc2VsZi5fa2VlcF9sYXJnZXN0X2luX2dyb3VwKGRldGVjdGlvbnMsIGlvdV90aHJlc2hvbGQ9MC44KQogICAgICAgIAogICAgICAgICMgU3RlcCAzOiBTb3J0IGJ5IGNvbmZpZGVuY2UgZm9yIE5NUwogICAgICAgIGRldGVjdGlvbnMuc29ydChrZXk9bGFtYmRhIGQ6IGRbJ2NvbmZpZGVuY2UnXSwgcmV2ZXJzZT1UcnVlKQogICAgICAgIAogICAgICAgICMgU3RlcCA0OiBBcHBseSBOTVMKICAgICAgICBubXNfdGhyZXNob2xkID0gbm1zX2lvdV90aHJlc2hvbGQgaWYgbm1zX2lvdV90aHJlc2hvbGQgaXMgbm90IE5vbmUgZWxzZSAwLjUKICAgICAgICBkZXRlY3Rpb25zID0gc2VsZi5fZmlsdGVyX2R1cGxpY2F0ZXNfbm1zKGRldGVjdGlvbnMsIGlvdV90aHJlc2hvbGQ9bm1zX3RocmVzaG9sZCkKICAgICAgICAKICAgICAgICAjIFN0ZXAgNTogRmluYWwgc29ydCBieSBhcmVhCiAgICAgICAgZGV0ZWN0aW9ucy5zb3J0KGtleT1sYW1iZGEgZDogZFsnYXJlYSddLCByZXZlcnNlPVRydWUpCiAgICAgICAgCiAgICAgICAgIyBSZWFzc2lnbiBJRHMgYW5kIG9yaWdpbmFsX2luZGV4IGFmdGVyIGFsbCBmaWx0ZXJpbmcKICAgICAgICAjIENSSVRJQ0FMOiBvcmlnaW5hbF9pbmRleCBtdXN0IGJlIHJlbnVtYmVyZWQgdG8gbWF0Y2ggZmluYWwgcG9zaXRpb25zCiAgICAgICAgIyBUaGlzIHByZXZlbnRzIG91dC1vZi1yYW5nZSBpbmRpY2VzIChlLmcuLCBvcmlnaW5hbF9pbmRleD0xNTEgd2hlbiBvbmx5IDU1IGRldGVjdGlvbnMgcmVtYWluKQogICAgICAgIGZvciBpLCBkZXQgaW4gZW51bWVyYXRlKGRldGVjdGlvbnMpOgogICAgICAgICAgICBkZXRbJ2lkJ10gPSBpCiAgICAgICAgICAgIGRldFsnb3JpZ2luYWxfaW5kZXgnXSA9IGkgICMgUmVhc3NpZ24gdG8gbWF0Y2ggZmluYWwgcG9zaXRpb24gYWZ0ZXIgZmlsdGVyaW5nCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUgRmluYWwgcmVzdWx0OiB7bGVuKGRldGVjdGlvbnMpfSBxdWFsaXR5IG9iamVjdHMiKQogICAgICAgIHJldHVybiBkZXRlY3Rpb25zCiAgICAKICAgIGRlZiBfZmlsdGVyX2RldGVjdGlvbnMoCiAgICAgICAgc2VsZiwKICAgICAgICBkZXRlY3Rpb25zOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwKICAgICAgICBpbWFnZV9zaGFwZTogVHVwbGVbaW50LCBpbnRdLAogICAgICAgIG1pbl9hcmVhOiBPcHRpb25hbFtpbnRdID0gTm9uZSwKICAgICAgICBtYXhfYXJlYV9yYXRpbzogT3B0aW9uYWxbZmxvYXRdID0gTm9uZSwKICAgICAgICBtaW5fYXNwZWN0X3JhdGlvOiBPcHRpb25hbFtmbG9hdF0gPSBOb25lLAogICAgICAgIG1heF9hc3BlY3RfcmF0aW86IE9wdGlvbmFsW2Zsb2F0XSA9IE5vbmUKICAgICkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiQXBwbHkgaW50ZWxsaWdlbnQgZmlsdGVyaW5nOiBhcmVhLCBhc3BlY3QgcmF0aW8sIHZpc2liaWxpdHkuIiIiCiAgICAgICAgaCwgdyA9IGltYWdlX3NoYXBlCiAgICAgICAgbWluX2FyZWEgPSBtaW5fYXJlYSBvciAyMDAwCiAgICAgICAgbWF4X2FyZWEgPSAoaCAqIHcpICogKG1heF9hcmVhX3JhdGlvIG9yIDAuNCkKICAgICAgICBtaW5fYXIgPSBtaW5fYXNwZWN0X3JhdGlvIG9yIDAuMgogICAgICAgIG1heF9hciA9IG1heF9hc3BlY3RfcmF0aW8gb3IgNS4wCiAgICAgICAgZmlsdGVyZWQgPSBbXQogICAgICAgIAogICAgICAgICMgTG9nIGZpbHRlcmluZyBwYXJhbWV0ZXJzIGZvciBkZWJ1Z2dpbmcKICAgICAgICBsb2dnZXIuZGVidWcoZiLwn5SNIEZpbHRlcmluZzogbWluX2FyZWE9e21pbl9hcmVhfSwgbWF4X2FyZWE9e21heF9hcmVhfSAoe21heF9hcmVhX3JhdGlvIG9yIDAuNDouMSV9IG9mIHtoKnd9cHjCsikiKQogICAgICAgIAogICAgICAgIGZpbHRlcmVkX2J5X2FyZWEgPSAwCiAgICAgICAgZmlsdGVyZWRfYnlfYXNwZWN0ID0gMAogICAgICAgIGZpbHRlcmVkX2J5X3Zpc2liaWxpdHkgPSAwCiAgICAgICAgCiAgICAgICAgZm9yIGRldCBpbiBkZXRlY3Rpb25zOgogICAgICAgICAgICBhcmVhLCB4LCB5LCB3aWR0aCwgaGVpZ2h0ID0gZGV0WydhcmVhJ10sICpkZXRbJ2Jib3gnXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBGaWx0ZXIgYnkgYXJlYSAodG9vIHNtYWxsIG9yIHRvbyBsYXJnZSA9IGJhY2tncm91bmQvc2NlbmUpCiAgICAgICAgICAgIGlmIGFyZWEgPCBtaW5fYXJlYToKICAgICAgICAgICAgICAgIGZpbHRlcmVkX2J5X2FyZWEgKz0gMQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiICDinYwgRmlsdGVyZWQgKHRvbyBzbWFsbCk6IGFyZWE9e2FyZWF9cHjCsiA8IHttaW5fYXJlYX1weMKyIikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIGFyZWEgPiBtYXhfYXJlYToKICAgICAgICAgICAgICAgIGZpbHRlcmVkX2J5X2FyZWEgKz0gMQogICAgICAgICAgICAgICAgYXJlYV9yYXRpbyA9IGFyZWEgLyAoaCAqIHcpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIiAg4p2MIEZpbHRlcmVkICh0b28gbGFyZ2UvYmFja2dyb3VuZCk6IGFyZWE9e2FyZWF9cHjCsiAoe2FyZWFfcmF0aW86LjElfSBvZiBpbWFnZSkgPiB7bWF4X2FyZWF9cHjCsiAoe21heF9hcmVhX3JhdGlvIG9yIDAuNDouMSV9KSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaGVpZ2h0ID4gMDoKICAgICAgICAgICAgICAgIGFyID0gd2lkdGggLyBoZWlnaHQKICAgICAgICAgICAgICAgIGlmIGFyIDwgbWluX2FyIG9yIGFyID4gbWF4X2FyOgogICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkX2J5X2FzcGVjdCArPSAxCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiICDinYwgRmlsdGVyZWQgKGFzcGVjdCByYXRpbyk6IGFyPXthcjouMmZ9IG5vdCBpbiBbe21pbl9hcjouMmZ9LCB7bWF4X2FyOi4yZn1dIikKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgYmJveF9hcmVhID0gd2lkdGggKiBoZWlnaHQKICAgICAgICAgICAgaWYgYmJveF9hcmVhIDw9IDA6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB4MSwgeTEgPSBtYXgoeCwgMCksIG1heCh5LCAwKQogICAgICAgICAgICB4MiwgeTIgPSBtaW4oeCArIHdpZHRoLCB3KSwgbWluKHkgKyBoZWlnaHQsIGgpCiAgICAgICAgICAgIHZpc2libGVfcmF0aW8gPSAoKHgyIC0geDEpICogKHkyIC0geTEpKSAvIGJib3hfYXJlYQogICAgICAgICAgICBpZiB2aXNpYmxlX3JhdGlvIDwgMC44OgogICAgICAgICAgICAgICAgZmlsdGVyZWRfYnlfdmlzaWJpbGl0eSArPSAxCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiIgIOKdjCBGaWx0ZXJlZCAodmlzaWJpbGl0eSk6IHZpc2libGVfcmF0aW89e3Zpc2libGVfcmF0aW86LjJmfSA8IDAuOCIpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgZmlsdGVyZWQuYXBwZW5kKGRldCkKICAgICAgICAKICAgICAgICB0b3RhbF9maWx0ZXJlZCA9IGxlbihkZXRlY3Rpb25zKSAtIGxlbihmaWx0ZXJlZCkKICAgICAgICBpZiB0b3RhbF9maWx0ZXJlZCA+IDA6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi8J+TiiBGaWx0ZXJlZCB7dG90YWxfZmlsdGVyZWR9IGRldGVjdGlvbnM6IHtmaWx0ZXJlZF9ieV9hcmVhfSBieSBhcmVhLCB7ZmlsdGVyZWRfYnlfYXNwZWN0fSBieSBhc3BlY3QsIHtmaWx0ZXJlZF9ieV92aXNpYmlsaXR5fSBieSB2aXNpYmlsaXR5IikKICAgICAgICByZXR1cm4gZmlsdGVyZWQKICAgIAogICAgZGVmIF9jYWxjdWxhdGVfaW91KHNlbGYsIGJib3gxOiBMaXN0W2ludF0sIGJib3gyOiBMaXN0W2ludF0pIC0+IGZsb2F0OgogICAgICAgICIiIkNhbGN1bGF0ZSBJb1UgYmV0d2VlbiB0d28gYm91bmRpbmcgYm94ZXMuIiIiCiAgICAgICAgeDFfMSwgeTFfMSwgdzEsIGgxID0gYmJveDEKICAgICAgICB4MV8yLCB5MV8yLCB3MiwgaDIgPSBiYm94MgogICAgICAgIHgyXzEsIHkyXzEgPSB4MV8xICsgdzEsIHkxXzEgKyBoMQogICAgICAgIHgyXzIsIHkyXzIgPSB4MV8yICsgdzIsIHkxXzIgKyBoMgogICAgICAgIAogICAgICAgIHhfbGVmdCwgeV90b3AgPSBtYXgoeDFfMSwgeDFfMiksIG1heCh5MV8xLCB5MV8yKQogICAgICAgIHhfcmlnaHQsIHlfYm90dG9tID0gbWluKHgyXzEsIHgyXzIpLCBtaW4oeTJfMSwgeTJfMikKICAgICAgICAKICAgICAgICBpZiB4X3JpZ2h0IDwgeF9sZWZ0IG9yIHlfYm90dG9tIDwgeV90b3A6CiAgICAgICAgICAgIHJldHVybiAwLjAKICAgICAgICAKICAgICAgICBpbnRlcnNlY3Rpb24gPSAoeF9yaWdodCAtIHhfbGVmdCkgKiAoeV9ib3R0b20gLSB5X3RvcCkKICAgICAgICB1bmlvbiA9IHcxICogaDEgKyB3MiAqIGgyIC0gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuIGludGVyc2VjdGlvbiAvIHVuaW9uIGlmIHVuaW9uID4gMCBlbHNlIDAuMAogICAgCiAgICBkZWYgX2ZpbHRlcl9jb250YWluZWRfYm94ZXMoc2VsZiwgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0pIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIlJlbW92ZSBzbWFsbCBib3hlcyBjb21wbGV0ZWx5IGNvbnRhaW5lZCBpbnNpZGUgbGFyZ2VyIG9uZXMuIiIiCiAgICAgICAgaWYgbGVuKGRldGVjdGlvbnMpIDw9IDE6CiAgICAgICAgICAgIHJldHVybiBkZXRlY3Rpb25zCiAgICAgICAgCiAgICAgICAgZmlsdGVyZWQgPSBbXQogICAgICAgIGZvciBpLCBkZXQgaW4gZW51bWVyYXRlKGRldGVjdGlvbnMpOgogICAgICAgICAgICB4MSwgeTEsIHcxLCBoMSA9IGRldFsnYmJveCddCiAgICAgICAgICAgIGlzX2NvbnRhaW5lZCA9IEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3Igb3RoZXIgaW4gZGV0ZWN0aW9uczoKICAgICAgICAgICAgICAgIGlmIG90aGVyWydhcmVhJ10gPD0gZGV0WydhcmVhJ106CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHgyLCB5MiwgdzIsIGgyID0gb3RoZXJbJ2Jib3gnXQogICAgICAgICAgICAgICAgaWYgKHgxID49IHgyIGFuZCB5MSA+PSB5MiBhbmQgeDEgKyB3MSA8PSB4MiArIHcyIGFuZCB5MSArIGgxIDw9IHkyICsgaDIpOgogICAgICAgICAgICAgICAgICAgIGlzX2NvbnRhaW5lZCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGlzX2NvbnRhaW5lZDoKICAgICAgICAgICAgICAgIGZpbHRlcmVkLmFwcGVuZChkZXQpCiAgICAgICAgCiAgICAgICAgcmVtb3ZlZCA9IGxlbihkZXRlY3Rpb25zKSAtIGxlbihmaWx0ZXJlZCkKICAgICAgICBpZiByZW1vdmVkID4gMDoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5OmIEZpbHRlcmVkIGNvbnRhaW5lZCBib3hlczoge2xlbihkZXRlY3Rpb25zKX0g4oaSIHtsZW4oZmlsdGVyZWQpfSAocmVtb3ZlZCB7cmVtb3ZlZH0pIikKICAgICAgICByZXR1cm4gZmlsdGVyZWQKICAgIAogICAgZGVmIF9rZWVwX2xhcmdlc3RfaW5fZ3JvdXAoc2VsZiwgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0sIGlvdV90aHJlc2hvbGQ6IGZsb2F0ID0gMC44KSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICAgICAiIiJGb3IgdmVyeSBoaWdoIG92ZXJsYXAgZ3JvdXBzICg+ODAlKSwga2VlcCBvbmx5IHRoZSBsYXJnZXN0IGJveC4iIiIKICAgICAgICBpZiBsZW4oZGV0ZWN0aW9ucykgPD0gMToKICAgICAgICAgICAgcmV0dXJuIGRldGVjdGlvbnMKICAgICAgICAKICAgICAgICBncm91cHMsIHVzZWQgPSBbXSwgc2V0KCkKICAgICAgICBmb3IgaSwgZGV0IGluIGVudW1lcmF0ZShkZXRlY3Rpb25zKToKICAgICAgICAgICAgaWYgaSBpbiB1c2VkOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZ3JvdXAgPSBbZGV0XQogICAgICAgICAgICBmb3Igaiwgb3RoZXIgaW4gZW51bWVyYXRlKGRldGVjdGlvbnNbaSArIDE6XSwgaSArIDEpOgogICAgICAgICAgICAgICAgaWYgaiBpbiB1c2VkOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9jYWxjdWxhdGVfaW91KGRldFsnYmJveCddLCBvdGhlclsnYmJveCddKSA+IGlvdV90aHJlc2hvbGQ6CiAgICAgICAgICAgICAgICAgICAgZ3JvdXAuYXBwZW5kKG90aGVyKQogICAgICAgICAgICAgICAgICAgIHVzZWQuYWRkKGopCiAgICAgICAgICAgIGdyb3Vwcy5hcHBlbmQobWF4KGdyb3VwLCBrZXk9bGFtYmRhIGQ6IGRbJ2FyZWEnXSkpCiAgICAgICAgCiAgICAgICAgcmVtb3ZlZCA9IGxlbihkZXRlY3Rpb25zKSAtIGxlbihncm91cHMpCiAgICAgICAgaWYgcmVtb3ZlZCA+IDA6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi8J+OryBLZXB0IGxhcmdlc3QgaW4gZ3JvdXBzOiB7bGVuKGRldGVjdGlvbnMpfSDihpIge2xlbihncm91cHMpfSAocmVtb3ZlZCB7cmVtb3ZlZH0pIikKICAgICAgICByZXR1cm4gZ3JvdXBzCiAgICAKICAgIGRlZiBfZmlsdGVyX2R1cGxpY2F0ZXNfbm1zKAogICAgICAgIHNlbGYsCiAgICAgICAgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0sCiAgICAgICAgaW91X3RocmVzaG9sZDogZmxvYXQgPSAwLjUKICAgICkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiRmlsdGVyIGR1cGxpY2F0ZXMgdXNpbmcgTk1TLiIiIgogICAgICAgIGlmIGxlbihkZXRlY3Rpb25zKSA8PSAxOgogICAgICAgICAgICByZXR1cm4gZGV0ZWN0aW9ucwogICAgICAgIAogICAgICAgIGZpbHRlcmVkLCBzdXBwcmVzc2VkID0gW10sIHNldCgpCiAgICAgICAgZm9yIGksIGRldDEgaW4gZW51bWVyYXRlKGRldGVjdGlvbnMpOgogICAgICAgICAgICBpZiBpIGluIHN1cHByZXNzZWQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBmaWx0ZXJlZC5hcHBlbmQoZGV0MSkKICAgICAgICAgICAgZm9yIGosIGRldDIgaW4gZW51bWVyYXRlKGRldGVjdGlvbnNbaSArIDE6XSwgc3RhcnQ9aSArIDEpOgogICAgICAgICAgICAgICAgaWYgaiBub3QgaW4gc3VwcHJlc3NlZCBhbmQgc2VsZi5fY2FsY3VsYXRlX2lvdShkZXQxWydiYm94J10sIGRldDJbJ2Jib3gnXSkgPiBpb3VfdGhyZXNob2xkOgogICAgICAgICAgICAgICAgICAgIHN1cHByZXNzZWQuYWRkKGopCiAgICAgICAgCiAgICAgICAgcmVtb3ZlZCA9IGxlbihkZXRlY3Rpb25zKSAtIGxlbihmaWx0ZXJlZCkKICAgICAgICBpZiByZW1vdmVkID4gMDoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5SNIE5NUyBmaWx0ZXJpbmc6IHtsZW4oZGV0ZWN0aW9ucyl9IOKGkiB7bGVuKGZpbHRlcmVkKX0gKHJlbW92ZWQge3JlbW92ZWR9KSIpCiAgICAgICAgcmV0dXJuIGZpbHRlcmVkCiAgICAKICAgIGRlZiBjcm9wX29iamVjdCgKICAgICAgICBzZWxmLAogICAgICAgIGltYWdlOiBucC5uZGFycmF5LAogICAgICAgIGJib3g6IExpc3RbaW50XSwKICAgICAgICBtYXNrOiBPcHRpb25hbFtucC5uZGFycmF5XSA9IE5vbmUsCiAgICAgICAgcGFkZGluZzogaW50ID0gMzAKICAgICkgLT4gbnAubmRhcnJheToKICAgICAgICAiIiIKICAgICAgICBDcm9wIG9iamVjdCB3aXRoIHBhZGRpbmcsIG9wdGlvbmFsbHkgdXNpbmcgbWFzayBmb3IgcHJlY2lzZSBjcm9wcGluZy4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBpbWFnZTogRnVsbCBzY2VuZSBpbWFnZQogICAgICAgICAgICBiYm94OiBCb3VuZGluZyBib3ggW3gsIHksIHcsIGhdCiAgICAgICAgICAgIG1hc2s6IE9wdGlvbmFsIGJvb2xlYW4gbWFzayAoc2FtZSBzaXplIGFzIGltYWdlKSBmb3IgcHJlY2lzZSBjcm9wcGluZwogICAgICAgICAgICBwYWRkaW5nOiBQYWRkaW5nIGFyb3VuZCBvYmplY3QgaW4gcGl4ZWxzCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIENyb3BwZWQgaW1hZ2Ugd2l0aCBvYmplY3QgY2VudGVyZWQsIGJhY2tncm91bmQgcmVtb3ZlZCBpZiBtYXNrIHByb3ZpZGVkCiAgICAgICAgIiIiCiAgICAgICAgeCwgeSwgdywgaCA9IGJib3gKICAgICAgICB4MSwgeTEgPSBtYXgoMCwgeCAtIHBhZGRpbmcpLCBtYXgoMCwgeSAtIHBhZGRpbmcpCiAgICAgICAgeDIsIHkyID0gbWluKGltYWdlLnNoYXBlWzFdLCB4ICsgdyArIHBhZGRpbmcpLCBtaW4oaW1hZ2Uuc2hhcGVbMF0sIHkgKyBoICsgcGFkZGluZykKICAgICAgICAKICAgICAgICBjcm9wID0gaW1hZ2VbeTE6eTIsIHgxOngyXS5jb3B5KCkKICAgICAgICAKICAgICAgICAjIElmIG1hc2sgcHJvdmlkZWQsIGFwcGx5IGl0IHRvIHJlbW92ZSBiYWNrZ3JvdW5kCiAgICAgICAgIyBOT1RFOiBXZSBrZWVwIHRoZSBmdWxsIGJib3ggY3JvcCBidXQgY291bGQgdXNlIG1hc2sgZm9yIGJldHRlciBjZW50ZXJpbmcgbGF0ZXIKICAgICAgICAjIEZvciBub3csIHdlIHVzZSBiYm94IHRvIGVuc3VyZSB3ZSBjYXB0dXJlIHRoZSBlbnRpcmUgb2JqZWN0CiAgICAgICAgIyBUaGUgbWFzayBjYW4gYmUgdXNlZCBmb3IgdmlzdWFsaXphdGlvbiBidXQgbm90IGZvciBjcm9wcGluZyAodG8gYXZvaWQgbWlzc2luZyBwYXJ0cykKICAgICAgICAKICAgICAgICByZXR1cm4gY3JvcAogICAgCiAgICBkZWYgdmlzdWFsaXplX2RldGVjdGlvbnMoCiAgICAgICAgc2VsZiwKICAgICAgICBpbWFnZTogbnAubmRhcnJheSwKICAgICAgICBkZXRlY3Rpb25zOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwKICAgICAgICBtYXhfb2JqZWN0czogaW50ID0gTm9uZQogICAgKSAtPiBucC5uZGFycmF5OgogICAgICAgICIiIkRyYXcgYm91bmRpbmcgYm94ZXMuIiIiCiAgICAgICAgdmlzID0gaW1hZ2UuY29weSgpCiAgICAgICAgZm9yIGksIGRldCBpbiBlbnVtZXJhdGUoZGV0ZWN0aW9uc1s6bWF4X29iamVjdHNdIGlmIG1heF9vYmplY3RzIGVsc2UgZGV0ZWN0aW9ucyk6CiAgICAgICAgICAgIHgsIHksIHcsIGggPSBkZXRbJ2Jib3gnXQogICAgICAgICAgICBjb25mID0gZGV0Wydjb25maWRlbmNlJ10KICAgICAgICAgICAgY29sb3IgPSAoMCwgMjU1LCAwKSBpZiBjb25mID4gMC45IGVsc2UgKDAsIDI1NSwgMjU1KSBpZiBjb25mID4gMC43IGVsc2UgKDAsIDE2NSwgMjU1KQogICAgICAgICAgICBjdjIucmVjdGFuZ2xlKHZpcywgKHgsIHkpLCAoeCArIHcsIHkgKyBoKSwgY29sb3IsIDIpCiAgICAgICAgICAgIGN2Mi5wdXRUZXh0KHZpcywgZiIje2krMX0gKHtjb25mOi4yZn0pIiwgKHgsIHkgLSA1KSwKICAgICAgICAgICAgICAgICAgICAgICBjdjIuRk9OVF9IRVJTSEVZX1NJTVBMRVgsIDAuNSwgY29sb3IsIDIpCiAgICAgICAgcmV0dXJuIHZpcwogICAgCiAgICBkZWYgc2F2ZV9jcm9wcygKICAgICAgICBzZWxmLAogICAgICAgIGltYWdlOiBucC5uZGFycmF5LAogICAgICAgIGRldGVjdGlvbnM6IExpc3RbRGljdFtzdHIsIEFueV1dLAogICAgICAgIG91dHB1dF9kaXI6IHN0ciwKICAgICAgICBwcmVmaXg6IHN0ciA9ICJvYmoiCiAgICApIC0+IExpc3Rbc3RyXToKICAgICAgICAiIiIKICAgICAgICBTYXZlIGNyb3BzIHdpdGggc3RhbmRhcmRpemVkIDE6MSBhc3BlY3QgcmF0aW8sIG9iamVjdCBjZW50ZXJlZC4KICAgICAgICBVc2VzIG1hc2tzIGZyb20gU0FNIDMgZm9yIHByZWNpc2UgY3JvcHBpbmcgKHJlbW92ZXMgYmFja2dyb3VuZCkuCiAgICAgICAgIiIiCiAgICAgICAgb3V0cHV0X3BhdGggPSBQYXRoKG91dHB1dF9kaXIpCiAgICAgICAgb3V0cHV0X3BhdGgubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgIHNhdmVkX3BhdGhzID0gW10KICAgICAgICAKICAgICAgICBmb3IgaSwgZGV0IGluIGVudW1lcmF0ZShkZXRlY3Rpb25zKToKICAgICAgICAgICAgIyBVc2UgYmJveCBjcm9wIChub3QgbWFzaykgdG8gZW5zdXJlIHdlIGNhcHR1cmUgdGhlIGVudGlyZSBvYmplY3QKICAgICAgICAgICAgIyBNYXNrcyBhcmUgdXNlZCBmb3IgdmlzdWFsaXphdGlvbiwgYnV0IGJib3ggZW5zdXJlcyBjb21wbGV0ZSBjYXB0dXJlCiAgICAgICAgICAgIGNyb3AgPSBzZWxmLmNyb3Bfb2JqZWN0KGltYWdlLCBkZXRbJ2Jib3gnXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGNyb3BfaGVpZ2h0LCBjcm9wX3dpZHRoID0gY3JvcC5zaGFwZVs6Ml0KICAgICAgICAgICAgdGFyZ2V0X3NpemUgPSBtYXgoY3JvcF93aWR0aCwgY3JvcF9oZWlnaHQpCiAgICAgICAgICAgIG1pbl9zaXplID0gMzAwCiAgICAgICAgICAgIGlmIHRhcmdldF9zaXplIDwgbWluX3NpemU6CiAgICAgICAgICAgICAgICB0YXJnZXRfc2l6ZSA9IG1pbl9zaXplCiAgICAgICAgICAgIAogICAgICAgICAgICBib3JkZXJfY29sb3IgPSBzZWxmLl9nZXRfYm9yZGVyX2NvbG9yKGNyb3ApCiAgICAgICAgICAgIHNxdWFyZV9jcm9wID0gbnAuZnVsbCgodGFyZ2V0X3NpemUsIHRhcmdldF9zaXplLCAzKSwgYm9yZGVyX2NvbG9yLCBkdHlwZT1ucC51aW50OCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHhfb2Zmc2V0ID0gKHRhcmdldF9zaXplIC0gY3JvcF93aWR0aCkgLy8gMgogICAgICAgICAgICB5X29mZnNldCA9ICh0YXJnZXRfc2l6ZSAtIGNyb3BfaGVpZ2h0KSAvLyAyCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBjcm9wX3dpZHRoID4gdGFyZ2V0X3NpemUgb3IgY3JvcF9oZWlnaHQgPiB0YXJnZXRfc2l6ZToKICAgICAgICAgICAgICAgIHNjYWxlID0gbWluKHRhcmdldF9zaXplIC8gY3JvcF93aWR0aCwgdGFyZ2V0X3NpemUgLyBjcm9wX2hlaWdodCkKICAgICAgICAgICAgICAgIG5ld193ID0gaW50KGNyb3Bfd2lkdGggKiBzY2FsZSkKICAgICAgICAgICAgICAgIG5ld19oID0gaW50KGNyb3BfaGVpZ2h0ICogc2NhbGUpCiAgICAgICAgICAgICAgICBjcm9wID0gY3YyLnJlc2l6ZShjcm9wLCAobmV3X3csIG5ld19oKSwgaW50ZXJwb2xhdGlvbj1jdjIuSU5URVJfQ1VCSUMpCiAgICAgICAgICAgICAgICBjcm9wX2hlaWdodCwgY3JvcF93aWR0aCA9IGNyb3Auc2hhcGVbOjJdCiAgICAgICAgICAgICAgICB4X29mZnNldCA9ICh0YXJnZXRfc2l6ZSAtIGNyb3Bfd2lkdGgpIC8vIDIKICAgICAgICAgICAgICAgIHlfb2Zmc2V0ID0gKHRhcmdldF9zaXplIC0gY3JvcF9oZWlnaHQpIC8vIDIKICAgICAgICAgICAgCiAgICAgICAgICAgIHNxdWFyZV9jcm9wW3lfb2Zmc2V0Onlfb2Zmc2V0ICsgY3JvcF9oZWlnaHQsIHhfb2Zmc2V0Onhfb2Zmc2V0ICsgY3JvcF93aWR0aF0gPSBjcm9wCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENSSVRJQ0FMOiBVc2Ugb3JpZ2luYWxfaW5kZXggdG8gcHJlc2VydmUgb3JkZXIgYmVmb3JlIHNvcnRpbmcvZmlsdGVyaW5nCiAgICAgICAgICAgICMgVGhpcyBlbnN1cmVzIGNyb3BzIG1hdGNoIHRoZSBvcmlnaW5hbCBTQU0gZGV0ZWN0aW9uIG9yZGVyLCBub3QgdGhlIHNvcnRlZCBvcmRlcgogICAgICAgICAgICBvcmlnaW5hbF9pbmRleCA9IGRldC5nZXQoJ29yaWdpbmFsX2luZGV4JywgZGV0WydpZCddKQogICAgICAgICAgICBmaWxlcGF0aCA9IG91dHB1dF9wYXRoIC8gZiJ7cHJlZml4fV97b3JpZ2luYWxfaW5kZXg6MDNkfS5qcGciCiAgICAgICAgICAgIGN2Mi5pbXdyaXRlKHN0cihmaWxlcGF0aCksIHNxdWFyZV9jcm9wLCBbY3YyLklNV1JJVEVfSlBFR19RVUFMSVRZLCA5NV0pCiAgICAgICAgICAgIHNhdmVkX3BhdGhzLmFwcGVuZChzdHIoZmlsZXBhdGgpKQogICAgICAgIAogICAgICAgICMgQ1JJVElDQUw6IFJldHVybiBjcm9wcyBpbiBvcmRlciBvZiBvcmlnaW5hbF9pbmRleCAoMCwgMSwgMiwgLi4uKQogICAgICAgICMgVGhpcyBlbnN1cmVzIHNhdmVkX3BhdGhzW2ldIGNvcnJlc3BvbmRzIHRvIHRoZSBjcm9wIHdpdGggb3JpZ2luYWxfaW5kZXg9aQogICAgICAgICMgQnVpbGQgYSBkaWN0aW9uYXJ5IGZpcnN0LCB0aGVuIGNyZWF0ZSBvcmRlcmVkIGxpc3QKICAgICAgICBzYXZlZF9wYXRoc19kaWN0ID0ge30KICAgICAgICBmb3IgaSwgZGV0IGluIGVudW1lcmF0ZShkZXRlY3Rpb25zKToKICAgICAgICAgICAgb3JpZ2luYWxfaWR4ID0gZGV0LmdldCgnb3JpZ2luYWxfaW5kZXgnLCBpKQogICAgICAgICAgICBpZiBpIDwgbGVuKHNhdmVkX3BhdGhzKToKICAgICAgICAgICAgICAgIHNhdmVkX3BhdGhzX2RpY3Rbb3JpZ2luYWxfaWR4XSA9IHNhdmVkX3BhdGhzW2ldCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgb3JkZXJlZCBsaXN0IGZpbGxpbmcgZ2FwcyB3aXRoIE5vbmUKICAgICAgICBtYXhfb3JpZ2luYWxfaWR4ID0gbWF4KHNhdmVkX3BhdGhzX2RpY3Qua2V5cygpKSBpZiBzYXZlZF9wYXRoc19kaWN0IGVsc2UgLTEKICAgICAgICBvcmRlcmVkX3BhdGhzID0gW05vbmVdICogKG1heF9vcmlnaW5hbF9pZHggKyAxKQogICAgICAgIGZvciBpZHgsIGNyb3BfcGF0aCBpbiBzYXZlZF9wYXRoc19kaWN0Lml0ZW1zKCk6CiAgICAgICAgICAgIG9yZGVyZWRfcGF0aHNbaWR4XSA9IGNyb3BfcGF0aAogICAgICAgIAogICAgICAgIHJldHVybiBvcmRlcmVkX3BhdGhzCiAgICAKICAgIGRlZiBfZ2V0X2JvcmRlcl9jb2xvcihzZWxmLCBjcm9wOiBucC5uZGFycmF5KSAtPiB0dXBsZToKICAgICAgICAiIiJHZXQgYXZlcmFnZSBib3JkZXIgY29sb3IgZnJvbSBjcm9wIGVkZ2VzIGZvciBuYXR1cmFsIHBhZGRpbmcuIiIiCiAgICAgICAgaCwgdyA9IGNyb3Auc2hhcGVbOjJdCiAgICAgICAgaWYgaCA8IDMgb3IgdyA8IDM6CiAgICAgICAgICAgIHJldHVybiAoMjU1LCAyNTUsIDI1NSkKICAgICAgICAKICAgICAgICBib3JkZXJfcGl4ZWxzID0gbnAuY29uY2F0ZW5hdGUoWwogICAgICAgICAgICBjcm9wWzAsIDpdLnJlc2hhcGUoLTEsIDMpLAogICAgICAgICAgICBjcm9wWy0xLCA6XS5yZXNoYXBlKC0xLCAzKSwKICAgICAgICAgICAgY3JvcFs6LCAwXS5yZXNoYXBlKC0xLCAzKSwKICAgICAgICAgICAgY3JvcFs6LCAtMV0ucmVzaGFwZSgtMSwgMykKICAgICAgICBdLCBheGlzPTApCiAgICAgICAgCiAgICAgICAgYXZnX2NvbG9yID0gbnAubWVhbihib3JkZXJfcGl4ZWxzLCBheGlzPTApLmFzdHlwZShucC51aW50OCkKICAgICAgICByZXR1cm4gdHVwbGUoYXZnX2NvbG9yLnRvbGlzdCgpKQo=''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/detector.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/detector.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… detector.py creado')

# analyzer.py
print('ðŸ“¤ Creando analyzer.py...')
data_chunks = [
    '''IiIiCkNsYXVkZSBWaXNpb24gQW5hbHl6ZXIKQW5hbHl6ZXMgb2JqZWN0IGltYWdlcyB1c2luZyBDbGF1ZGUgU29ubmV0IDQgdmlzaW9uLgpNYXggMzUwIGxpbmVzLgoiIiIKaW1wb3J0IGFudGhyb3BpYwppbXBvcnQgYmFzZTY0CmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0CmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aAoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgoKY2xhc3MgQ2xhdWRlQW5hbHl6ZXI6CiAgICAiIiJBbmFseXplcyBvYmplY3RzIHVzaW5nIENsYXVkZSBTb25uZXQgNCB2aXNpb24uIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIGFwaV9rZXk6IHN0ciwKICAgICAgICBtb2RlbDogc3RyID0gImNsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCIsCiAgICAgICAgbWF4X3Rva2VuczogaW50ID0gMTAwMCwKICAgICAgICB0ZW1wZXJhdHVyZTogZmxvYXQgPSAwCiAgICApOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgQ2xhdWRlIGFuYWx5emVyLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFwaV9rZXk6IEFudGhyb3BpYyBBUEkga2V5CiAgICAgICAgICAgIG1vZGVsOiBDbGF1ZGUgbW9kZWwgdG8gdXNlCiAgICAgICAgICAgIG1heF90b2tlbnM6IE1heGltdW0gcmVzcG9uc2UgdG9rZW5zCiAgICAgICAgICAgIHRlbXBlcmF0dXJlOiBTYW1wbGluZyB0ZW1wZXJhdHVyZSAoMCA9IGRldGVybWluaXN0aWMpCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5jbGllbnQgPSBhbnRocm9waWMuQW50aHJvcGljKGFwaV9rZXk9YXBpX2tleSkKICAgICAgICBzZWxmLm1vZGVsID0gbW9kZWwKICAgICAgICBzZWxmLm1heF90b2tlbnMgPSBtYXhfdG9rZW5zCiAgICAgICAgc2VsZi50ZW1wZXJhdHVyZSA9IHRlbXBlcmF0dXJlCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUgQ2xhdWRlIGFuYWx5emVyIGluaXRpYWxpemVkICh7bW9kZWx9KSIpCiAgICAKICAgIGRlZiBhbmFseXplX3NjZW5lX3dpdGhfYmJveGVzKAogICAgICAgIHNlbGYsCiAgICAgICAgc2NlbmVfcGF0aDogc3RyLAogICAgICAgIGRldGVjdGlvbnM6IExpc3RbRGljdFtzdHIsIEFueV1dLAogICAgICAgIGxhbmd1YWdlOiBzdHIgPSAic3BhbmlzaCIKICAgICkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiCiAgICAgICAgQW5hbHl6ZSBvYmplY3RzIGRldGVjdGVkIGluIGNvbXBsZXRlIHNjZW5lLgogICAgICAgIAogICAgICAgIFNlbmRzIE9OTFkgdGhlIHNjZW5lIGltYWdlICsgbGlzdCBvZiBib3VuZGluZyBib3hlcyBpbiB0ZXh0LgogICAgICAgIENsYXVkZSBhbmFseXplcyBlYWNoIHJlZ2lvbiBkaXJlY3RseSBpbiB0aGUgaW1hZ2UuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2NlbmVfcGF0aDogUGF0aCB0byBjb21wbGV0ZSBzY2VuZSBpbWFnZQogICAgICAgICAgICBkZXRlY3Rpb25zOiBMaXN0IG9mIFNBTSBkZXRlY3Rpb25zIHdpdGggYmJveCwgYXJlYSwgY29uZmlkZW5jZQogICAgICAgICAgICBsYW5ndWFnZTogUmVzcG9uc2UgbGFuZ3VhZ2UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgTGlzdCBvZiBhbmFseXNpcyByZXN1bHRzIChvbmUgcGVyIGRldGVjdGlvbiwgaW4gb3JkZXIpCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiLwn6SWIEFuYWx5emluZyB7bGVuKGRldGVjdGlvbnMpfSBvYmplY3RzIGluIHNjZW5lICgxIGltYWdlICsgYmJveGVzKS4uLiIpCiAgICAgICAgCiAgICAgICAgIyBFbmNvZGUgT05MWSB0aGUgc2NlbmUgaW1hZ2UgKDEgaW1hZ2UgdG90YWwpCiAgICAgICAgc2NlbmVfZGF0YSA9IHNlbGYuX2VuY29kZV9pbWFnZShzY2VuZV9wYXRoKQogICAgICAgIAogICAgICAgICMgQnVpbGQgYmJveCBkZXNjcmlwdGlvbnMgZm9yIHByb21wdAogICAgICAgIGJib3hfZGVzY3JpcHRpb25zID0gW10KICAgICAgICBmb3IgaSwgZGV0IGluIGVudW1lcmF0ZShkZXRlY3Rpb25zKToKICAgICAgICAgICAgeCwgeSwgdywgaCA9IGRldFsnYmJveCddCiAgICAgICAgICAgIGFyZWEgPSBkZXQuZ2V0KCdhcmVhJywgdyAqIGgpCiAgICAgICAgICAgIGNvbmYgPSBkZXQuZ2V0KCdjb25maWRlbmNlJywgMC4wKQogICAgICAgICAgICBiYm94X2Rlc2NyaXB0aW9ucy5hcHBlbmQoCiAgICAgICAgICAgICAgICBmIk9iamV0byB7aSsxfTogYmJveCBbeD17eH0sIHk9e3l9LCBhbmNobz17d30sIGFsdG89e2h9XSwgIgogICAgICAgICAgICAgICAgZiLDoXJlYT17YXJlYX1weMKyLCBjb25maWFuemE9e2NvbmY6LjJmfSIKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgICMgQ3JlYXRlIHByb21wdCB3aXRoIGJib3ggbGlzdAogICAgICAgIHByb21wdCA9IHNlbGYuX2NyZWF0ZV9iYm94X2FuYWx5c2lzX3Byb21wdChiYm94X2Rlc2NyaXB0aW9ucywgbGVuKGRldGVjdGlvbnMpLCBsYW5ndWFnZSkKICAgICAgICAKICAgICAgICAjIEJ1aWxkIEFQSSBtZXNzYWdlICgxIGltYWdlICsgdGV4dCkKICAgICAgICBjb250ZW50ID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJpbWFnZSIsCiAgICAgICAgICAgICAgICAic291cmNlIjogc2NlbmVfZGF0YQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICJ0ZXh0IjogcHJvbXB0CiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFNpbmdsZSBBUEkgY2FsbCB3aXRoIDEgaW1hZ2UKICAgICAgICAgICAgbWVzc2FnZSA9IHNlbGYuY2xpZW50Lm1lc3NhZ2VzLmNyZWF0ZSgKICAgICAgICAgICAgICAgIG1vZGVsPXNlbGYubW9kZWwsCiAgICAgICAgICAgICAgICBtYXhfdG9rZW5zPXNlbGYubWF4X3Rva2VucywKICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlPXNlbGYudGVtcGVyYXR1cmUsCiAgICAgICAgICAgICAgICBtZXNzYWdlcz1bewogICAgICAgICAgICAgICAgICAgICJyb2xlIjogInVzZXIiLAogICAgICAgICAgICAgICAgICAgICJjb250ZW50IjogY29udGVudAogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBQYXJzZSByZXNwb25zZQogICAgICAgICAgICByZXNwb25zZV90ZXh0ID0gbWVzc2FnZS5jb250ZW50WzBdLnRleHQuc3RyaXAoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaGVjayBpZiByZXNwb25zZSB3YXMgdHJ1bmNhdGVkCiAgICAgICAgICAgIGlmIGhhc2F0dHIobWVzc2FnZSwgJ3N0b3BfcmVhc29uJykgYW5kIG1lc3NhZ2Uuc3RvcF9yZWFzb24gPT0gJ21heF90b2tlbnMnOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiLimqDvuI8gIFJlc3BvbnNlIHRydW5jYXRlZCAobWF4X3Rva2VucyByZWFjaGVkKS4gQ29uc2lkZXIgaW5jcmVhc2luZyBtYXhfdG9rZW5zIG9yIHJlZHVjaW5nIG9iamVjdCBjb3VudC4iKQogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgICBSZXNwb25zZSBsZW5ndGg6IHtsZW4ocmVzcG9uc2VfdGV4dCl9IGNoYXJzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdHMgPSBzZWxmLl9wYXJzZV9iYXRjaF9yZXNwb25zZShyZXNwb25zZV90ZXh0LCBsZW4oZGV0ZWN0aW9ucykpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBDbGF1ZGUgYW5hbHl6ZWQge2xlbihyZXN1bHRzKX0gb2JqZWN0cyAoMSBBUEkgY2FsbCwgMSBpbWFnZSkiKQogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgICAgICAKICAgICAgICBleGNlcHQgYW50aHJvcGljLkFQSUVycm9yIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkNsYXVkZSBBUEkgZXJyb3I6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfZmFsbGJhY2tfYmF0Y2gobGVuKGRldGVjdGlvbnMpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbigiVW5leHBlY3RlZCBlcnJvciBpbiBzY2VuZSBhbmFseXNpcyIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfZmFsbGJhY2tfYmF0Y2gobGVuKGRldGVjdGlvbnMpKQogICAgCiAgICBkZWYgX2VuY29kZV9pbWFnZShzZWxmLCBpbWFnZV9wYXRoOiBzdHIpIC0+IERpY3Rbc3RyLCBzdHJdOgogICAgICAgICIiIkVuY29kZSBpbWFnZSB0byBiYXNlNjQgd2l0aCBwcm9wZXIgbWVkaWEgdHlwZS4iIiIKICAgICAgICB3aXRoIG9wZW4oaW1hZ2VfcGF0aCwgInJiIikgYXMgZjoKICAgICAgICAgICAgaW1hZ2VfZGF0YSA9IGJhc2U2NC5iNjRlbmNvZGUoZi5yZWFkKCkpLmRlY29kZSgndXRmLTgnKQogICAgICAgIAogICAgICAgIHN1ZmZpeCA9IFBhdGgoaW1hZ2VfcGF0aCkuc3VmZml4Lmxvd2VyKCkKICAgICAgICBtZWRpYV90eXBlX21hcCA9IHsKICAgICAgICAgICAgJy5qcGcnOiAnaW1hZ2UvanBlZycsCiAgICAgICAgICAgICcuanBlZyc6ICdpbWFnZS9qcGVnJywKICAgICAgICAgICAgJy5wbmcnOiAnaW1hZ2UvcG5nJywKICAgICAgICAgICAgJy53ZWJwJzogJ2ltYWdlL3dlYnAnCiAgICAgICAgfQogICAgICAgIG1lZGlhX3R5cGUgPSBtZWRpYV90eXBlX21hcC5nZXQoc3VmZml4LCAnaW1hZ2UvanBlZycpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInR5cGUiOiAiYmFzZTY0IiwKICAgICAgICAgICAgIm1lZGlhX3R5cGUiOiBtZWRpYV90eXBlLAogICAgICAgICAgICAiZGF0YSI6IGltYWdlX2RhdGEsCiAgICAgICAgfQogICAgCiAgICBkZWYgX2NyZWF0ZV9iYm94X2FuYWx5c2lzX3Byb21wdCgKICAgICAgICBzZWxmLAogICAgICAgIGJib3hfZGVzY3JpcHRpb25zOiBMaXN0W3N0cl0sCiAgICAgICAgbnVtX29iamVjdHM6IGludCwKICAgICAgICBsYW5ndWFnZTogc3RyCiAgICApIC0+IHN0cjoKICAgICAgICAiIiJDcmVhdGUgcHJvbXB0IGZvciBzY2VuZSBhbmFseXNpcyB3aXRoIGJvdW5kaW5nIGJveGVzLiIiIgogICAgICAgIGJib3hlc190ZXh0ID0gIlxuIi5qb2luKGJib3hfZGVzY3JpcHRpb25zKQogICAgICAgIAogICAgICAgIGlmIGxhbmd1YWdlID09ICJzcGFuaXNoIjoKICAgICAgICAgICAgcmV0dXJuIGYiIiJBbmFsaXphIGVzdGEgZXNjZW5hIGRlIHVuIHB1bnRvIGxpbXBpbyAoY2VudHJvIGRlIHJlY2ljbGFqZSkuCgpIZSBkZXRlY3RhZG8gYXV0b23DoXRpY2FtZW50ZSB7bnVtX29iamVjdHN9IG9iamV0b3MuIFBhcmEgQ0FEQSBvYmpldG8sIG1pcmEgbGEgcmVnacOzbiBpbmRpY2FkYSBwb3Igc3VzIGNvb3JkZW5hZGFzIGVuIGxhIGltYWdlbjoKCntiYm94ZXNfdGV4dH0KClJlc3BvbmRlIEVYQ0xVU0lWQU1FTlRFIGNvbiBhcnJheSBKU09OIChzaW4gbWFya2Rvd24sIHNpbiBgYGBqc29uKToKClsKICB7eyJuIjoxLCAidXNlZnVsIjoieWVzIiwgIm5hbWUiOiJub21icmUgZXNwZWPDrWZpY28gZGVsIG9iamV0byIsICJjYXRlZ29yeSI6ImNhdGVnb3LDrWEiLCAiY29uZGl0aW9uIjoiZXhjZWxsZW50L2dvb2QvZmFpci9wb29yIiwgImRlc2NyaXB0aW9uIjoiZGVzY3JpcGNpw7NuIGRldGFsbGFkYSBlbiBlc3Bhw7FvbCAoMi0zIGZyYXNlcykiLCAiZXN0aW1hdGVkX3ZhbHVlIjoicmFuZ28gb3BjaW9uYWwgZW4gZXVyb3MifX0sCiAge3sibiI6MiwgInVzZWZ1bCI6Im5vIiwgInJlYXNvbiI6InBvciBxdcOpIG5vIGVzIMO6dGlsIn19LAogIC4uLgpdCgpDUklURVJJT1MgRVNUUklDVE9TOgoKInVzZWZ1bCI6ICJ5ZXMiIFNPTE8gU0k6CuKchSBPYmpldG8gQ09NUExFVE8geSBmdW5jaW9uYWwgKG5vIGZyYWdtZW50bykK4pyFIFRpZW5lIGlkZW50aWRhZCBjbGFyYSB5IGVzcGVjw61maWNhIChOTyAic3VwZXJmaWNpZSBibGFuY2EiLCAiY29zYSBncmlzIiwgIm9iamV0byByZWN0YW5ndWxhciIpCuKchSBBbGd1aWVuIHF1ZXJyw61hIGxsZXbDoXJzZWxvIHBhcmEgcmV1dGlsaXphcgrinIUgTk8gZXMgZm9uZG8vbW9iaWxpYXJpbyBkZWwgcHVudG8gbGltcGlvIChtZXNhLCBwYXJlZCwgc3VlbG8sIHNvbWJyYSkKCiJ1c2VmdWwiOiAibm8iIFNJOgrinYwgQmFzdXJhLCBwYXBlbCBhcnJ1Z2FkbywgZW52b2x0b3JpbwrinYwgRnJhZ21lbnRvIGluY29tcGxldG8gKGhvamEgc3VlbHRhLCBjYWJsZSBzaW4gZGlzcG9zaXRpdm8sIGVzcXVpbmEgZGUgb2JqZXRvKQrinYwgRm9uZG8vbW9iaWxpYXJpbyBkZWwgcHVudG8gbGltcGlvIChtZXNhLCBwYXJlZCwgc3VlbG8sIHNvbWJyYSkK4p2MIFBhcnRlcyBkZSBwbGFudGEgKGhvamFzIHN1ZWx0YXMpCuKdjCBNdXkgZGV0ZXJpb3JhZG8gc2luIHBvc2liaWxpZGFkIGRlIHVzbwrinYwgTm9tYnJlIGdlbsOpcmljbyAoInN1cGVyZmljaWUiLCAiZXNxdWluYSIsICJib3JkZSIsICJmcmFnbWVudG8iKQoKQ0FURUdPUsONQVMgVsOBTElEQVM6CmZ1cm5pdHVyZSwgZWxlY3Ryb25pY3MsIGJvb2tzLCB0b29scywga2l0Y2hlbndhcmUsIHNwb3J0cywgdG95cywgZGVjb3JhdGlvbiwgY2xvdGhpbmcsIGNvbnRhaW5lcnMsIG90aGVyCgpDT05ESUNJw5NOOgotIGV4Y2VsbGVudDogQ29tbyBudWV2bywgc2luIGRlZmVjdG9zCi0gZ29vZDogQnVlbiBlc3RhZG8sIHVzbyBub3JtYWwKLSBmYWlyOiBBY2VwdGFibGUsIHNpZ25vcyBkZSBkZXNnYXN0ZQotIHBvb3I6IERldGVyaW9yYWRvLCBuZWNlc2l0YSByZXBhcmFjacOzbgoKSU1QT1JUQU5URToKLSBSZXNwb25kZSBwYXJhIFRPRE9TIGxvcyB7bnVtX29iamVjdHN9IG9iamV0b3MgKG7Dum1lcm9zIDEgYSB7bnVtX29iamVjdHN9KQotIFPDqSBFU1RSSUNUTzogc2kgZHVkYXMsIG1hcmNhICJ1c2VmdWwiOiAibm8iCi0gU2kgdXNlZnVsPSJ5ZXMiIGluY2x1eWUgdG9kb3MgbG9zIGNhbXBvcyAobmFtZSwgY2F0ZWdvcnksIGNvbmRpdGlvbiwgZGVzY3JpcHRpb24sIGVzdGltYXRlZF92YWx1ZSkKLSBTaSB1c2VmdWw9Im5vIiBzb2xvIGluY2x1eWUgbiB5IHJlYXNvbgotIE5PIGluY2x1eWFzIG1hcmtkb3duIChgYGBqc29uKQotIE5PIGluY2x1eWFzIHRleHRvIGFkaWNpb25hbCBmdWVyYSBkZWwgYXJyYXkgSlNPTgotIEVsIGFycmF5IGRlYmUgdGVuZXIgZXhhY3RhbWVudGUge251bV9vYmplY3RzfSBlbGVtZW50b3MiIiIKICAgICAgICBlbHNlOiAgIyBFbmdsaXNoCiAgICAgICAgICAgIHJldHVybiBmIiIiQW5hbHl6ZSB0aGlzIHJlY3ljbGluZyBjZW50ZXIgc2NlbmUuCgpJJ3ZlIGF1dG9tYXRpY2FsbHkgZGV0ZWN0ZWQge251bV9vYmplY3RzfSBvYmplY3RzLiBGb3IgRUFDSCBvYmplY3QsIGxvb2sgYXQgdGhlIHJlZ2lvbiBpbmRpY2F0ZWQgYnkgaXRzIGNvb3JkaW5hdGVzIGluIHRoZSBpbWFnZToKCntiYm94ZXNfdGV4dH0KClJlc3BvbmQgRVhDTFVTSVZFTFkgd2l0aCBKU09OIGFycmF5IChubyBtYXJrZG93biwgbm8gYGBganNvbik6CgpbCiAge3sibiI6MSwgInVzZWZ1bCI6InllcyIsICJuYW1lIjoic3BlY2lmaWMgb2JqZWN0IG5hbWUiLCAiY2F0ZWdvcnkiOiJjYXRlZ29yeSIsICJjb25kaXRpb24iOiJleGNlbGxlbnQvZ29vZC9mYWlyL3Bvb3IiLCAiZGVzY3JpcHRpb24iOiJkZXRhaWxlZCBkZXNjcmlwdGlvbiAoMi0zIHNlbnRlbmNlcykiLCAiZXN0aW1hdGVkX3ZhbHVlIjoib3B0aW9uYWwgcHJpY2UgcmFuZ2UifX0sCiAge3sibiI6MiwgInVzZWZ1bCI6Im5vIiwgInJlYXNvbiI6IndoeSBub3QgdXNlZnVsIn19LAogIC4uLgpdCgpTVFJJQ1QgQ1JJVEVSSUE6CgoidXNlZnVsIjogInllcyIgT05MWSBJRjoK4pyFIENvbXBsZXRlIGFuZCBmdW5jdGlvbmFsIG9iamVjdCAobm90IGZyYWdtZW50KQrinIUgQ2xlYXIsIHNwZWNpZmljIGlkZW50aXR5IChOT1QgIndoaXRlIHN1cmZhY2UiLCAiZ3JheSB0aGluZyIsICJyZWN0YW5ndWxhciBvYmplY3QiKQrinIUgU29tZW9uZSB3b3VsZCB3YW50IHRvIHRha2UgaXQgZm9yIHJldXNlCuKchSBOT1QgYmFja2dyb3VuZC9mdXJuaXR1cmUgb2YgcmVjeWNsaW5nIGNlbnRlciAodGFibGUsIHdhbGwsIGZsb29yLCBzaGFkb3cpCgoidXNlZnVsIjogIm5vIiBJRjoK4p2MIFRyYXNoLCBjcnVtcGxlZCBwYXBlciwgd3JhcHBlcgrinYwgSW5jb21wbGV0ZSBmcmFnbWVudCAobG9vc2Ugc2hlZXQsIGNhYmxlIHdpdGhvdXQgZGV2aWNlLCBvYmplY3QgY29ybmVyKQrinYwgQmFja2dyb3VuZC9mdXJuaXR1cmUgb2YgcmVjeWNsaW5nIGNlbnRlciAodGFibGUsIHdhbGwsIGZsb29yLCBzaGFkb3cpCuKdjCBQbGFudCBwYXJ0cyAobG9vc2UgbGVhdmVzKQrinYwgVG9vIGRldGVyaW9yYXRlZCB3aXRob3V0IHBvc3NpYmlsaXR5IG9mIHVzZQrinYwgR2VuZXJpYyBuYW1lICgic3VyZmFjZSIsICJjb3JuZXIiLCAiZWRnZSIsICJmcmFnbWVudCIpCgpWQUxJRCBDQVRFR09SSUVTOgpmdXJuaXR1cmUsIGVsZWN0cm9uaWNzLCBib29rcywgdG9vbHMsIGtpdGNoZW53YXJlLCBzcG9ydHMsIHRveXMsIGRlY29yYXRpb24sIGNsb3RoaW5nLCBjb250YWluZXJzLCBvdGhlcgoKQ09ORElUSU9OOgotIGV4Y2VsbGVudDogTGlrZSBuZXcsIG5vIGRlZmVjdHMKLSBnb29kOiBHb29kIGNvbmRpdGlvbiwgbm9ybWFsIHdlYXIKLSBmYWlyOiBBY2NlcHRhYmxlLCBzaWducyBvZiB3ZWFyCi0gcG9vcjogRGV0ZXJpb3JhdGVkLCBuZWVkcyByZXBhaXIKCklNUE9SVEFOVDoKLSBSZXNwb25kIGZvciBBTEwge251bV9vYmplY3RzfSBvYmplY3RzIChudW1iZXJzIDEgdG8ge251bV9vYmplY3RzfSkKLSBCZSBTVFJJQ1Q6IGlmIGluIGRvdWJ0LCBtYXJrICJ1c2VmdWwiOiAibm8iCi0gSWYgdXNlZnVsPSJ5ZXMiIGluY2x1ZGUgYWxsIGZpZWxkcyAobmFtZSwgY2F0ZWdvcnksIGNvbmRpdGlvbiwgZGVzY3JpcHRpb24sIGVzdGltYXRlZF92YWx1ZSkKLSBJZiB1c2VmdWw9Im5vIiBvbmx5IGluY2x1ZGUgbiBhbmQgcmVhc29uCi0gTk8gbWFya2Rvd24gKGBgYGpzb24pCi0gTk8gYWRkaXRpb25hbCB0ZXh0IG91dHNpZGUgSlNPTiBhcnJheQotIEFycmF5IG11c3QgaGF2ZSBleGFjdGx5IHtudW1fb2JqZWN0c30gZWxlbWVudHMiIiIKICAgIAogICAgZGVmIF9wYXJzZV9iYXRjaF9yZXNwb25zZShzZWxmLCByZXNwb25zZV90ZXh0OiBzdHIsIGV4cGVjdGVkX2NvdW50OiBpbnQpIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgICAgICIiIlBhcnNlIENsYXVkZSdzIGJhdGNoIEpTT04gcmVzcG9uc2UuIiIiCiAgICAgICAgIyBSZW1vdmUgbWFya2Rvd24gY29kZSBibG9ja3MgaWYgcHJlc2VudAogICAgICAgIHRleHQgPSByZXNwb25zZV90ZXh0LnN0cmlwKCkKICAgICAgICAKICAgICAgICAjIFRyeSB0byBleHRyYWN0IEpTT04gZnJvbSBtYXJrZG93biBjb2RlIGJsb2NrcwogICAgICAgIGlmICdgYGAnIGluIHRleHQ6CiAgICAgICAgICAgIHBhcnRzID0gdGV4dC5zcGxpdCgnYGBgJykKICAgICAgICAgICAgZm9yIHBhcnQgaW4gcGFydHM6CiAgICAgICAgICAgICAgICBwYXJ0ID0gcGFydC5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiBwYXJ0LnN0YXJ0c3dpdGgoJ2pzb24nKToKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gcGFydFs0Ol0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIHBhcnQuc3RhcnRzd2l0aCgnWycpOgogICAgICAgICAgICAgICAgICAgIHRleHQgPSBwYXJ0CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICAjIEZpbmQgSlNPTiBhcnJheSAobWF5IGhhdmUgdGV4dCBiZWZvcmUvYWZ0ZXIpCiAgICAgICAgc3RhcnRfaWR4ID0gdGV4dC5maW5kKCdbJykKICAgICAgICBlbmRfaWR4ID0gdGV4dC5yZmluZCgnXScpCiAgICAgICAgCiAgICAgICAgaWYgc3RhcnRfaWR4ID09IC0xIG9yIGVuZF9pZHggPT0gLTEgb3IgZW5kX2lkeCA8PSBzdGFydF9pZHg6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiTm8gSlNPTiBhcnJheSBmb3VuZCBpbiByZXNwb25zZSIpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlJlc3BvbnNlIHByZXZpZXcgKGZpcnN0IDEwMDAgY2hhcnMpOiB7dGV4dFs6MTAwMF19IikKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiUmVzcG9uc2UgbGVuZ3RoOiB7bGVuKHRleHQpfSBjaGFycyIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jcmVhdGVfZmFsbGJhY2tfYmF0Y2goZXhwZWN0ZWRfY291bnQpCiAgICAgICAgCiAgICAgICAganNvbl90ZXh0ID0gdGV4dFtzdGFydF9pZHg6ZW5kX2lkeCArIDFdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHRzID0ganNvbi5sb2Fkcyhqc29uX3RleHQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShyZXN1bHRzLCBsaXN0KToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkV4cGVjdGVkIGxpc3QsIGdvdCB7dHlwZShyZXN1bHRzKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9mYWxsYmFja19iYXRjaChleHBlY3RlZF9jb3VudCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmFsaWRhdGUgYW5kIG5vcm1hbGl6ZSByZXN1bHRzCiAgICAgICAgICAgIG5vcm1hbGl6ZWQgPSBbXQogICAgICAgICAgICBmb3IgaSwgcmVzdWx0IGluIGVudW1lcmF0ZShyZXN1bHRzKToKICAgICAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHJlc3VsdCwgZGljdCk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJSZXN1bHQge2l9IGlzIG5vdCBhIGRpY3QsIHNraXBwaW5nIikKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEVuc3VyZSAnbicgZmllbGQgbWF0Y2hlcyBpbmRleAogICAgICAgICAgICAgICAgaWYgJ24nIG5vdCBpbiByZXN1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0WyduJ10gPSBpICsgMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE5vcm1hbGl6ZSB1c2VmdWwgZmllbGQKICAgICAgICAgICAgICAgIGlmICd1c2VmdWwnIG5vdCBpbiByZXN1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Wyd1c2VmdWwnXSA9ICdubycKICAgICAgICAgICAgICAgICAgICByZXN1bHRbJ3JlYXNvbiddID0gJ01pc3NpbmcgdXNlZnVsIGZpZWxkJwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBub3JtYWxpemVkLmFwcGVuZChyZXN1bHQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBsZW4obm9ybWFsaXplZCkgIT0gZXhwZWN0ZWRfY291bnQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygKICAgICAgICAgICAgICAgICAgICBmIkV4cGVjdGVkIHtleHBlY3RlZF9jb3VudH0gcmVzdWx0cywgZ290IHtsZW4obm9ybWFsaXplZCl9LiAiCiAgICAgICAgICAgICAgICAgICAgIlBhZGRpbmcgd2l0aCBmYWxsYmFjayBlbnRyaWVzLiIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHdoaWxlIGxlbihub3JtYWxpemVkKSA8IGV4cGVjdGVkX2NvdW50OgogICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWQuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ24nOiBsZW4obm9ybWFsaXplZCkgKyAxLAogICAgICAgICAgICAgICAgICAgICAgICAndXNlZnVsJzogJ25vJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlYXNvbic6ICdNaXNzaW5nIGZyb20gQ2xhdWRlIHJlc3BvbnNlJwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplZFs6ZXhwZWN0ZWRfY291bnRdCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvciBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gcGFyc2UgSlNPTjoge2V9IikKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRXJyb3IgYXQgcG9zaXRpb24ge2UucG9zfToge2UubXNnfSIpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkpTT04gdGV4dCBhcm91bmQgZXJyb3IgKGNoYXJzIHttYXgoMCwgZS5wb3MtMTAwKX0te21pbihsZW4oanNvbl90ZXh0KSwgZS5wb3MrMTAwKX0pOiB7anNvbl90ZXh0W21heCgwLCBlLnBvcy0xMDApOm1pbihsZW4oanNvbl90ZXh0KSwgZS5wb3MrMTAwKV19IikKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiRnVsbCBKU09OIHRleHQgbGVuZ3RoOiB7bGVuKGpzb25fdGV4dCl9IGNoYXJzIikKICAgICAgICAgICAgIyBUcnkgdG8gc2F2ZSByZXNwb25zZSBmb3IgZGVidWdnaW5nCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGltcG9ydCBvcwogICAgICAgICAgICAgICAgZGVidWdfZmlsZSA9ICJjbGF1ZGVfcmVzcG9uc2VfZGVidWcudHh0IgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGRlYnVnX2ZpbGUsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiT3JpZ2luYWwgcmVzcG9uc2U6XG57cmVzcG9uc2VfdGV4dH1cblxuIikKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiRXh0cmFjdGVkIEpTT046XG57anNvbl90ZXh0fVxuIikKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlNhdmVkIGRlYnVnIHJlc3BvbnNlIHRvIHtkZWJ1Z19maWxlfSIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NyZWF0ZV9mYWxsYmFja19iYXRjaChleHBlY3RlZF9jb3VudCkKICAgIAogICAgZGVmIF9jcmVhdGVfZmFsbGJhY2tfYmF0Y2goc2VsZiwgY291bnQ6IGludCkgLT4gTGlzdFtEaWN0W3N0ciwgQW55XV06CiAgICAgICAgIiIiQ3JlYXRlIGZhbGxiYWNrIGJhdGNoIHJlc3VsdHMgaWYgQ2xhdWRlIGZhaWxzLiIiIgogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICduJzogaSArIDEsCiAgICAgICAgICAgICAgICAndXNlZnVsJzogJ25vJywKICAgICAgICAgICAgICAgICdyZWFzb24nOiAnQW5hbHlzaXMgZmFpbGVkLiBQbGVhc2UgcmV2aWV3IG1hbnVhbGx5LicsCiAgICAgICAgICAgICAgICAnZXJyb3InOiBUcnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoY291bnQpCiAgICAgICAgXQogICAgCiAgICBkZWYgYW5hbHl6ZV9zY2VuZV93aXRoX3ZhbGlkYXRpb24oCiAgICAgICAgc2VsZiwKICAgICAgICBzY2VuZV9wYXRoOiBzdHIsCiAgICAgICAgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0sCiAgICAgICAgbGFuZ3VhZ2U6IHN0ciA9ICJzcGFuaXNoIgogICAgKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBBbmFseXplIHNjZW5lIHdpdGggdmFsaWRhdGlvbiBhbmQgbWlzc2luZyBvYmplY3QgZGV0ZWN0aW9uLgogICAgICAgIAogICAgICAgIENsYXVkZSB2YWxpZGF0ZXMgZGV0ZWN0ZWQgb2JqZWN0cyBBTkQgc3VnZ2VzdHMgbWlzc2luZyBvYmplY3RzCiAgICAgICAgdGhhdCBTQU0gZGlkbid0IGRldGVjdCAoZS5nLiwgd2hpdGUgb2JqZWN0cyBvbiBsaWdodCBiYWNrZ3JvdW5kcykuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2NlbmVfcGF0aDogUGF0aCB0byBjb21wbGV0ZSBzY2VuZSBpbWFnZQogICAgICAgICAgICBkZXRlY3Rpb25zOiBMaXN0IG9mIFNBTSBkZXRlY3Rpb25zIHdpdGggYmJveCwgYXJlYSwgY29uZmlkZW5jZQogICAgICAgICAgICBsYW5ndWFnZTogUmVzcG9uc2UgbGFuZ3VhZ2UKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdCB3aXRoOgogICAgICAgICAgICAtIHZhbGlkYXRlZF9vYmplY3RzOiBMaXN0IG9mIHZhbGlkYXRlZCBhbmFseXNlcyAoc2FtZSBmb3JtYXQgYXMgYW5hbHl6ZV9zY2VuZV93aXRoX2Jib3hlcykKICAgICAgICAgICAgLSBtaXNzaW5nX29iamVjdHM6IExpc3Qgb2YgbWlzc2luZyBvYmplY3RzIHdpdGggYXBwcm94aW1hdGUgYmJveGVzCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5SNIFZhbGlkYXRpbmcge2xlbihkZXRlY3Rpb25zKX0gb2JqZWN0cyArIHNlYXJjaGluZyBmb3IgbWlzc2luZyBvYmplY3RzLi4uIikKICAgICAgICAKICAgICAgICAjIEVuY29kZSBzY2VuZSBpbWFnZQogICAgICAgIHNjZW5lX2RhdGEgPSBzZWxmLl9lbmNvZGVfaW1hZ2Uoc2NlbmVfcGF0aCkKICAgICAgICAKICAgICAgICAjIEdldCBpbWFnZSBkaW1lbnNpb25zIGZvciByZWxhdGl2ZSBzaXplIGNhbGN1bGF0aW9uCiAgICAgICAgaW1wb3J0IGN2MgogICAgICAgIGltZyA9IGN2Mi5pbXJlYWQoc2NlbmVfcGF0aCkKICAgICAgICBpbWdfaGVpZ2h0LCBpbWdfd2lkdGggPSBpbWcuc2hhcGVbOjJdIGlmIGltZyBpcyBub3QgTm9uZSBlbHNlICg5NjAsIDEyODApCiAgICAgICAgdG90YWxfcGl4ZWxzID0gaW1nX3dpZHRoICogaW1nX2hlaWdodAogICAgICAgIAogICAgICAgICMgQnVpbGQgYmJveCBkZXNjcmlwdGlvbnMgd2l0aCBkZXRhaWxlZCBpbmZvIGluY2x1ZGluZyByZWxhdGl2ZSBzaXplCiAgICAgICAgYmJveF9kZXNjcmlwdGlvbnMgPSBbXQogICAgICAgIGxvZ2dlci5pbmZvKGYi8J+TpCBQcmVwYXJhbmRvIHtsZW4oZGV0ZWN0aW9ucyl9IG9iamV0b3MgcGFyYSBDbGF1ZGU6IikKICAgICAgICBmb3IgaSwgZGV0IGluIGVudW1lcmF0ZShkZXRlY3Rpb25zKToKICAgICAgICAgICAgeCwgeSwgdywgaCA9IGRldFsnYmJveCddCiAgICAgICAgICAgIGFyZWEgPSBkZXQuZ2V0KCdhcmVhJywgdyAqIGgpCiAgICAgICAgICAgIGNvbmYgPSBkZXQuZ2V0KCdjb25maWRlbmNlJywgMC4wKQogICAgICAgICAgICBhcmVhX3BlcmNlbnQgPSAoYXJlYSAvIHRvdGFsX3BpeGVscykgKiAxMDAgaWYgdG90YWxfcGl4ZWxzID4gMCBlbHNlIDAKICAgICAgICAgICAgYmJveF9kZXNjcmlwdGlvbnMuYXBwZW5kKAogICAgICAgICAgICAgICAgZiJPYmpldG8ge2krMX06IGJib3ggW3g9e3h9LCB5PXt5fSwgYW5jaG89e3d9LCBhbHRvPXtofV0sICIKICAgICAgICAgICAgICAgIGYiw6FyZWE9e2FyZWF9cHjCsiAoe2FyZWFfcGVyY2VudDouMWZ9JSBkZSBsYSBpbWFnZW4pLCBjb25maWFuemE9e2NvbmY6LjJmfSIKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIiAgIE9iamV0byB7aSsxfTogYmJveD0oe3h9LHt5fSx7d30se2h9KSwgw6FyZWE9e2FyZWF9cHjCsiAoe2FyZWFfcGVyY2VudDouMWZ9JSksIGNvbmY9e2NvbmY6LjNmfSIpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oIiIpCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgdmFsaWRhdGlvbiBwcm9tcHQKICAgICAgICBwcm9tcHQgPSBzZWxmLl9jcmVhdGVfdmFsaWRhdGlvbl9wcm9tcHQoYmJveF9kZXNjcmlwdGlvbnMsIGxlbihkZXRlY3Rpb25zKSwgbGFuZ3VhZ2UpCiAgICAgICAgCiAgICAgICAgIyBCdWlsZCBBUEkgbWVzc2FnZQogICAgICAgIGNvbnRlbnQgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogImltYWdlIiwKICAgICAgICAgICAgICAgICJzb3VyY2UiOiBzY2VuZV9kYXRhCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogInRleHQiLAogICAgICAgICAgICAgICAgInRleHQiOiBwcm9tcHQKICAgICAgICAgICAgfQogICAgICAgIF0KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1lc3NhZ2UgPSBzZWxmLmNsaWVudC5tZXNzYWdlcy5jcmVhdGUoCiAgICAgICAgICAgICAgICBtb2RlbD1zZWxmLm1vZGVsLAogICAgICAgICAgICAgICAgbWF4X3Rva2Vucz1zZWxmLm1heF90b2tlbnMsCiAgICAgICAgICAgICAgICB0ZW1wZXJhdHVyZT1zZWxmLnRlbXBlcmF0dXJlLAogICAgICAgICAgICAgICAgbWVzc2FnZXM9W3sKICAgICAgICAgICAgICAgICAgICAicm9sZSI6ICJ1c2VyIiwKICAgICAgICAgICAgICAgICAgICAiY29udGVudCI6IGNvbnRlbnQKICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3BvbnNlX3RleHQgPSBtZXNzYWdlLmNvbnRlbnRbMF0udGV4dC5zdHJpcCgpCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuX3BhcnNlX3ZhbGlkYXRpb25fcmVzcG9uc2UocmVzcG9uc2VfdGV4dCwgbGVuKGRldGVjdGlvbnMpKQogICAgICAgICAgICAKICAgICAgICAgICAgdmFsaWRhdGVkX2NvdW50ID0gbGVuKHJlc3VsdC5nZXQoJ3ZhbGlkYXRlZF9vYmplY3RzJywgW10pKQogICAgICAgICAgICBtaXNzaW5nX2NvdW50ID0gbGVuKHJlc3VsdC5nZXQoJ21pc3Npbmdfb2JqZWN0cycsIFtdKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIFZhbGlkYXRpb24gY29tcGxldGU6IHt2YWxpZGF0ZWRfY291bnR9IHZhbGlkYXRlZCwge21pc3NpbmdfY291bnR9IG1pc3NpbmcgZm91bmQiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDUklUSUNBTDogV2FybiBpZiBDbGF1ZGUgZGlkbid0IHZhbGlkYXRlIGFsbCBvYmplY3RzCiAgICAgICAgICAgIGlmIHZhbGlkYXRlZF9jb3VudCA8IGxlbihkZXRlY3Rpb25zKToKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYi4pqg77iPICBDbGF1ZGUgb25seSB2YWxpZGF0ZWQge3ZhbGlkYXRlZF9jb3VudH0ve2xlbihkZXRlY3Rpb25zKX0gb2JqZWN0cyEiKQogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgICBFeHBlY3RlZCB7bGVuKGRldGVjdGlvbnMpfSB2YWxpZGF0ZWQgb2JqZWN0cywgZ290IHt2YWxpZGF0ZWRfY291bnR9IikKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICAgTWlzc2luZyB7bGVuKGRldGVjdGlvbnMpIC0gdmFsaWRhdGVkX2NvdW50fSB2YWxpZGF0aW9ucyIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiQ2xhdWRlIHZhbGlkYXRpb24gZXJyb3I6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAndmFsaWRhdGVkX29iamVjdHMnOiBzZWxmLl9jcmVhdGVfZmFsbGJhY2tfYmF0Y2gobGVuKGRldGVjdGlvbnMpKSwKICAgICAgICAgICAgICAgICdtaXNzaW5nX29iamVjdHMnOiBbXQogICAgICAgICAgICB9CiAgICAKICAgIGRlZiBfY3JlYXRlX3ZhbGlkYXRpb25fcHJvbXB0KAogICAgICAgIHNlbGYsCiAgICAgICAgYmJveF9kZXNjcmlwdGlvbnM6IExpc3Rbc3RyXSwKICAgICAgICBudW1fb2JqZWN0czogaW50LAogICAgICAgIGxhbmd1YWdlOiBzdHIKICAgICkgLT4gc3RyOgogICAgICAgICIiIkNyZWF0ZSBwcm9tcHQgZm9yIHZhbGlkYXRpb24gKyBhbmFseXNpcyArIG1pc3Npbmcgb2JqZWN0IGRldGVjdGlvbiAoQUxMIElOIE9ORSkuIiIiCiAgICAgICAgYmJveGVzX3RleHQgPSAiXG4iLmpvaW4oYmJveF9kZXNjcmlwdGlvbnMpCiAgICAgICAgCiAgICAgICAgaWYgbGFuZ3VhZ2UgPT0gInNwYW5pc2giOgogICAgICAgICAgICByZXR1cm4gZiIiIkFuYWxpemEgZXN0YSBlc2NlbmEgZGUgdW4gcHVudG8gbGltcGlvLiBFbCBzaXN0ZW1hIGRldGVjdGEgVE9ETyAoc29tYnJhcywgZnJhZ21lbnRvcywgZm9uZG8pLiBUdSB0cmFiYWpvOiBpZGVudGlmaWNhciBUT0RPUyBsb3Mgb2JqZXRvcyDDunRpbGVzIGNvbXBsZXRvcy4KCkhlIGRldGVjdGFkbyB7bnVtX29iamVjdHN9IHJlZ2lvbmVzIGNvbiBlc3RhcyBjb29yZGVuYWRhczoKCntiYm94ZXNfdGV4dH0KClRBUkVBUzoKMS4gVkFMSURBUiBjYWRhIHJlZ2nDs246IG1pcmEgZWwgYmJveCBbeCwgeSwgYW5jaG8sIGFsdG9dLCBpZGVudGlmaWNhIGVsIG9iamV0byB1c2FuZG8gZWwgdGFtYcOxbyBjb21vIGNvbnRleHRvOgogICAtIEdyYW5kZXMgKDUtMTUlKTogbXVlYmxlcywgZWxlY3Ryb2RvbcOpc3RpY29zCiAgIC0gTWVkaWFub3MgKDEtNSUpOiBsaWJyb3MsIGJvbHNvcywgcm9wYSwgY29udGVuZWRvcmVzCiAgIC0gUGVxdWXDsW9zICgwLjEtMSUpOiBmcmFzY29zLCBib3RlbGxhcywganVndWV0ZXMsIG9iamV0b3MgZGVjb3JhdGl2b3MKICAgLSA8MC4xJTogZnJhZ21lbnRvcyAocmVjaGF6YXIpCiAgIAogICBTaSB1c2VmdWw9InllcyI6IG5hbWUsIGNhdGVnb3J5LCBjb25kaXRpb24sIGRlc2NyaXB0aW9uLCBlc3RpbWF0ZWRfdmFsdWUsIGJib3ggW3gseSx3LGhdLCBiYm94X2NvbmZpZGVuY2UKICAgU2kgdXNlZnVsPSJubyI6IHJlYXNvbgoKMi4gQlVTQ0FSIG9iamV0b3MgZmFsdGFudGVzL3N1cGVycHVlc3RvcyBubyBkZXRlY3RhZG9zLgoKUmVzcG9uZGUgU09MTyBKU09OIChzaW4gbWFya2Rvd24pOgoKe3sKICAidmFsaWRhdGVkX29iamVjdHMiOiBbCiAgICB7eyJuIjogMSwgInVzZWZ1bCI6ICJ5ZXMiLCAibmFtZSI6ICJQZXNhIG5lZ3JhIiwgImNhdGVnb3J5IjogInNwb3J0cyIsICJjb25kaXRpb24iOiAiZ29vZCIsICJkZXNjcmlwdGlvbiI6ICJQZXNhIGRlIGVudHJlbmFtaWVudG8gbmVncmEgcmVkb25kYSIsICJlc3RpbWF0ZWRfdmFsdWUiOiAiMjAtNDDigqwiLCAiYmJveCI6IFt4LHksdyxoXSwgImJib3hfY29uZmlkZW5jZSI6ICJoaWdoIn19LAogICAge3sibiI6IDIsICJ1c2VmdWwiOiAibm8iLCAicmVhc29uIjogIkZyYWdtZW50byBkZSBmb25kbyJ9fSwKICAgIC4uLgogIF0sCiAgIm1pc3Npbmdfb2JqZWN0cyI6IFsKICAgIHt7Im5hbWUiOiAiZnJhc2NvIiwgImJib3giOiBbeCx5LHcsaF0sICJjYXRlZ29yeSI6ICJjb250YWluZXJzIiwgImNvbmZpZGVuY2UiOiAiaGlnaCJ9fSwKICAgIC4uLgogIF0KfX0KCkNSSVRFUklPUzoK4pyFIMOadGlsOiBvYmpldG8gY29tcGxldG8gZnVuY2lvbmFsLCBncnVwb3Mgc2ltaWxhcmVzICgiRXNwZWNpZXJvIGNvbiA2IGZyYXNjb3MiIE5PIDYgc2VwYXJhZG9zKQrinIUgw5p0aWw6IGNvbnRlbmVkb3JlcywgYm90ZWxsYXMsIGZyYXNjb3MsIG9iamV0b3MgZGVjb3JhdGl2b3MsIHBsYW50YXMsIHV0ZW5zaWxpb3MgZGUgY29jaW5hCuKdjCBObyDDunRpbDogZnJhZ21lbnRvcywgc29tYnJhcywgZm9uZG8gKHBhcmVkL3N1ZWxvL21lc2EpLCBkdXBsaWNhZG9zLCBwYXJ0ZXMgZGVsIGN1ZXJwbwoKQUdSVVBBQ0nDk04gQ1LDjVRJQ0EgKE11eSBpbXBvcnRhbnRlKToKLSBTaSBoYXkgMysgb2JqZXRvcyBzaW1pbGFyZXMgc3VwZXJwdWVzdG9zL2NlcmNhbm9zIOKGkiBhZ3J1cGEgZW4gMSBvYmpldG8gZ3J1cGFsIGNvbiBjYW50aWRhZAotIEVqZW1wbG86IFNpIHZlcyBPYmpldG9zIDMsIDQsIDUsIDYsIDcsIDgsIDkgcXVlIHNvbiA3IGZyYXNjb3MgZGUgZXNwZWNpYXMganVudG9zOgogICogUmVzcG9uZGUgcGFyYSBUT0RPUzogT2JqZXRvIDMsIE9iamV0byA0LCBPYmpldG8gNSwgT2JqZXRvIDYsIE9iamV0byA3LCBPYmpldG8gOCwgT2JqZXRvIDkKICAqIFBhcmEgZWwgUFJJTUVSIG9iamV0byBkZWwgZ3J1cG8gKGVqOiBPYmpldG8gMyk6IHVzZWZ1bD0ieWVzIiwgbmFtZT0iRXNwZWNpZXJvIGNvbiA3IGZyYXNjb3MgZGUgZXNwZWNpYXMiLCBiYm94PVtiYm94IGRlbCBncnVwbyBjb21wbGV0b10KICAqIFBhcmEgbG9zIGRlbcOhcyBkZWwgZ3J1cG8gKGVqOiBPYmpldG9zIDQtOSk6IHVzZWZ1bD0ibm8iLCByZWFzb249IkFncnVwYWRvIGVuIEVzcGVjaWVybyBjb24gNyBmcmFzY29zIgoKQkJPWCBQQVJBIE9CSkVUT1MgQUdSVVBBRE9TIChDUsONVElDTyk6Ci0gU2kgYWdydXBhcyBvYmpldG9zOiBlbCBiYm94IGRlbCBvYmpldG8gYWdydXBhZG8gZGViZSBjdWJyaXIgVE9ETyBlbCBncnVwbyBjb21wbGV0bwotIEVqZW1wbG86IFNpIGFncnVwYXMgT2JqZXRvcyAzLCA0LCA1LCA2LCA3LCA4LCA5IGVuICJFc3BlY2llcm8gY29uIDcgZnJhc2NvcyI6CiAgKiBDYWxjdWxhIGVsIGJib3ggcXVlIGNvbnRpZW5lIFRPRE9TIGxvcyBiYm94ZXMgZGUgZXNvcyBvYmpldG9zCiAgKiBtaW5feCA9IG3DrW5pbW8geCBkZSB0b2RvcyBsb3MgYmJveGVzCiAgKiBtaW5feSA9IG3DrW5pbW8geSBkZSB0b2RvcyBsb3MgYmJveGVzICAKICAqIG1heF94ID0gbcOheGltbyAoeCt3KSBkZSB0b2RvcyBsb3MgYmJveGVzCiAgKiBtYXhfeSA9IG3DoXhpbW8gKHkraCkgZGUgdG9kb3MgbG9zIGJib3hlcwogICogYmJveCBkZWwgZ3J1cG8gPSBbbWluX3gsIG1pbl95LCBtYXhfeC1taW5feCwgbWF4X3ktbWluX3ldCi0gRWwgYmJveCBkZWwgZ3J1cG8gZGViZSBzZXIgbcOhcyBncmFuZGUgcXVlIGN1YWxxdWllcmEgZGUgbG9zIGJib3hlcyBpbmRpdmlkdWFsZXMKCkJCT1g6IFt4LHksd2lkdGgsaGVpZ2h0XSBTSUVNUFJFIHByZXNlbnRlIHNpIHVzZWZ1bD0ieWVzIiAoT0JMSUdBVE9SSU8sIHB1ZWRlIHNlciBhcHJveGltYWRvIHBlcm8gZGViZSBleGlzdGlyKS4K4pqg77iPIENSw41USUNPOiBTaSB1c2VmdWw9InllcyIsIERFQkVTIHByb3BvcmNpb25hciBiYm94LiBTaSBhZ3J1cGFzdGUgb2JqZXRvcywgdXNhIGVsIGJib3ggZGVsIGdydXBvIGNvbXBsZXRvLgoKSU1QT1JUQU5URTogU8OpIElOQ0xVU0lWTy4gU2kgdW4gb2JqZXRvIGVzIGNsYXJhbWVudGUgdmlzaWJsZSB5IMO6dGlsLCBtw6FyY2FsbyBjb21vIHVzZWZ1bD0ieWVzIiwgaW5jbHVzbyBzaSBlcyBwZXF1ZcOxbyBvIHBhcmNpYWxtZW50ZSBvY3VsdG8uCgpSRVNQT05ERSBUT0RPUyBsb3Mge251bV9vYmplY3RzfSBvYmpldG9zLiBTw6kgSU5DTFVTSVZPIHBlcm8gSU5URUxJR0VOVEUuIiIiCiAgICAgICAgZWxzZTogICMgRW5nbGlzaAogICAgICAgICAgICByZXR1cm4gZiIiIkFuYWx5emUgdGhpcyByZWN5Y2xpbmcgY2VudGVyIHNjZW5lLiBTeXN0ZW0gZGV0ZWN0cyBFVkVSWVRISU5HIChzaGFkb3dzLCBmcmFnbWVudHMsIGJhY2tncm91bmQpLiBZb3VyIGpvYjogaWRlbnRpZnkgT05MWSBjb21wbGV0ZSB1c2VmdWwgb2JqZWN0cy4KCkkndmUgZGV0ZWN0ZWQge251bV9vYmplY3RzfSByZWdpb25zIHdpdGggdGhlc2UgY29vcmRpbmF0ZXM6Cgp7YmJveGVzX3RleHR9CgpUQVNLUzoKMS4gVkFMSURBVEUgZWFjaCByZWdpb246IGxvb2sgYXQgYmJveCBbeCwgeSwgd2lkdGgsIGhlaWdodF0sIGlkZW50aWZ5IG9iamVjdCB1c2luZyBzaXplIGFzIGNvbnRleHQ6CiAgIC0gTGFyZ2UgKDUtMTUlKTogZnVybml0dXJlLCBhcHBsaWFuY2VzCiAgIC0gTWVkaXVtICgxLTUlKTogYm9va3MsIGJhZ3MsIGNsb3RoaW5nCiAgIC0gU21hbGwgKDAuMS0xJSk6IGphcnMsIGJvdHRsZXMsIHRveXMKICAgLSA8MC4xJTogZnJhZ21lbnRzIChyZWplY3QpCiAgIAogICBJZiB1c2VmdWw9InllcyI6IG5hbWUsIGNhdGVnb3J5LCBjb25kaXRpb24sIGRlc2NyaXB0aW9uLCBlc3RpbWF0ZWRfdmFsdWUsIGJib3ggW3gseSx3LGhdLCBiYm94X2NvbmZpZGVuY2UKICAgSWYgdXNlZnVsPSJubyI6IHJlYXNvbgoKMi4gRklORCBtaXNzaW5nL292ZXJsYXBwaW5nIG9iamVjdHMgbm90IGRldGVjdGVkLgoKUmVzcG9uZCBPTkxZIEpTT04gKG5vIG1hcmtkb3duKToKCnt7CiAgInZhbGlkYXRlZF9vYmplY3RzIjogWwogICAge3sibiI6IDEsICJ1c2VmdWwiOiAieWVzIiwgIm5hbWUiOiAiQmxhY2sgd2VpZ2h0IiwgImNhdGVnb3J5IjogInNwb3J0cyIsICJjb25kaXRpb24iOiAiZ29vZCIsICJkZXNjcmlwdGlvbiI6ICJCbGFjayByb3VuZCB0cmFpbmluZyB3ZWlnaHQiLCAiZXN0aW1hdGVkX3ZhbHVlIjogIjIwLTQw4oKsIiwgImJib3giOiBbeCx5LHcsaF0sICJiYm94X2NvbmZpZGVuY2UiOiAiaGlnaCJ9fSwKICAgIHt7Im4iOiAyLCAidXNlZnVsIjogIm5vIiwgInJlYXNvbiI6ICJCYWNrZ3JvdW5kIGZyYWdtZW50In19LAogICAgLi4uCiAgXSwKICAibWlzc2luZ19vYmplY3RzIjogWwogICAge3sibmFtZSI6ICJtZWRpY2luZSBib3R0bGUiLCAiYmJveCI6IFt4LHksdyxoXSwgImNhdGVnb3J5IjogImNvbnRhaW5lcnMiLCAiY29uZmlkZW5jZSI6ICJoaWdoIn19LAogICAgLi4uCiAgXQp9fQoKQ1JJVEVSSUE6CuKchSBVc2VmdWw6IGNvbXBsZXRlIGZ1bmN0aW9uYWwgb2JqZWN0LCBzaW1pbGFyIGdyb3VwcyAoIlNwaWNlIHJhY2sgd2l0aCA2IGphcnMiIE5PVCA2IHNlcGFyYXRlKQrinYwgTm90IHVzZWZ1bDogZnJhZ21lbnRzLCBzaGFkb3dzLCBiYWNrZ3JvdW5kICh3YWxsL2Zsb29yL3RhYmxlKSwgZHVwbGljYXRlcywgYm9keSBwYXJ0cwoKR1JPVVBJTkc6IElmIDMrIHNpbWlsYXIgb3ZlcmxhcHBpbmcgb2JqZWN0cyDihpIgMSBncm91cCBvYmplY3Qgd2l0aCBxdWFudGl0eS4KCkJCT1g6IFt4LHksd2lkdGgsaGVpZ2h0XSBhbHdheXMgcHJlc2VudCBpZiB1c2VmdWw9InllcyIgKG1heSBiZSBhcHByb3hpbWF0ZSkuCgpSRVNQT05EIHRvIEFMTCB7bnVtX29iamVjdHN9IG9iamVjdHMuIE1hcmsgInVzZWZ1bCI6Im5vIiBmb3IgNjAtNzAlIChzeXN0ZW0gbm9pc2UpLiBCZSBTVFJJQ1QuIiIiCiAgICAKICAgIGRlZiBfcGFyc2VfdmFsaWRhdGlvbl9yZXNwb25zZSgKICAgICAgICBzZWxmLAogICAgICAgIHJlc3BvbnNlX3RleHQ6IHN0ciwKICAgICAgICBleHBlY3RlZF9jb3VudDogaW50CiAgICApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIlBhcnNlIENsYXVkZSdzIHZhbGlkYXRpb24gcmVzcG9uc2Ugd2l0aCB2YWxpZGF0ZWRfb2JqZWN0cyBhbmQgbWlzc2luZ19vYmplY3RzLiIiIgogICAgICAgIHRleHQgPSByZXNwb25zZV90ZXh0LnN0cmlwKCkKICAgICAgICAKICAgICAgICAjIFJlbW92ZSBtYXJrZG93bgogICAgICAgIGlmICdgYGAnIGluIHRleHQ6CiAgICAgICAgICAgIHBhcnRzID0gdGV4dC5zcGxpdCgnYGBgJykKICAgICAgICAgICAgZm9yIHBhcnQgaW4gcGFydHM6CiAgICAgICAgICAgICAgICBwYXJ0ID0gcGFydC5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiBwYXJ0LnN0YXJ0c3dpdGgoJ2pzb24nKToKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gcGFydFs0Ol0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIHBhcnQuc3RhcnRzd2l0aCgneycpOgogICAgICAgICAgICAgICAgICAgIHRleHQgPSBwYXJ0CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICAjIEZpbmQgSlNPTiBvYmplY3QKICAgICAgICBzdGFydF9pZHggPSB0ZXh0LmZpbmQoJ3snKQogICAgICAgIGVuZF9pZHggPSB0ZXh0LnJmaW5kKCd9JykKICAgICAgICAKICAgICAgICBpZiBzdGFydF9pZHggPT0gLTEgb3IgZW5kX2lkeCA9PSAtMSBvciBlbmRfaWR4IDw9IHN0YXJ0X2lkeDoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCLinYwgTm8gSlNPTiBvYmplY3QgZm91bmQgaW4gdmFsaWRhdGlvbiByZXNwb25zZSIpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIlJlc3BvbnNlIHRleHQgKGZpcnN0IDUwMCBjaGFycyk6IHt0ZXh0Wzo1MDBdfSIpCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAndmFsaWRhdGVkX29iamVjdHMnOiBbXSwKICAgICAgICAgICAgICAgICdtaXNzaW5nX29iamVjdHMnOiBbXQogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAganNvbl90ZXh0ID0gdGV4dFtzdGFydF9pZHg6ZW5kX2lkeCArIDFdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHQgPSBqc29uLmxvYWRzKGpzb25fdGV4dCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmFsaWRhdGUgc3RydWN0dXJlCiAgICAgICAgICAgIHZhbGlkYXRlZCA9IHJlc3VsdC5nZXQoJ3ZhbGlkYXRlZF9vYmplY3RzJywgW10pCiAgICAgICAgICAgIG1pc3NpbmcgPSByZXN1bHQuZ2V0KCdtaXNzaW5nX29iamVjdHMnLCBbXSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ1JJVElDQUw6IERvIE5PVCBwYWQgbWlzc2luZyBvYmplY3RzIC0gb25seSB1c2Ugd2hhdCBDbGF1ZGUgdmFsaWRhdGVkCiAgICAgICAgICAgICMgSWYgQ2xhdWRlIGRpZG4ndCB2YWxpZGF0ZSBhbiBvYmplY3QsIGl0IG1lYW5zIGl0J3MgbGlrZWx5IG5vdCB1c2VmdWwKICAgICAgICAgICAgaWYgbGVuKHZhbGlkYXRlZCkgIT0gZXhwZWN0ZWRfY291bnQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyAgRXhwZWN0ZWQge2V4cGVjdGVkX2NvdW50fSB2YWxpZGF0ZWQgb2JqZWN0cywgZ290IHtsZW4odmFsaWRhdGVkKX0iKQogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgICBDbGF1ZGUgZGlkIG5vdCB2YWxpZGF0ZSB7ZXhwZWN0ZWRfY291bnQgLSBsZW4odmFsaWRhdGVkKX0gb2JqZWN0cyIpCiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIiAgIFRoZXNlIG9iamVjdHMgd2lsbCBiZSBTS0lQUEVEIChub3Qgc2F2ZWQpIikKICAgICAgICAgICAgICAgICMgRE8gTk9UIHBhZCAtIG9ubHkgdXNlIHdoYXQgQ2xhdWRlIGFjdHVhbGx5IHZhbGlkYXRlZAogICAgICAgICAgICAKICAgICAgICAgICAgIyBWYWxpZGF0ZSBtaXNzaW5nX29iamVjdHMgZm9ybWF0CiAgICAgICAgICAgIHZhbGlkYXRlZF9taXNzaW5nID0gW10KICAgICAgICAgICAgZm9yIG1pc3NpbmcgaW4gbWlzc2luZzoKICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UobWlzc2luZywgZGljdCkgYW5kICdiYm94JyBpbiBtaXNzaW5nIGFuZCAnbmFtZScgaW4gbWlzc2luZzoKICAgICAgICAgICAgICAgICAgICBiYm94ID0gbWlzc2luZ1snYmJveCddCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShiYm94LCBsaXN0KSBhbmQgbGVuKGJib3gpID09IDQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlZF9taXNzaW5nLmFwcGVuZChtaXNzaW5nKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiSW52YWxpZCBiYm94IGZvcm1hdCBpbiBtaXNzaW5nIG9iamVjdDoge21pc3NpbmcuZ2V0KCduYW1lJyl9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJJbnZhbGlkIG1pc3Npbmcgb2JqZWN0IGZvcm1hdDoge21pc3Npbmd9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAndmFsaWRhdGVkX29iamVjdHMnOiB2YWxpZGF0ZWQsCiAgICAgICAgICAgICAgICAnbWlzc2luZ19vYmplY3RzJzogdmFsaWRhdGVkX21pc3NpbmcKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3IgYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYi4p2MIEZhaWxlZCB0byBwYXJzZSB2YWxpZGF0aW9uIEpTT046IHtlfSIpCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIiAgIEpTT04gdGV4dCAoZmlyc3QgMTAwMCBjaGFycyk6IHtqc29uX3RleHRbOjEwMDBdfSIpCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIiAgIFRoaXMgbWF5IGluZGljYXRlIENsYXVkZSdzIHJlc3BvbnNlIGZvcm1hdCBpcyBpbmNvcnJlY3QiKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgJ3ZhbGlkYXRlZF9vYmplY3RzJzogW10sCiAgICAgICAgICAgICAgICAnbWlzc2luZ19vYmplY3RzJzogW10KICAgICAgICAgICAgfQoK''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/analyzer.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/analyzer.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… analyzer.py creado')

# filters.py
print('ðŸ“¤ Creando filters.py...')
data_chunks = [
    '''IiIiCkNlbnRyYWxpemVkIGZpbHRlcmluZyBtb2R1bGUgZm9yIDFVUCBwaXBlbGluZS4KQWxsIGZpbHRlcmluZyBsb2dpYyBpcyBkb2N1bWVudGVkIGFuZCBjZW50cmFsaXplZCBoZXJlLgpNYXggMzUwIGxpbmVzLgoiIiIKaW1wb3J0IGxvZ2dpbmcKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIEFueSwgT3B0aW9uYWwKCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKCmRlZiBmaWx0ZXJfZ2VuZXJpY19uYW1lcyhvYmpfbmFtZTogc3RyKSAtPiBib29sOgogICAgIiIiCiAgICBGaWx0ZXIgb3V0IGdlbmVyaWMvdW5oZWxwZnVsIG5hbWVzLgogICAgCiAgICBSZXR1cm5zOgogICAgICAgIFRydWUgaWYgbmFtZSBzaG91bGQgYmUgcmVqZWN0ZWQgKGlzIGdlbmVyaWMpLCBGYWxzZSBpZiBhY2NlcHRhYmxlCiAgICAiIiIKICAgIGdlbmVyaWNfa2V5d29yZHMgPSBbCiAgICAgICAgJ3N1cGVyZmljaWUnLCAnZXNxdWluYScsICdib3JkZScsICdmcmFnbWVudG8nLCAncGVkYXpvJywKICAgICAgICAnbWVzYScsICdmb25kbycsICdwYXJlZCcsICdzdWVsbycsICdtb2JpbGlhcmlvJywKICAgICAgICAnb2JqZXRvIHJlY3Rhbmd1bGFyJywgJ2Nvc2EnLCAnZWxlbWVudG8nLCAncGFydGUnLAogICAgICAgICdzdXJmYWNlJywgJ2Nvcm5lcicsICdlZGdlJywgJ2ZyYWdtZW50JywgJ3BpZWNlJywKICAgICAgICAndGFibGUnLCAnYmFja2dyb3VuZCcsICd3YWxsJywgJ2Zsb29yJywgJ2Z1cm5pdHVyZScsCiAgICAgICAgJ3JlY3Rhbmd1bGFyIG9iamVjdCcsICd0aGluZycsICdlbGVtZW50JywgJ3BhcnQnCiAgICBdCiAgICAKICAgIG5hbWVfbG93ZXIgPSBvYmpfbmFtZS5sb3dlcigpCiAgICByZXR1cm4gYW55KGtleXdvcmQgaW4gbmFtZV9sb3dlciBmb3Iga2V5d29yZCBpbiBnZW5lcmljX2tleXdvcmRzKQoKCmRlZiBmaWx0ZXJfYnlfc2l6ZSgKICAgIGJib3g6IExpc3RbaW50XSwKICAgIGltYWdlX3NoYXBlOiB0dXBsZSwKICAgIG1heF9hcmVhX3JhdGlvOiBmbG9hdCA9IDAuNQopIC0+IGJvb2w6CiAgICAiIiIKICAgIEZpbHRlciBvYmplY3RzIHRoYXQgYXJlIHRvbyBsYXJnZSAobGlrZWx5IGJhY2tncm91bmQpLgogICAgCiAgICBBcmdzOgogICAgICAgIGJib3g6IFt4LCB5LCB3LCBoXQogICAgICAgIGltYWdlX3NoYXBlOiAoaGVpZ2h0LCB3aWR0aCkKICAgICAgICBtYXhfYXJlYV9yYXRpbzogTWF4aW11bSBhcmVhIGFzIHJhdGlvIG9mIGltYWdlIChkZWZhdWx0OiAwLjUgPSA1MCUpCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHJ1ZSBpZiBvYmplY3Qgc2hvdWxkIGJlIHJlamVjdGVkICh0b28gbGFyZ2UpLCBGYWxzZSBpZiBhY2NlcHRhYmxlCiAgICAiIiIKICAgIGltZ19oZWlnaHQsIGltZ193aWR0aCA9IGltYWdlX3NoYXBlCiAgICBiYm94X2FyZWEgPSBiYm94WzJdICogYmJveFszXSAgIyB3aWR0aCAqIGhlaWdodAogICAgaW1hZ2VfYXJlYSA9IGltZ193aWR0aCAqIGltZ19oZWlnaHQKICAgIGFyZWFfcmF0aW8gPSBiYm94X2FyZWEgLyBpbWFnZV9hcmVhCiAgICAKICAgIHJldHVybiBhcmVhX3JhdGlvID4gbWF4X2FyZWFfcmF0aW8KCgpkZWYgZmlsdGVyX3VzZWZ1bF9vYmplY3RzKAogICAgYW5hbHlzZXM6IExpc3RbRGljdFtzdHIsIEFueV1dLAogICAgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0sCiAgICBpbWFnZV9zaGFwZTogdHVwbGUsCiAgICBtYXhfYXJlYV9yYXRpbzogZmxvYXQgPSAwLjUKKSAtPiBMaXN0W0RpY3Rbc3RyLCBBbnldXToKICAgICIiIgogICAgRmlsdGVyIGFuYWx5c2VzIHRvIGtlZXAgb25seSB1c2VmdWwgb2JqZWN0cy4KICAgIAogICAgVGhpcyBhcHBsaWVzIHBvc3QtQ2xhdWRlIGZpbHRlcmluZzoKICAgIDEuIEZpbHRlciBieSB1c2VmdWxuZXNzICh1c2VmdWw9InllcyIpCiAgICAyLiBGaWx0ZXIgYnkgc2l6ZSAobWF4X2FyZWFfcmF0aW8pCiAgICAzLiBGaWx0ZXIgYnkgZ2VuZXJpYyBuYW1lcwogICAgCiAgICBBcmdzOgogICAgICAgIGFuYWx5c2VzOiBMaXN0IG9mIENsYXVkZSBhbmFseXNlcyAoZWFjaCBoYXMgJ24nLCAndXNlZnVsJywgJ25hbWUnLCBldGMuKQogICAgICAgIGRldGVjdGlvbnM6IExpc3Qgb2YgU0FNIGRldGVjdGlvbnMgKGZvciBiYm94IGxvb2t1cCkKICAgICAgICBpbWFnZV9zaGFwZTogKGhlaWdodCwgd2lkdGgpIG9mIGltYWdlCiAgICAgICAgbWF4X2FyZWFfcmF0aW86IE1heGltdW0gYXJlYSByYXRpbyAoZGVmYXVsdDogMC41ID0gNTAlKQogICAgCiAgICBSZXR1cm5zOgogICAgICAgIExpc3Qgb2YgdXNlZnVsIG9iamVjdHMgd2l0aCBhbmFseXNpcyArIGRldGVjdGlvbiBkYXRhCiAgICAiIiIKICAgIHVzZWZ1bF9vYmplY3RzID0gW10KICAgIHNraXBwZWRfY291bnQgPSAwCiAgICAKICAgIGZvciBhbmFseXNpcyBpbiBhbmFseXNlczoKICAgICAgICBuID0gYW5hbHlzaXMuZ2V0KCduJywgMCkKICAgICAgICAKICAgICAgICAjIFNraXAgaWYgbm90IHVzZWZ1bAogICAgICAgIGlmIGFuYWx5c2lzLmdldCgndXNlZnVsJywgJ25vJykubG93ZXIoKSAhPSAneWVzJzoKICAgICAgICAgICAgc2tpcHBlZF9jb3VudCArPSAxCiAgICAgICAgICAgIHJlYXNvbiA9IGFuYWx5c2lzLmdldCgncmVhc29uJywgJ25vdCB1c2VmdWwnKQogICAgICAgICAgICBsb2dnZXIuZGVidWcoZiIgIOKPre+4jyAgI3tufTogU2tpcHBlZCAtIHtyZWFzb259IikKICAgICAgICAgICAgY29udGludWUKICAgICAgICAKICAgICAgICAjIEdldCBjb3JyZXNwb25kaW5nIGRldGVjdGlvbgogICAgICAgIGlmIG4gPCAxIG9yIG4gPiBsZW4oZGV0ZWN0aW9ucyk6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiSW52YWxpZCBvYmplY3QgbnVtYmVyIG49e259LCBza2lwcGluZyIpCiAgICAgICAgICAgIHNraXBwZWRfY291bnQgKz0gMQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIAogICAgICAgIGRldGVjdGlvbiA9IGRldGVjdGlvbnNbbiAtIDFdICAjIG4gaXMgMS1pbmRleGVkCiAgICAgICAgCiAgICAgICAgIyBGaWx0ZXIgYnkgc2l6ZSAodXNlIGJib3ggZnJvbSBhbmFseXNpcyBpZiBhdmFpbGFibGUsIG90aGVyd2lzZSBmcm9tIGRldGVjdGlvbikKICAgICAgICBiYm94ID0gYW5hbHlzaXMuZ2V0KCdiYm94Jykgb3IgZGV0ZWN0aW9uLmdldCgnYmJveCcpCiAgICAgICAgaWYgbm90IGJib3g6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICDimqDvuI8gICN7bn06IE5vIGJib3ggYXZhaWxhYmxlLCBza2lwcGluZyIpCiAgICAgICAgICAgIHNraXBwZWRfY291bnQgKz0gMQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIAogICAgICAgIGlmIGZpbHRlcl9ieV9zaXplKGJib3gsIGltYWdlX3NoYXBlLCBtYXhfYXJlYV9yYXRpbyk6CiAgICAgICAgICAgIHNraXBwZWRfY291bnQgKz0gMQogICAgICAgICAgICBsb2dnZXIuZGVidWcoZiIgIOKPre+4jyAgI3tufTogU2tpcHBlZCAtIHRvbyBsYXJnZSIpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgIyBGaWx0ZXIgYnkgZ2VuZXJpYyBuYW1lcwogICAgICAgIG9ial9uYW1lID0gYW5hbHlzaXMuZ2V0KCduYW1lJywgJycpCiAgICAgICAgaWYgZmlsdGVyX2dlbmVyaWNfbmFtZXMob2JqX25hbWUpOgogICAgICAgICAgICBza2lwcGVkX2NvdW50ICs9IDEKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiICDij63vuI8gICN7bn06IFNraXBwZWQgLSBnZW5lcmljIG5hbWU6ICd7b2JqX25hbWV9JyIpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgIyBPYmplY3QgcGFzc2VkIGFsbCBmaWx0ZXJzCiAgICAgICAgdXNlZnVsX29iamVjdHMuYXBwZW5kKHsKICAgICAgICAgICAgJ2FuYWx5c2lzJzogYW5hbHlzaXMsCiAgICAgICAgICAgICdkZXRlY3Rpb24nOiBkZXRlY3Rpb24sCiAgICAgICAgICAgICduJzogbgogICAgICAgIH0pCiAgICAKICAgIGxvZ2dlci5pbmZvKGYi8J+TiiBGaWx0ZXJlZCB7bGVuKHVzZWZ1bF9vYmplY3RzKX0gdXNlZnVsIG9iamVjdHMsIHtza2lwcGVkX2NvdW50fSBza2lwcGVkIikKICAgIHJldHVybiB1c2VmdWxfb2JqZWN0cwoKCmRlZiBmaWx0ZXJfb2JqZWN0cygKICAgIGFuYWx5c2VzOiBMaXN0W0RpY3Rbc3RyLCBBbnldXSwKICAgIGltYWdlX3NoYXBlOiB0dXBsZSwKICAgIG1heF9hcmVhX3JhdGlvOiBmbG9hdCA9IDAuNQopIC0+IExpc3RbRGljdFtzdHIsIEFueV1dOgogICAgIiIiCiAgICBTaW1wbGUgZmlsdGVyIGZvciBhbmFseXNlcyAocG9zdC1DbGF1ZGUgZmlsdGVyaW5nKS4KICAgIEZpbHRlcnMgYnkgc2l6ZSBhbmQgZ2VuZXJpYyBuYW1lcy4KICAgIAogICAgQXJnczoKICAgICAgICBhbmFseXNlczogTGlzdCBvZiBDbGF1ZGUgYW5hbHlzZXMgKGFscmVhZHkgZmlsdGVyZWQgYnkgdXNlZnVsPSJ5ZXMiKQogICAgICAgIGltYWdlX3NoYXBlOiAoaGVpZ2h0LCB3aWR0aCkgb2YgaW1hZ2UKICAgICAgICBtYXhfYXJlYV9yYXRpbzogTWF4aW11bSBhcmVhIHJhdGlvIChkZWZhdWx0OiAwLjUgPSA1MCUpCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgRmlsdGVyZWQgbGlzdCBvZiBhbmFseXNlcwogICAgIiIiCiAgICBmaWx0ZXJlZCA9IFtdCiAgICAKICAgIGZvciBhbmFseXNpcyBpbiBhbmFseXNlczoKICAgICAgICAjIEZpbHRlciBieSBzaXplCiAgICAgICAgYmJveCA9IGFuYWx5c2lzLmdldCgnYmJveCcpCiAgICAgICAgaWYgYmJveCBhbmQgZmlsdGVyX2J5X3NpemUoYmJveCwgaW1hZ2Vfc2hhcGUsIG1heF9hcmVhX3JhdGlvKToKICAgICAgICAgICAgY29udGludWUKICAgICAgICAKICAgICAgICAjIEZpbHRlciBieSBnZW5lcmljIG5hbWVzCiAgICAgICAgb2JqX25hbWUgPSBhbmFseXNpcy5nZXQoJ25hbWUnLCAnJykKICAgICAgICBpZiBmaWx0ZXJfZ2VuZXJpY19uYW1lcyhvYmpfbmFtZSk6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgZmlsdGVyZWQuYXBwZW5kKGFuYWx5c2lzKQogICAgCiAgICByZXR1cm4gZmlsdGVyZWQKCg==''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/filters.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/filters.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… filters.py creado')

# image_quality.py
print('ðŸ“¤ Creando image_quality.py...')
data_chunks = [
    '''IiIiCk3Ds2R1bG8gZGUgdmFsaWRhY2nDs24gZGUgY2FsaWRhZCBkZSBpbWFnZW4geSBjb3JyZXNwb25kZW5jaWEgdGh1bWJuYWlsLWNvbnRlbmlkby4KClVzYSBtw6l0cmljYXMgbWF0ZW3DoXRpY2FzIG9iamV0aXZhcyBwYXJhOgoxLiBEZXRlY3RhciBibHVyL2ZvY3VzIGVuIGltw6FnZW5lcwoyLiBWYWxpZGFyIHF1ZSB0aHVtYm5haWxzIGNvcnJlc3BvbmRlbiBhbCBjb250ZW5pZG8gaWRlbnRpZmljYWRvCjMuIFJlY2hhemFyIGltw6FnZW5lcyBkZSBiYWphIGNhbGlkYWQgYW50ZXMgZGUgcHJvY2VzYW1pZW50bwoiIiIKaW1wb3J0IGN2MgppbXBvcnQgbnVtcHkgYXMgbnAKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIEFueSwgVHVwbGUsIE9wdGlvbmFsLCBMaXN0CmltcG9ydCBsb2dnaW5nCgpsb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCgpkZWYgY2FsY3VsYXRlX3NoYXJwbmVzc19zY29yZShpbWFnZTogbnAubmRhcnJheSkgLT4gZmxvYXQ6CiAgICAiIiIKICAgIENhbGN1bGEgZWwgc2NvcmUgZGUgbml0aWRleiB1c2FuZG8gTGFwbGFjaWFuIFZhcmlhbmNlLgogICAgCiAgICBNw6l0cmljYSBtYXRlbcOhdGljYTogVmFyKExhcGxhY2lhbihJKSkKICAgIC0gSW3DoWdlbmVzIG7DrXRpZGFzOiB2YXJpYW56YSBhbHRhIChtdWNob3MgYm9yZGVzIGRlZmluaWRvcykKICAgIC0gSW3DoWdlbmVzIGJvcnJvc2FzOiB2YXJpYW56YSBiYWphIChib3JkZXMgc3VhdmVzKQogICAgCiAgICBBcmdzOgogICAgICAgIGltYWdlOiBJbWFnZW4gQkdSIG8gUkdCCiAgICAgICAgCiAgICBSZXR1cm5zOgogICAgICAgIFNjb3JlIGRlIG5pdGlkZXogKDAt4oieLCB0w61waWNhbWVudGUgMC0xMDAwKQogICAgICAgIC0gPjEwMDogQnVlbmEgbml0aWRlegogICAgICAgIC0gNTAtMTAwOiBOaXRpZGV6IGFjZXB0YWJsZQogICAgICAgIC0gPDUwOiBCb3Jyb3NhIChyZWNoYXphcikKICAgICIiIgogICAgaWYgaW1hZ2UgaXMgTm9uZSBvciBpbWFnZS5zaXplID09IDA6CiAgICAgICAgcmV0dXJuIDAuMAogICAgCiAgICAjIENvbnZlcnRpciBhIGVzY2FsYSBkZSBncmlzZXMKICAgIGlmIGxlbihpbWFnZS5zaGFwZSkgPT0gMzoKICAgICAgICBncmF5ID0gY3YyLmN2dENvbG9yKGltYWdlLCBjdjIuQ09MT1JfQkdSMkdSQVkpCiAgICBlbHNlOgogICAgICAgIGdyYXkgPSBpbWFnZQogICAgCiAgICAjIEFwbGljYXIgZmlsdHJvIExhcGxhY2lhbiBwYXJhIGRldGVjdGFyIGJvcmRlcwogICAgbGFwbGFjaWFuID0gY3YyLkxhcGxhY2lhbihncmF5LCBjdjIuQ1ZfNjRGKQogICAgCiAgICAjIENhbGN1bGFyIHZhcmlhbnphIChtw6l0cmljYSBkZSBuaXRpZGV6KQogICAgdmFyaWFuY2UgPSBsYXBsYWNpYW4udmFyKCkKICAgIAogICAgcmV0dXJuIGZsb2F0KHZhcmlhbmNlKQoKCmRlZiBpc19pbWFnZV9hY2NlcHRhYmxlKGltYWdlOiBucC5uZGFycmF5LCBtaW5fc2hhcnBuZXNzOiBmbG9hdCA9IDUwLjApIC0+IFR1cGxlW2Jvb2wsIGZsb2F0LCBzdHJdOgogICAgIiIiCiAgICBWYWxpZGEgc2kgdW5hIGltYWdlbiB0aWVuZSBjYWxpZGFkIHN1ZmljaWVudGUgcGFyYSBwcm9jZXNhbWllbnRvLgogICAgCiAgICBBcmdzOgogICAgICAgIGltYWdlOiBJbWFnZW4gQkdSCiAgICAgICAgbWluX3NoYXJwbmVzczogVW1icmFsIG3DrW5pbW8gZGUgbml0aWRleiAoZGVmYXVsdDogNTAuMCkKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHVwbGUgKGlzX2FjY2VwdGFibGUsIHNoYXJwbmVzc19zY29yZSwgcmVhc29uKQogICAgIiIiCiAgICBpZiBpbWFnZSBpcyBOb25lIG9yIGltYWdlLnNpemUgPT0gMDoKICAgICAgICByZXR1cm4gRmFsc2UsIDAuMCwgIkltYWdlbiB2YWPDrWEgbyBpbnbDoWxpZGEiCiAgICAKICAgIHNoYXJwbmVzcyA9IGNhbGN1bGF0ZV9zaGFycG5lc3Nfc2NvcmUoaW1hZ2UpCiAgICAKICAgIGlmIHNoYXJwbmVzcyA8IG1pbl9zaGFycG5lc3M6CiAgICAgICAgcmVhc29uID0gZiJJbWFnZW4gZGVtYXNpYWRvIGJvcnJvc2EgKG5pdGlkZXo9e3NoYXJwbmVzczouMWZ9IDwge21pbl9zaGFycG5lc3M6LjFmfSkiCiAgICAgICAgcmV0dXJuIEZhbHNlLCBzaGFycG5lc3MsIHJlYXNvbgogICAgCiAgICByZXR1cm4gVHJ1ZSwgc2hhcnBuZXNzLCAiT0siCgoKZGVmIHZhbGlkYXRlX3RodW1ibmFpbF9jb250ZW50X21hdGNoKAogICAgdGh1bWJuYWlsOiBucC5uZGFycmF5LAogICAgb3JpZ2luYWxfaW1hZ2U6IG5wLm5kYXJyYXksCiAgICBiYm94OiBMaXN0W2ludF0sCiAgICBleHBlY3RlZF9jYXRlZ29yeTogT3B0aW9uYWxbc3RyXSA9IE5vbmUKKSAtPiBUdXBsZVtib29sLCBEaWN0W3N0ciwgQW55XV06CiAgICAiIiIKICAgIFZhbGlkYSBxdWUgZWwgdGh1bWJuYWlsIGNvcnJlc3BvbmRlIGFsIGNvbnRlbmlkbyBpZGVudGlmaWNhZG8uCiAgICAKICAgIFVzYSBtw7psdGlwbGVzIG3DqXRyaWNhcyBtYXRlbcOhdGljYXM6CiAgICAxLiBPdmVybGFwIGRlIGNhcmFjdGVyw61zdGljYXMgKFNJRlQvT1JCKQogICAgMi4gU2ltaWxpdHVkIGVzdHJ1Y3R1cmFsIChTU0lNKQogICAgMy4gQ29ycmVsYWNpw7NuIGRlIGhpc3RvZ3JhbWFzCiAgICA0LiBWYWxpZGFjacOzbiBkZSByZWdpw7NuIChiYm94IGRlbnRybyBkZSB0aHVtYm5haWwpCiAgICAKICAgIEFyZ3M6CiAgICAgICAgdGh1bWJuYWlsOiBDcm9wL3RodW1ibmFpbCBnZW5lcmFkbwogICAgICAgIG9yaWdpbmFsX2ltYWdlOiBJbWFnZW4gb3JpZ2luYWwgY29tcGxldGEKICAgICAgICBiYm94OiBCb3VuZGluZyBib3ggW3gsIHksIHcsIGhdIHVzYWRvIHBhcmEgZ2VuZXJhciBlbCB0aHVtYm5haWwKICAgICAgICBleHBlY3RlZF9jYXRlZ29yeTogQ2F0ZWdvcsOtYSBlc3BlcmFkYSAob3BjaW9uYWwsIHBhcmEgbG9nZ2luZykKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHVwbGUgKGlzX3ZhbGlkLCBtZXRyaWNzX2RpY3QpCiAgICAiIiIKICAgIG1ldHJpY3MgPSB7CiAgICAgICAgJ2Jib3hfaW5fdGh1bWJuYWlsJzogRmFsc2UsCiAgICAgICAgJ2NvbnRlbnRfc2ltaWxhcml0eSc6IDAuMCwKICAgICAgICAnb3ZlcmxhcF9yYXRpbyc6IDAuMCwKICAgICAgICAndmFsaWQnOiBGYWxzZQogICAgfQogICAgCiAgICBpZiB0aHVtYm5haWwgaXMgTm9uZSBvciB0aHVtYm5haWwuc2l6ZSA9PSAwOgogICAgICAgIG1ldHJpY3NbJ2Vycm9yJ10gPSAiVGh1bWJuYWlsIHZhY8OtbyIKICAgICAgICByZXR1cm4gRmFsc2UsIG1ldHJpY3MKICAgIAogICAgaWYgb3JpZ2luYWxfaW1hZ2UgaXMgTm9uZSBvciBvcmlnaW5hbF9pbWFnZS5zaXplID09IDA6CiAgICAgICAgbWV0cmljc1snZXJyb3InXSA9ICJJbWFnZW4gb3JpZ2luYWwgdmFjw61hIgogICAgICAgIHJldHVybiBGYWxzZSwgbWV0cmljcwogICAgCiAgICBpZiBub3QgYmJveCBvciBsZW4oYmJveCkgIT0gNDoKICAgICAgICBtZXRyaWNzWydlcnJvciddID0gIkJib3ggaW52w6FsaWRvIgogICAgICAgIHJldHVybiBGYWxzZSwgbWV0cmljcwogICAgCiAgICB4LCB5LCB3LCBoID0gYmJveAogICAgaW1nX2hlaWdodCwgaW1nX3dpZHRoID0gb3JpZ2luYWxfaW1hZ2Uuc2hhcGVbOjJdCiAgICAKICAgICMgVmFsaWRhY2nDs24gMTogQmJveCBkZWJlIGVzdGFyIGRlbnRybyBkZSBsYSBpbWFnZW4KICAgIGlmIHggPCAwIG9yIHkgPCAwIG9yIHggKyB3ID4gaW1nX3dpZHRoIG9yIHkgKyBoID4gaW1nX2hlaWdodDoKICAgICAgICBtZXRyaWNzWydlcnJvciddID0gIkJib3ggZnVlcmEgZGUgbMOtbWl0ZXMgZGUgaW1hZ2VuIgogICAgICAgIHJldHVybiBGYWxzZSwgbWV0cmljcwogICAgCiAgICAjIFZhbGlkYWNpw7NuIDI6IEV4dHJhZXIgcmVnacOzbiBvcmlnaW5hbCB1c2FuZG8gYmJveAogICAgdHJ5OgogICAgICAgICMgQXBsaWNhciBwYWRkaW5nIHBhcmEgY29tcGFyYXIKICAgICAgICBwYWRkaW5nID0gMzAKICAgICAgICB4MSA9IG1heCgwLCB4IC0gcGFkZGluZykKICAgICAgICB5MSA9IG1heCgwLCB5IC0gcGFkZGluZykKICAgICAgICB4MiA9IG1pbihpbWdfd2lkdGgsIHggKyB3ICsgcGFkZGluZykKICAgICAgICB5MiA9IG1pbihpbWdfaGVpZ2h0LCB5ICsgaCArIHBhZGRpbmcpCiAgICAgICAgCiAgICAgICAgb3JpZ2luYWxfcmVnaW9uID0gb3JpZ2luYWxfaW1hZ2VbeTE6eTIsIHgxOngyXS5jb3B5KCkKICAgICAgICAKICAgICAgICBpZiBvcmlnaW5hbF9yZWdpb24uc2l6ZSA9PSAwOgogICAgICAgICAgICBtZXRyaWNzWydlcnJvciddID0gIlJlZ2nDs24gb3JpZ2luYWwgdmFjw61hIgogICAgICAgICAgICByZXR1cm4gRmFsc2UsIG1ldHJpY3MKICAgICAgICAKICAgICAgICAjIFJlZGltZW5zaW9uYXIgcGFyYSBjb21wYXJhciAodGh1bWJuYWlsIHB1ZWRlIGVzdGFyIGN1YWRyYWRvKQogICAgICAgIHRodW1iX2hlaWdodCwgdGh1bWJfd2lkdGggPSB0aHVtYm5haWwuc2hhcGVbOjJdCiAgICAgICAgb3JpZ19oZWlnaHQsIG9yaWdfd2lkdGggPSBvcmlnaW5hbF9yZWdpb24uc2hhcGVbOjJdCiAgICAgICAgCiAgICAgICAgIyBSZWRpbWVuc2lvbmFyIHRodW1ibmFpbCBvIHJlZ2nDs24gb3JpZ2luYWwgcGFyYSBxdWUgdGVuZ2FuIHRhbWHDsW8gc2ltaWxhcgogICAgICAgIHRhcmdldF9zaXplID0gbWluKHRodW1iX3dpZHRoLCB0aHVtYl9oZWlnaHQsIG9yaWdfd2lkdGgsIG9yaWdfaGVpZ2h0KQogICAgICAgIGlmIHRhcmdldF9zaXplIDwgNTA6CiAgICAgICAgICAgIG1ldHJpY3NbJ2Vycm9yJ10gPSBmIlJlZ2lvbmVzIGRlbWFzaWFkbyBwZXF1ZcOxYXMgcGFyYSBjb21wYXJhciAodGFyZ2V0X3NpemU9e3RhcmdldF9zaXplfSkiCiAgICAgICAgICAgIHJldHVybiBGYWxzZSwgbWV0cmljcwogICAgICAgIAogICAgICAgIHRodW1iX3Jlc2l6ZWQgPSBjdjIucmVzaXplKHRodW1ibmFpbCwgKHRhcmdldF9zaXplLCB0YXJnZXRfc2l6ZSkpCiAgICAgICAgb3JpZ19yZXNpemVkID0gY3YyLnJlc2l6ZShvcmlnaW5hbF9yZWdpb24sICh0YXJnZXRfc2l6ZSwgdGFyZ2V0X3NpemUpKQogICAgICAgIAogICAgICAgICMgVmFsaWRhY2nDs24gMzogU2ltaWxpdHVkIGVzdHJ1Y3R1cmFsIHVzYW5kbyBjb3JyZWxhY2nDs24KICAgICAgICB0aHVtYl9ncmF5ID0gY3YyLmN2dENvbG9yKHRodW1iX3Jlc2l6ZWQsIGN2Mi5DT0xPUl9CR1IyR1JBWSkgaWYgbGVuKHRodW1iX3Jlc2l6ZWQuc2hhcGUpID09IDMgZWxzZSB0aHVtYl9yZXNpemVkCiAgICAgICAgb3JpZ19ncmF5ID0gY3YyLmN2dENvbG9yKG9yaWdfcmVzaXplZCwgY3YyLkNPTE9SX0JHUjJHUkFZKSBpZiBsZW4ob3JpZ19yZXNpemVkLnNoYXBlKSA9PSAzIGVsc2Ugb3JpZ19yZXNpemVkCiAgICAgICAgCiAgICAgICAgIyBDYWxjdWxhciBjb3JyZWxhY2nDs24gKHNpbWlsaXR1ZCkKICAgICAgICBjb3JyZWxhdGlvbiA9IGN2Mi5tYXRjaFRlbXBsYXRlKHRodW1iX2dyYXksIG9yaWdfZ3JheSwgY3YyLlRNX0NDT0VGRl9OT1JNRUQpWzAsIDBdCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGFjacOzbiA0OiBPdmVybGFwIGRlIGNhcmFjdGVyw61zdGljYXMgdXNhbmRvIE9SQgogICAgICAgIHRyeToKICAgICAgICAgICAgb3JiID0gY3YyLk9SQl9jcmVhdGUobmZlYXR1cmVzPTUwKQogICAgICAgICAgICBrcDEsIGRlczEgPSBvcmIuZGV0ZWN0QW5kQ29tcHV0ZSh0aHVtYl9ncmF5LCBOb25lKQogICAgICAgICAgICBrcDIsIGRlczIgPSBvcmIuZGV0ZWN0QW5kQ29tcHV0ZShvcmlnX2dyYXksIE5vbmUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBkZXMxIGlzIG5vdCBOb25lIGFuZCBkZXMyIGlzIG5vdCBOb25lIGFuZCBsZW4oZGVzMSkgPiAwIGFuZCBsZW4oZGVzMikgPiAwOgogICAgICAgICAgICAgICAgIyBCdXNjYXIgbWF0Y2hlcwogICAgICAgICAgICAgICAgYmYgPSBjdjIuQkZNYXRjaGVyKGN2Mi5OT1JNX0hBTU1JTkcsIGNyb3NzQ2hlY2s9VHJ1ZSkKICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBiZi5tYXRjaChkZXMxLCBkZXMyKQogICAgICAgICAgICAgICAgbWF0Y2hlcyA9IHNvcnRlZChtYXRjaGVzLCBrZXk9bGFtYmRhIHg6IHguZGlzdGFuY2UpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUmF0aW8gZGUgbWF0Y2hlcyBzb2JyZSBjYXJhY3RlcsOtc3RpY2FzIGRldGVjdGFkYXMKICAgICAgICAgICAgICAgIG1hdGNoX3JhdGlvID0gbGVuKG1hdGNoZXMpIC8gbWF4KGxlbihrcDEpLCBsZW4oa3AyKSwgMSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG1hdGNoX3JhdGlvID0gMC4wCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJFcnJvciBlbiBtYXRjaGluZyBPUkI6IHtlfSIpCiAgICAgICAgICAgIG1hdGNoX3JhdGlvID0gMC4wCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGFjacOzbiA1OiBDYWxjdWxhciBvdmVybGFwIHJhdGlvIGRlbCBjb250ZW5pZG8KICAgICAgICAjIENvbXBhcmFyIGhpc3RvZ3JhbWFzIHBhcmEgdmVyaWZpY2FyIGNvbnRlbmlkbyBzaW1pbGFyCiAgICAgICAgaGlzdF90aHVtYiA9IGN2Mi5jYWxjSGlzdChbdGh1bWJfZ3JheV0sIFswXSwgTm9uZSwgWzI1Nl0sIFswLCAyNTZdKQogICAgICAgIGhpc3Rfb3JpZyA9IGN2Mi5jYWxjSGlzdChbb3JpZ19ncmF5XSwgWzBdLCBOb25lLCBbMjU2XSwgWzAsIDI1Nl0pCiAgICAgICAgaGlzdF9jb3JyZWxhdGlvbiA9IGN2Mi5jb21wYXJlSGlzdChoaXN0X3RodW1iLCBoaXN0X29yaWcsIGN2Mi5ISVNUQ01QX0NPUlJFTCkKICAgICAgICAKICAgICAgICAjIFNjb3JlIGNvbWJpbmFkbwogICAgICAgICMgY29ycmVsYXRpb246IDAtMSAoc2ltaWxpdHVkIGVzcGFjaWFsKQogICAgICAgICMgbWF0Y2hfcmF0aW86IDAtMSAoZmVhdHVyZXMgbWF0Y2hpbmcpCiAgICAgICAgIyBoaXN0X2NvcnJlbGF0aW9uOiAwLTEgKHNpbWlsaXR1ZCBkZSBkaXN0cmlidWNpw7NuKQogICAgICAgIGNvbWJpbmVkX3Njb3JlID0gKGNvcnJlbGF0aW9uICogMC41ICsgbWF0Y2hfcmF0aW8gKiAwLjMgKyBoaXN0X2NvcnJlbGF0aW9uICogMC4yKQogICAgICAgIAogICAgICAgIG1ldHJpY3NbJ2Jib3hfaW5fdGh1bWJuYWlsJ10gPSBUcnVlCiAgICAgICAgbWV0cmljc1snY29udGVudF9zaW1pbGFyaXR5J10gPSBmbG9hdChjb21iaW5lZF9zY29yZSkKICAgICAgICBtZXRyaWNzWydvdmVybGFwX3JhdGlvJ10gPSBmbG9hdChjb3JyZWxhdGlvbikKICAgICAgICBtZXRyaWNzWydtYXRjaF9yYXRpbyddID0gZmxvYXQobWF0Y2hfcmF0aW8pCiAgICAgICAgbWV0cmljc1snaGlzdF9jb3JyZWxhdGlvbiddID0gZmxvYXQoaGlzdF9jb3JyZWxhdGlvbikKICAgICAgICAKICAgICAgICAjIFVtYnJhbCBtw61uaW1vIHBhcmEgY29uc2lkZXJhciB2w6FsaWRvCiAgICAgICAgaXNfdmFsaWQgPSBjb21iaW5lZF9zY29yZSA+IDAuMyAgIyBBbCBtZW5vcyAzMCUgZGUgc2ltaWxpdHVkCiAgICAgICAgCiAgICAgICAgbWV0cmljc1sndmFsaWQnXSA9IGlzX3ZhbGlkCiAgICAgICAgCiAgICAgICAgaWYgbm90IGlzX3ZhbGlkIGFuZCBleHBlY3RlZF9jYXRlZ29yeToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgIOKaoO+4jyAgVGh1bWJuYWlsIG5vIGNvaW5jaWRlIGNvbiBjb250ZW5pZG8gZXNwZXJhZG8gKHtleHBlY3RlZF9jYXRlZ29yeX0pIikKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgICAgIFNpbWlsaXR1ZDoge2NvbWJpbmVkX3Njb3JlOi4yJX0sIENvcnJlbGFjacOzbjoge2NvcnJlbGF0aW9uOi4yJX0sIE1hdGNoZXM6IHttYXRjaF9yYXRpbzouMiV9IikKICAgICAgICAKICAgICAgICByZXR1cm4gaXNfdmFsaWQsIG1ldHJpY3MKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciB2YWxpZGFuZG8gdGh1bWJuYWlsOiB7ZX0iKQogICAgICAgIG1ldHJpY3NbJ2Vycm9yJ10gPSBzdHIoZSkKICAgICAgICByZXR1cm4gRmFsc2UsIG1ldHJpY3MKCgpkZWYgdmFsaWRhdGVfY3JvcF9xdWFsaXR5KGNyb3A6IG5wLm5kYXJyYXksIGJib3hfYXJlYTogaW50KSAtPiBUdXBsZVtib29sLCBEaWN0W3N0ciwgQW55XV06CiAgICAiIiIKICAgIFZhbGlkYSBsYSBjYWxpZGFkIGRlIHVuIGNyb3AgZ2VuZXJhZG8uCiAgICAKICAgIEFyZ3M6CiAgICAgICAgY3JvcDogQ3JvcC90aHVtYm5haWwgYSB2YWxpZGFyCiAgICAgICAgYmJveF9hcmVhOiDDgXJlYSBkZWwgYmJveCBvcmlnaW5hbCBlbiBww614ZWxlc8KyCiAgICAgICAgCiAgICBSZXR1cm5zOgogICAgICAgIFR1cGxlIChpc192YWxpZCwgcXVhbGl0eV9tZXRyaWNzKQogICAgIiIiCiAgICBtZXRyaWNzID0gewogICAgICAgICdzaGFycG5lc3MnOiAwLjAsCiAgICAgICAgJ2NvbnRlbnRfcmF0aW8nOiAwLjAsCiAgICAgICAgJ3ZhbGlkJzogRmFsc2UKICAgIH0KICAgIAogICAgaWYgY3JvcCBpcyBOb25lIG9yIGNyb3Auc2l6ZSA9PSAwOgogICAgICAgIG1ldHJpY3NbJ2Vycm9yJ10gPSAiQ3JvcCB2YWPDrW8iCiAgICAgICAgcmV0dXJuIEZhbHNlLCBtZXRyaWNzCiAgICAKICAgICMgQ2FsY3VsYXIgbml0aWRleiBkZWwgY3JvcAogICAgc2hhcnBuZXNzID0gY2FsY3VsYXRlX3NoYXJwbmVzc19zY29yZShjcm9wKQogICAgbWV0cmljc1snc2hhcnBuZXNzJ10gPSBzaGFycG5lc3MKICAgIAogICAgIyBDYWxjdWxhciByYXRpbyBkZSBjb250ZW5pZG8gKG5vIGZvbmRvIGJsYW5jbykKICAgIGlmIGxlbihjcm9wLnNoYXBlKSA9PSAzOgogICAgICAgIGdyYXkgPSBjdjIuY3Z0Q29sb3IoY3JvcCwgY3YyLkNPTE9SX0JHUjJHUkFZKQogICAgZWxzZToKICAgICAgICBncmF5ID0gY3JvcAogICAgCiAgICAjIENvbnRhciBww614ZWxlcyBxdWUgbm8gc29uIGZvbmRvIGJsYW5jbyAoMjU1KQogICAgIyBVbWJyYWw6IHDDrXhlbGVzIDwgMjQwIHNlIGNvbnNpZGVyYW4gY29udGVuaWRvCiAgICBjb250ZW50X21hc2sgPSBncmF5IDwgMjQwCiAgICBjb250ZW50X3JhdGlvID0gY29udGVudF9tYXNrLnN1bSgpIC8gZ3JheS5zaXplCiAgICBtZXRyaWNzWydjb250ZW50X3JhdGlvJ10gPSBmbG9hdChjb250ZW50X3JhdGlvKQogICAgCiAgICAjIFZhbGlkYXI6IGRlYmUgdGVuZXIgY29udGVuaWRvIHN1ZmljaWVudGUgKD4yMCUgZGVsIMOhcmVhKSB5IG5pdGlkZXogbcOtbmltYQogICAgbWluX2NvbnRlbnRfcmF0aW8gPSAwLjIKICAgIG1pbl9zaGFycG5lc3MgPSAzMC4wICAjIE3DoXMgYmFqbyBwYXJhIGNyb3BzIHBlcXVlw7FvcwogICAgCiAgICBpc192YWxpZCA9IGNvbnRlbnRfcmF0aW8gPj0gbWluX2NvbnRlbnRfcmF0aW8gYW5kIHNoYXJwbmVzcyA+PSBtaW5fc2hhcnBuZXNzCiAgICAKICAgIG1ldHJpY3NbJ3ZhbGlkJ10gPSBpc192YWxpZAogICAgCiAgICBpZiBub3QgaXNfdmFsaWQ6CiAgICAgICAgcmVhc29ucyA9IFtdCiAgICAgICAgaWYgY29udGVudF9yYXRpbyA8IG1pbl9jb250ZW50X3JhdGlvOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInBvY28gY29udGVuaWRvICh7Y29udGVudF9yYXRpbzouMSV9IDwge21pbl9jb250ZW50X3JhdGlvOi4xJX0pIikKICAgICAgICBpZiBzaGFycG5lc3MgPCBtaW5fc2hhcnBuZXNzOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmIm11eSBib3Jyb3NvIChuaXRpZGV6PXtzaGFycG5lc3M6LjFmfSA8IHttaW5fc2hhcnBuZXNzOi4xZn0pIikKICAgICAgICBtZXRyaWNzWydlcnJvciddID0gIiwgIi5qb2luKHJlYXNvbnMpCiAgICAKICAgIHJldHVybiBpc192YWxpZCwgbWV0cmljcwoKCmRlZiB2YWxpZGF0ZV9iYm94X2NvbnRlbnQoCiAgICBpbWFnZTogbnAubmRhcnJheSwKICAgIGJib3g6IExpc3RbaW50XSwKICAgIG1pbl9jb250ZW50X3JhdGlvOiBmbG9hdCA9IDAuMywKICAgIG1pbl9zaGFycG5lc3M6IGZsb2F0ID0gMTAuMAopIC0+IFR1cGxlW2Jvb2wsIERpY3Rbc3RyLCBBbnldXToKICAgICIiIgogICAgVmFsaWRhIHF1ZSB1biBiYm94IGNvbnRpZW5lIGNvbnRlbmlkbyByZWFsIGFudGVzIGRlIGdlbmVyYXIgdW4gY3JvcC4KICAgIAogICAgw5p0aWwgcGFyYSB2YWxpZGFyIGJib3hlcyBhcHJveGltYWRvcyBkZSAibWlzc2luZyBvYmplY3RzIiBkZSBDbGF1ZGUuCiAgICAKICAgIEFyZ3M6CiAgICAgICAgaW1hZ2U6IEltYWdlbiBjb21wbGV0YSAoQkdSKQogICAgICAgIGJib3g6IEJvdW5kaW5nIGJveCBbeCwgeSwgdywgaF0gYSB2YWxpZGFyCiAgICAgICAgbWluX2NvbnRlbnRfcmF0aW86IFJhdGlvIG3DrW5pbW8gZGUgY29udGVuaWRvIG5vIHVuaWZvcm1lIChkZWZhdWx0OiAwLjMpCiAgICAgICAgbWluX3NoYXJwbmVzczogTml0aWRleiBtw61uaW1hIHJlcXVlcmlkYSAoZGVmYXVsdDogMTAuMCkKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHVwbGUgKGlzX3ZhbGlkLCBtZXRyaWNzX2RpY3QpCiAgICAiIiIKICAgIG1ldHJpY3MgPSB7CiAgICAgICAgJ2NvbnRlbnRfcmF0aW8nOiAwLjAsCiAgICAgICAgJ3NoYXJwbmVzcyc6IDAuMCwKICAgICAgICAnaGFzX2NvbnRlbnQnOiBGYWxzZSwKICAgICAgICAndmFsaWQnOiBGYWxzZQogICAgfQogICAgCiAgICBpZiBpbWFnZSBpcyBOb25lIG9yIGltYWdlLnNpemUgPT0gMDoKICAgICAgICBtZXRyaWNzWydlcnJvciddID0gIkltYWdlbiB2YWPDrWEiCiAgICAgICAgcmV0dXJuIEZhbHNlLCBtZXRyaWNzCiAgICAKICAgIGlmIG5vdCBiYm94IG9yIGxlbihiYm94KSAhPSA0OgogICAgICAgIG1ldHJpY3NbJ2Vycm9yJ10gPSAiQmJveCBpbnbDoWxpZG8iCiAgICAgICAgcmV0dXJuIEZhbHNlLCBtZXRyaWNzCiAgICAKICAgIHgsIHksIHcsIGggPSBiYm94CiAgICBpbWdfaGVpZ2h0LCBpbWdfd2lkdGggPSBpbWFnZS5zaGFwZVs6Ml0KICAgIAogICAgIyBWYWxpZGFyIGJib3ggZXN0w6EgZGVudHJvIGRlIGzDrW1pdGVzCiAgICBpZiB4IDwgMCBvciB5IDwgMCBvciB4ICsgdyA+IGltZ193aWR0aCBvciB5ICsgaCA+IGltZ19oZWlnaHQ6CiAgICAgICAgbWV0cmljc1snZXJyb3InXSA9ICJCYm94IGZ1ZXJhIGRlIGzDrW1pdGVzIgogICAgICAgIHJldHVybiBGYWxzZSwgbWV0cmljcwogICAgCiAgICBpZiB3IDw9IDAgb3IgaCA8PSAwOgogICAgICAgIG1ldHJpY3NbJ2Vycm9yJ10gPSAiRGltZW5zaW9uZXMgaW52w6FsaWRhcyIKICAgICAgICByZXR1cm4gRmFsc2UsIG1ldHJpY3MKICAgIAogICAgIyBFeHRyYWVyIHJlZ2nDs24gZGVsIGJib3gKICAgIHRyeToKICAgICAgICByZWdpb24gPSBpbWFnZVt5OnkraCwgeDp4K3ddLmNvcHkoKQogICAgICAgIAogICAgICAgIGlmIHJlZ2lvbi5zaXplID09IDA6CiAgICAgICAgICAgIG1ldHJpY3NbJ2Vycm9yJ10gPSAiUmVnacOzbiB2YWPDrWEiCiAgICAgICAgICAgIHJldHVybiBGYWxzZSwgbWV0cmljcwogICAgICAgIAogICAgICAgICMgQ2FsY3VsYXIgbml0aWRlegogICAgICAgIHNoYXJwbmVzcyA9IGNhbGN1bGF0ZV9zaGFycG5lc3Nfc2NvcmUocmVnaW9uKQogICAgICAgIG1ldHJpY3NbJ3NoYXJwbmVzcyddID0gZmxvYXQoc2hhcnBuZXNzKQogICAgICAgIAogICAgICAgICMgQ2FsY3VsYXIgY29udGVuaWRvIChww614ZWxlcyBjb24gdmFyaWFjacOzbikKICAgICAgICBpZiBsZW4ocmVnaW9uLnNoYXBlKSA9PSAzOgogICAgICAgICAgICBncmF5ID0gY3YyLmN2dENvbG9yKHJlZ2lvbiwgY3YyLkNPTE9SX0JHUjJHUkFZKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGdyYXkgPSByZWdpb24KICAgICAgICAKICAgICAgICAjIENhbGN1bGFyIHZhcmlhbnphIGxvY2FsICjDoXJlYXMgY29uIHZhcmlhY2nDs24gPSBjb250ZW5pZG8pCiAgICAgICAga2VybmVsX3NpemUgPSBtaW4oNSwgbWluKHcsIGgpIC8vIDQpCiAgICAgICAgaWYga2VybmVsX3NpemUgPj0gMzoKICAgICAgICAgICAga2VybmVsID0gbnAub25lcygoa2VybmVsX3NpemUsIGtlcm5lbF9zaXplKSwgbnAuZmxvYXQzMikgLyAoa2VybmVsX3NpemUgKiBrZXJuZWxfc2l6ZSkKICAgICAgICAgICAgbG9jYWxfbWVhbiA9IGN2Mi5maWx0ZXIyRChncmF5LmFzdHlwZShucC5mbG9hdDMyKSwgLTEsIGtlcm5lbCkKICAgICAgICAgICAgbG9jYWxfdmFyaWFuY2UgPSBjdjIuZmlsdGVyMkQoKGdyYXkuYXN0eXBlKG5wLmZsb2F0MzIpIC0gbG9jYWxfbWVhbikgKiogMiwgLTEsIGtlcm5lbCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmF0aW8gZGUgcMOteGVsZXMgY29uIHZhcmlhY2nDs24gc2lnbmlmaWNhdGl2YQogICAgICAgICAgICBjb250ZW50X21hc2sgPSBsb2NhbF92YXJpYW5jZSA+IDEwICAjIFVtYnJhbCBkZSB2YXJpYWNpw7NuCiAgICAgICAgICAgIGNvbnRlbnRfcmF0aW8gPSBjb250ZW50X21hc2suc3VtKCkgLyBncmF5LnNpemUKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIFBhcmEgcmVnaW9uZXMgbXV5IHBlcXVlw7FhcywgdXNhciBkZXN2aWFjacOzbiBlc3TDoW5kYXIgc2ltcGxlCiAgICAgICAgICAgIHN0ZF9kZXYgPSBncmF5LnN0ZCgpCiAgICAgICAgICAgIGNvbnRlbnRfcmF0aW8gPSAxLjAgaWYgc3RkX2RldiA+IDE1IGVsc2Ugc3RkX2RldiAvIDE1LjAKICAgICAgICAKICAgICAgICBtZXRyaWNzWydjb250ZW50X3JhdGlvJ10gPSBmbG9hdChjb250ZW50X3JhdGlvKQogICAgICAgIG1ldHJpY3NbJ2hhc19jb250ZW50J10gPSBjb250ZW50X3JhdGlvID49IG1pbl9jb250ZW50X3JhdGlvCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGFyOiBkZWJlIHRlbmVyIGNvbnRlbmlkbyB5IG5pdGlkZXogbcOtbmltYQogICAgICAgIGlzX3ZhbGlkID0gY29udGVudF9yYXRpbyA+PSBtaW5fY29udGVudF9yYXRpbyBhbmQgc2hhcnBuZXNzID49IG1pbl9zaGFycG5lc3MKICAgICAgICBtZXRyaWNzWyd2YWxpZCddID0gaXNfdmFsaWQKICAgICAgICAKICAgICAgICBpZiBub3QgaXNfdmFsaWQ6CiAgICAgICAgICAgIHJlYXNvbnMgPSBbXQogICAgICAgICAgICBpZiBjb250ZW50X3JhdGlvIDwgbWluX2NvbnRlbnRfcmF0aW86CiAgICAgICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInBvY28gY29udGVuaWRvICh7Y29udGVudF9yYXRpbzouMSV9IDwge21pbl9jb250ZW50X3JhdGlvOi4xJX0pIikKICAgICAgICAgICAgaWYgc2hhcnBuZXNzIDwgbWluX3NoYXJwbmVzczoKICAgICAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKGYibXV5IGJvcnJvc28gKG5pdGlkZXo9e3NoYXJwbmVzczouMWZ9IDwge21pbl9zaGFycG5lc3M6LjFmfSkiKQogICAgICAgICAgICBtZXRyaWNzWydlcnJvciddID0gIiwgIi5qb2luKHJlYXNvbnMpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIGlzX3ZhbGlkLCBtZXRyaWNzCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYiRXJyb3IgdmFsaWRhbmRvIGJib3ggY29udGVudDoge2V9IikKICAgICAgICBtZXRyaWNzWydlcnJvciddID0gc3RyKGUpCiAgICAgICAgcmV0dXJuIEZhbHNlLCBtZXRyaWNzCg==''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/image_quality.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/image_quality.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… image_quality.py creado')

# camera_utils.py
print('ðŸ“¤ Creando camera_utils.py...')
data_chunks = [
    '''IiIiCkNhbWVyYSB1dGlsaXRpZXMgZm9yIDFVUApIYW5kbGVzIGNhbWVyYSBkZXRlY3Rpb24gYW5kIGVudW1lcmF0aW9uLCBlc3BlY2lhbGx5IGZvciBtYWNPUy4KTWF4IDM1MCBsaW5lcy4KIiIiCmltcG9ydCBjdjIKaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBudW1weSBhcyBucApmcm9tIHR5cGluZyBpbXBvcnQgTGlzdCwgRGljdCwgT3B0aW9uYWwsIFR1cGxlLCBBbnksIFVuaW9uCgojIFRyeSB0byBpbXBvcnQgY3YyLWVudW1lcmF0ZS1jYW1lcmFzIChiZXN0IG1ldGhvZCBmb3IgbWFjT1MpCnRyeToKICAgIGZyb20gY3YyX2VudW1lcmF0ZV9jYW1lcmFzIGltcG9ydCBlbnVtZXJhdGVfY2FtZXJhcyBhcyBjdjJfZW51bWVyYXRlX2NhbWVyYXMKICAgIEhBU19FTlVNRVJBVEUgPSBUcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIEhBU19FTlVNRVJBVEUgPSBGYWxzZQogICAgY3YyX2VudW1lcmF0ZV9jYW1lcmFzID0gTm9uZQoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgoKZGVmIGVudW1lcmF0ZV9jYW1lcmFzKG1heF9pbmRleDogaW50ID0gMTAsIGFsbG93X2lwaG9uZTogYm9vbCA9IEZhbHNlKSAtPiBMaXN0W0RpY3Rbc3RyLCBhbnldXToKICAgICIiIgogICAgRW51bWVyYXRlIGFsbCBhdmFpbGFibGUgY2FtZXJhcy4KICAgIFdvcmtzIGFyb3VuZCBtYWNPUyBPcGVuQ1YgaW5kZXggYnVnLgogICAgQnkgZGVmYXVsdCBleGNsdWRlcyBpUGhvbmUvQ29udGludWl0eSBDYW1lcmEgdG8gYXZvaWQgaW50ZXJmZXJpbmcgd2l0aCBwaG9uZS4KICAgIAogICAgQXJnczoKICAgICAgICBtYXhfaW5kZXg6IE1heGltdW0gY2FtZXJhIGluZGV4IHRvIGNoZWNrCiAgICAgICAgYWxsb3dfaXBob25lOiBJZiBUcnVlLCBhbGxvdyBpUGhvbmUvQ29udGludWl0eSBDYW1lcmEgKGRlZmF1bHQ6IEZhbHNlKQogICAgICAgIAogICAgUmV0dXJuczoKICAgICAgICBMaXN0IG9mIGF2YWlsYWJsZSBjYW1lcmFzIHdpdGggdGhlaXIgcHJvcGVydGllcwogICAgIiIiCiAgICBhdmFpbGFibGVfY2FtZXJhcyA9IFtdCiAgICAKICAgICMgVHJ5IHRvIGdldCBjYW1lcmEgbmFtZXMgdG8gZmlsdGVyIGlQaG9uZS9Db250aW51aXR5CiAgICBjYW1lcmFfbmFtZXMgPSB7fQogICAgaWYgSEFTX0VOVU1FUkFURToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlzX21hYyA9IHBsYXRmb3JtLnN5c3RlbSgpID09ICdEYXJ3aW4nCiAgICAgICAgICAgIGJhY2tlbmQgPSBjdjIuQ0FQX0FWRk9VTkRBVElPTiBpZiBpc19tYWMgZWxzZSBOb25lCiAgICAgICAgICAgIGZvciBjYW1faW5mbyBpbiBjdjJfZW51bWVyYXRlX2NhbWVyYXMoYmFja2VuZCk6CiAgICAgICAgICAgICAgICBjYW1lcmFfbmFtZXNbY2FtX2luZm8uaW5kZXhdID0gY2FtX2luZm8ubmFtZS51cHBlcigpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAKICAgICMgT25seSBleGNsdWRlIGlQaG9uZSBpZiBhbGxvd19pcGhvbmUgaXMgRmFsc2UKICAgIGV4Y2x1ZGVfa2V5d29yZHMgPSBbXQogICAgaWYgbm90IGFsbG93X2lwaG9uZToKICAgICAgICBleGNsdWRlX2tleXdvcmRzID0gWydJUEhPTkUnLCAnQ09OVElOVUlUWScsICdGQUNFVElNRScsICdJUEFEJ10KICAgIAogICAgbG9nZ2VyLmluZm8oZiJTY2FubmluZyBmb3IgY2FtZXJhcyAoMCB0byB7bWF4X2luZGV4fSkuLi4iKQogICAgCiAgICAjIFVzZSBjb3JyZWN0IGJhY2tlbmQgZm9yIG1hY09TIHRvIGF2b2lkIE9wZW5DViBlcnJvciBtZXNzYWdlcwogICAgaXNfbWFjID0gcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ0RhcndpbicKICAgIAogICAgIyBTdXBwcmVzcyBPcGVuQ1Ygd2FybmluZ3MgZHVyaW5nIGVudW1lcmF0aW9uIChpdCdzIG5vcm1hbCBmb3Igc29tZSBpbmRpY2VzIHRvIG5vdCBleGlzdCkKICAgICMgU2F2ZSBjdXJyZW50IGxvZyBsZXZlbCBhbmQgc2V0IHRvIDAgKFNJTEVOVCkgdG8gc3VwcHJlc3Mgd2FybmluZ3MKICAgICMgMCA9IFNJTEVOVCwgMSA9IEVSUk9SLCAyID0gV0FSTiwgMyA9IElORk8sIDQgPSBERUJVRwogICAgb3JpZ2luYWxfbG9nX2xldmVsID0gY3YyLmdldExvZ0xldmVsKCkKICAgIGN2Mi5zZXRMb2dMZXZlbCgwKSAgIyBTSUxFTlQgLSBzdXBwcmVzcyBhbGwgd2FybmluZ3MgZHVyaW5nIGVudW1lcmF0aW9uCiAgICAKICAgIHRyeToKICAgICAgICBmb3IgaSBpbiByYW5nZShtYXhfaW5kZXgpOgogICAgICAgICAgICAjIFNraXAgaWYgd2Uga25vdyBpdCdzIGFuIGlQaG9uZS9Db250aW51aXR5IENhbWVyYQogICAgICAgICAgICBpZiBpIGluIGNhbWVyYV9uYW1lczoKICAgICAgICAgICAgICAgIGNhbV9uYW1lID0gY2FtZXJhX25hbWVzW2ldCiAgICAgICAgICAgICAgICBpZiBhbnkoZXhjbHVkZSBpbiBjYW1fbmFtZSBmb3IgZXhjbHVkZSBpbiBleGNsdWRlX2tleXdvcmRzKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIiAg4o+t77iPICBDYW1lcmEge2l9OiBTa2lwcGluZyB7Y2FtZXJhX25hbWVzW2ldfSAoaVBob25lL0NvbnRpbnVpdHkgQ2FtZXJhKSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVXNlIGJhY2tlbmQgZnJvbSB0aGUgc3RhcnQgdG8gYXZvaWQgT3BlbkNWIHRyeWluZyBtdWx0aXBsZSBiYWNrZW5kcwogICAgICAgICAgICAjIE9ubHkgcGFzcyBiYWNrZW5kIGlmIGl0J3Mgbm90IE5vbmUgKE9wZW5DViBkb2Vzbid0IGFjY2VwdCBOb25lIGFzIHNlY29uZCBhcmcpCiAgICAgICAgICAgIGlmIGlzX21hYzoKICAgICAgICAgICAgICAgIGNhcCA9IGN2Mi5WaWRlb0NhcHR1cmUoaSwgY3YyLkNBUF9BVkZPVU5EQVRJT04pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjYXAgPSBjdjIuVmlkZW9DYXB0dXJlKGkpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBjYXAuaXNPcGVuZWQoKToKICAgICAgICAgICAgICAgICMgVHJ5IHRvIHJlYWQgYSBmcmFtZSB0byB2ZXJpZnkgaXQncyB3b3JraW5nCiAgICAgICAgICAgICAgICByZXQsIGZyYW1lID0gY2FwLnJlYWQoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiByZXQgYW5kIGZyYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICMgR2V0IGNhbWVyYSBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBpbnQoY2FwLmdldChjdjIuQ0FQX1BST1BfRlJBTUVfV0lEVEgpKQogICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGludChjYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9IRUlHSFQpKQogICAgICAgICAgICAgICAgICAgIGZwcyA9IGNhcC5nZXQoY3YyLkNBUF9QUk9QX0ZQUykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byBnZXQgYmFja2VuZCBuYW1lCiAgICAgICAgICAgICAgICAgICAgYmFja2VuZF9uYW1lID0gY2FwLmdldEJhY2tlbmROYW1lKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjYW1lcmFfaW5mbyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2luZGV4JzogaSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiBoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICdmcHMnOiBmcHMsCiAgICAgICAgICAgICAgICAgICAgICAgICdiYWNrZW5kJzogYmFja2VuZF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAnd29ya2luZyc6IFRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlX2NhbWVyYXMuYXBwZW5kKGNhbWVyYV9pbmZvKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiICDinIUgQ2FtZXJhIHtpfToge3dpZHRofXh7aGVpZ2h0fSBAIHtmcHM6LjFmfWZwcyAoe2JhY2tlbmRfbmFtZX0pIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiICDimqDvuI8gIENhbWVyYSB7aX06IE9wZW5lZCBidXQgY2FuJ3QgcmVhZCBmcmFtZXMiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjYXAucmVsZWFzZSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiIgIOKdjCBDYW1lcmEge2l9OiBOb3QgYXZhaWxhYmxlIikKICAgIGZpbmFsbHk6CiAgICAgICAgIyBSZXN0b3JlIG9yaWdpbmFsIGxvZyBsZXZlbAogICAgICAgIGN2Mi5zZXRMb2dMZXZlbChvcmlnaW5hbF9sb2dfbGV2ZWwpCiAgICAKICAgIGlmIGFsbG93X2lwaG9uZToKICAgICAgICBsb2dnZXIuaW5mbyhmIkZvdW5kIHtsZW4oYXZhaWxhYmxlX2NhbWVyYXMpfSB3b3JraW5nIGNhbWVyYShzKSAoaVBob25lL0NvbnRpbnVpdHkgYWxsb3dlZCkiKQogICAgZWxzZToKICAgICAgICBsb2dnZXIuaW5mbyhmIkZvdW5kIHtsZW4oYXZhaWxhYmxlX2NhbWVyYXMpfSB3b3JraW5nIGNhbWVyYShzKSAoaVBob25lL0NvbnRpbnVpdHkgZXhjbHVkZWQpIikKICAgIHJldHVybiBhdmFpbGFibGVfY2FtZXJhcwoKCmRlZiBmaW5kX2NhbWVyYV9ieV9uYW1lKG5hbWVfa2V5d29yZHM6IExpc3Rbc3RyXSwgYmFja2VuZD1Ob25lLCBhbGxvd19pcGhvbmU6IGJvb2wgPSBGYWxzZSkgLT4gT3B0aW9uYWxbVHVwbGVbaW50LCBjdjIuVmlkZW9DYXB0dXJlXV06CiAgICAiIiIKICAgIEZpbmQgY2FtZXJhIGJ5IG5hbWUgdXNpbmcgY3YyLWVudW1lcmF0ZS1jYW1lcmFzIChtb3N0IHJlbGlhYmxlIG9uIG1hY09TKS4KICAgIEJ5IGRlZmF1bHQgZXhjbHVkZXMgaVBob25lL0NvbnRpbnVpdHkgQ2FtZXJhIHRvIGF2b2lkIGludGVyZmVyaW5nIHdpdGggcGhvbmUuCiAgICAKICAgIEFyZ3M6CiAgICAgICAgbmFtZV9rZXl3b3JkczogTGlzdCBvZiBrZXl3b3JkcyB0byBzZWFyY2ggZm9yIChlLmcuLCBbIkMyNzAiLCAiVVZDIiwgIkxvZ2l0ZWNoIl0pCiAgICAgICAgYmFja2VuZDogT3BlbkNWIGJhY2tlbmQgdG8gdXNlCiAgICAgICAgYWxsb3dfaXBob25lOiBJZiBUcnVlLCBhbGxvdyBpUGhvbmUvQ29udGludWl0eSBDYW1lcmEgKGRlZmF1bHQ6IEZhbHNlKQogICAgICAgIAogICAgUmV0dXJuczoKICAgICAgICAoY2FtZXJhX2luZGV4LCBjYXApIG9yIChOb25lLCBOb25lKSBpZiBub3QgZm91bmQKICAgICIiIgogICAgaWYgbm90IEhBU19FTlVNRVJBVEU6CiAgICAgICAgbG9nZ2VyLmRlYnVnKCJjdjItZW51bWVyYXRlLWNhbWVyYXMgbm90IGF2YWlsYWJsZSwgc2tpcHBpbmcgbmFtZSBzZWFyY2giKQogICAgICAgIHJldHVybiBOb25lLCBOb25lCiAgICAKICAgIGlzX21hYyA9IHBsYXRmb3JtLnN5c3RlbSgpID09ICdEYXJ3aW4nCiAgICBpZiBiYWNrZW5kIGlzIE5vbmUgYW5kIGlzX21hYzoKICAgICAgICBiYWNrZW5kID0gY3YyLkNBUF9BVkZPVU5EQVRJT04KICAgIAogICAgIyBLZXl3b3JkcyB0byBFWENMVURFIChpUGhvbmUsIENvbnRpbnVpdHkgQ2FtZXJhLCBGYWNlVGltZSkKICAgICMgT25seSBleGNsdWRlIGlmIGFsbG93X2lwaG9uZSBpcyBGYWxzZQogICAgZXhjbHVkZV9rZXl3b3JkcyA9IFtdCiAgICBpZiBub3QgYWxsb3dfaXBob25lOgogICAgICAgIGV4Y2x1ZGVfa2V5d29yZHMgPSBbJ0lQSE9ORScsICdDT05USU5VSVRZJywgJ0ZBQ0VUSU1FJywgJ0lQQUQnXQogICAgCiAgICBsb2dnZXIuaW5mbyhmIlNlYXJjaGluZyBmb3IgY2FtZXJhIGJ5IG5hbWU6IHtuYW1lX2tleXdvcmRzfS4uLiIpCiAgICBpZiBleGNsdWRlX2tleXdvcmRzOgogICAgICAgIGxvZ2dlci5pbmZvKGYiRXhjbHVkaW5nOiB7ZXhjbHVkZV9rZXl3b3Jkc30iKQogICAgZWxzZToKICAgICAgICBsb2dnZXIuaW5mbygiaVBob25lL0NvbnRpbnVpdHkgQ2FtZXJhIGFsbG93ZWQiKQogICAgCiAgICB0cnk6CiAgICAgICAgZm9yIGNhbWVyYV9pbmZvIGluIGN2Ml9lbnVtZXJhdGVfY2FtZXJhcyhiYWNrZW5kKToKICAgICAgICAgICAgY2FtZXJhX25hbWUgPSBjYW1lcmFfaW5mby5uYW1lLnVwcGVyKCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgIENoZWNraW5nIGNhbWVyYSB7Y2FtZXJhX2luZm8uaW5kZXh9OiB7Y2FtZXJhX2luZm8ubmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBTa2lwIGlQaG9uZS9Db250aW51aXR5IENhbWVyYQogICAgICAgICAgICBpZiBhbnkoZXhjbHVkZSBpbiBjYW1lcmFfbmFtZSBmb3IgZXhjbHVkZSBpbiBleGNsdWRlX2tleXdvcmRzKToKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiICDij63vuI8gIFNraXBwaW5nIHtjYW1lcmFfaW5mby5uYW1lfSAoaVBob25lL0NvbnRpbnVpdHkgQ2FtZXJhKSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGtleXdvcmQgaW4gbmFtZV9rZXl3b3JkczoKICAgICAgICAgICAgICAgIGlmIGtleXdvcmQudXBwZXIoKSBpbiBjYW1lcmFfbmFtZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBGb3VuZCEge2NhbWVyYV9pbmZvLm5hbWV9IGF0IGluZGV4IHtjYW1lcmFfaW5mby5pbmRleH0gKGJhY2tlbmQ6IHtjYW1lcmFfaW5mby5iYWNrZW5kfSkiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVXNlIHRoZSBiYWNrZW5kIGZyb20gZW51bWVyYXRlX2NhbWVyYXMgKGltcG9ydGFudCBvbiBtYWNPUyEpCiAgICAgICAgICAgICAgICAgICAgY2FwID0gY3YyLlZpZGVvQ2FwdHVyZShjYW1lcmFfaW5mby5pbmRleCwgY2FtZXJhX2luZm8uYmFja2VuZCkKICAgICAgICAgICAgICAgICAgICBpZiBjYXAuaXNPcGVuZWQoKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBTZXQgcmVzb2x1dGlvbiBhbmQgdGVzdAogICAgICAgICAgICAgICAgICAgICAgICBjYXAuc2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9XSURUSCwgMTkyMCkKICAgICAgICAgICAgICAgICAgICAgICAgY2FwLnNldChjdjIuQ0FQX1BST1BfRlJBTUVfSEVJR0hULCAxMDgwKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZWFkIGEgZmV3IGZyYW1lcyB0byBlbnN1cmUgaXQgd29ya3MKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UoNSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQsIF8gPSBjYXAucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmV0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMDUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFZlcmlmeSB3ZSBnb3QgdGhlIHJpZ2h0IGNhbWVyYSBieSBjaGVja2luZyByZXNvbHV0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdHVhbF93aWR0aCA9IGludChjYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9XSURUSCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdHVhbF9oZWlnaHQgPSBpbnQoY2FwLmdldChjdjIuQ0FQX1BST1BfRlJBTUVfSEVJR0hUKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgICBDYW1lcmEgb3BlbmVkOiB7YWN0dWFsX3dpZHRofXh7YWN0dWFsX2hlaWdodH0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbWVyYV9pbmZvLmluZGV4LCBjYXAKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIiAg4pqg77iPICBDb3VsZCBub3Qgb3BlbiBjYW1lcmEge2NhbWVyYV9pbmZvLmluZGV4fSIpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiIgIOKdjCBObyBjYW1lcmEgZm91bmQgd2l0aCBuYW1lczoge25hbWVfa2V5d29yZHN9IikKICAgICAgICByZXR1cm4gTm9uZSwgTm9uZQogICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICDimqDvuI8gIEVycm9yIHVzaW5nIGN2Mi1lbnVtZXJhdGUtY2FtZXJhczoge2V9IikKICAgICAgICByZXR1cm4gTm9uZSwgTm9uZQoKCmRlZiBmaW5kX2NhbWVyYV9ieV9yZXNvbHV0aW9uKHRhcmdldF93aWR0aDogaW50ID0gMTkyMCwgdGFyZ2V0X2hlaWdodDogaW50ID0gMTA4MCwgYmFja2VuZD1Ob25lKSAtPiBPcHRpb25hbFtUdXBsZVtpbnQsIGN2Mi5WaWRlb0NhcHR1cmVdXToKICAgICIiIgogICAgRmluZCBjYW1lcmEgd2l0aCBzcGVjaWZpYyByZXNvbHV0aW9uIChmYWxsYmFjayBtZXRob2QpLgogICAgCiAgICBBcmdzOgogICAgICAgIHRhcmdldF93aWR0aDogRXhwZWN0ZWQgd2lkdGgKICAgICAgICB0YXJnZXRfaGVpZ2h0OiBFeHBlY3RlZCBoZWlnaHQKICAgICAgICBiYWNrZW5kOiBPcGVuQ1YgYmFja2VuZCB0byB1c2UKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgKGNhbWVyYV9pbmRleCwgY2FwKSBvciAoTm9uZSwgTm9uZSkgaWYgbm90IGZvdW5kCiAgICAiIiIKICAgIGlzX21hYyA9IHBsYXRmb3JtLnN5c3RlbSgpID09ICdEYXJ3aW4nCiAgICBpZiBiYWNrZW5kIGlzIE5vbmUgYW5kIGlzX21hYzoKICAgICAgICBiYWNrZW5kID0gY3YyLkNBUF9BVkZPVU5EQVRJT04KICAgIAogICAgbG9nZ2VyLmluZm8oZiJTZWFyY2hpbmcgZm9yIGNhbWVyYSB3aXRoIHJlc29sdXRpb24ge3RhcmdldF93aWR0aH14e3RhcmdldF9oZWlnaHR9Li4uIikKICAgIAogICAgZm9yIGluZGV4IGluIHJhbmdlKDYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgYmFja2VuZDoKICAgICAgICAgICAgICAgIGNhcCA9IGN2Mi5WaWRlb0NhcHR1cmUoaW5kZXgsIGJhY2tlbmQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjYXAgPSBjdjIuVmlkZW9DYXB0dXJlKGluZGV4KQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGNhcC5pc09wZW5lZCgpOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGNhcC5zZXQoY3YyLkNBUF9QUk9QX0ZSQU1FX1dJRFRILCB0YXJnZXRfd2lkdGgpCiAgICAgICAgICAgIGNhcC5zZXQoY3YyLkNBUF9QUk9QX0ZSQU1FX0hFSUdIVCwgdGFyZ2V0X2hlaWdodCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVhZCBmcmFtZXMgdG8gZ2V0IGFjdHVhbCByZXNvbHV0aW9uCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgICAgICAgICAgcmV0LCBfID0gY2FwLnJlYWQoKQogICAgICAgICAgICAgICAgaWYgbm90IHJldDoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjA1KQogICAgICAgICAgICAKICAgICAgICAgICAgYWN0dWFsX3dpZHRoID0gaW50KGNhcC5nZXQoY3YyLkNBUF9QUk9QX0ZSQU1FX1dJRFRIKSkKICAgICAgICAgICAgYWN0dWFsX2hlaWdodCA9IGludChjYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9IRUlHSFQpKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiICBDYW1lcmEge2luZGV4fToge2FjdHVhbF93aWR0aH14e2FjdHVhbF9oZWlnaHR9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGFjdHVhbF93aWR0aCA9PSB0YXJnZXRfd2lkdGggYW5kIGFjdHVhbF9oZWlnaHQgPT0gdGFyZ2V0X2hlaWdodDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIEZvdW5kISBDYW1lcmEge2luZGV4fSBoYXMge3RhcmdldF93aWR0aH14e3RhcmdldF9oZWlnaHR9IikKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleCwgY2FwCiAgICAgICAgICAgIAogICAgICAgICAgICBjYXAucmVsZWFzZSgpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4xKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIiAg4pqg77iPICBFcnJvciB0ZXN0aW5nIGNhbWVyYSB7aW5kZXh9OiB7ZX0iKQogICAgICAgICAgICBjb250aW51ZQogICAgCiAgICBsb2dnZXIuaW5mbyhmIiAg4p2MIE5vIGNhbWVyYSBmb3VuZCB3aXRoIHJlc29sdXRpb24ge3RhcmdldF93aWR0aH14e3RhcmdldF9oZWlnaHR9IikKICAgIHJldHVybiBOb25lLCBOb25lCgoKZGVmIGZpbmRfZXh0ZXJuYWxfY2FtZXJhKHByZWZlcnJlZF9pbmRleDogT3B0aW9uYWxbaW50XSA9IE5vbmUsIGFsbG93X2lwaG9uZTogYm9vbCA9IEZhbHNlKSAtPiBPcHRpb25hbFtpbnRdOgogICAgIiIiCiAgICBGaW5kIGV4dGVybmFsIGNhbWVyYSB1c2luZyBtdWx0aXBsZSBtZXRob2RzIChtb3N0IHJlbGlhYmxlIG9uIG1hY09TKS4KICAgIAogICAgU3RyYXRlZ3k6CiAgICAxLiBJZiBwcmVmZXJyZWRfaW5kZXggc3BlY2lmaWVkLCB0cnkgdG8gdXNlIGl0IGRpcmVjdGx5IChldmVuIGlmIGlQaG9uZSkKICAgIDIuIFRyeSB0byBmaW5kIGJ5IG5hbWUgKEMyNzAsIFVWQywgTG9naXRlY2gpIC0gbW9zdCByZWxpYWJsZSBvbiBtYWNPUwogICAgMy4gVHJ5IHRvIGZpbmQgYnkgcmVzb2x1dGlvbiAoMTkyMHgxMDgwKSAtIGZhbGxiYWNrCiAgICA0LiBVc2UgYW55IG5vbi16ZXJvIGNhbWVyYSAtIGxhc3QgcmVzb3J0CiAgICAKICAgIEFyZ3M6CiAgICAgICAgcHJlZmVycmVkX2luZGV4OiBJZiBwcm92aWRlZCwgdHJ5IHRoaXMgaW5kZXggZmlyc3QgKGV2ZW4gaWYgaVBob25lKQogICAgICAgIGFsbG93X2lwaG9uZTogSWYgVHJ1ZSwgYWxsb3cgaVBob25lL0NvbnRpbnVpdHkgQ2FtZXJhIChkZWZhdWx0OiBGYWxzZSkKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgQ2FtZXJhIGluZGV4IGlmIGZvdW5kLCBOb25lIG90aGVyd2lzZQogICAgIiIiCiAgICBpc19tYWMgPSBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnRGFyd2luJwogICAgCiAgICAjIE1ldGhvZCAwOiBJZiBwcmVmZXJyZWRfaW5kZXggaXMgc3BlY2lmaWVkLCB0cnkgaXQgZGlyZWN0bHkgKGV2ZW4gaWYgaVBob25lKQogICAgIyBUaGlzIGFsbG93cyB1c2VyIHRvIGV4cGxpY2l0bHkgdXNlIGlQaG9uZSBieSBzZXR0aW5nIGluZGV4IGluIGNvbmZpZy55YW1sCiAgICBpZiBwcmVmZXJyZWRfaW5kZXggaXMgbm90IE5vbmU6CiAgICAgICAgbG9nZ2VyLmluZm8oZiJUcnlpbmcgcHJlZmVycmVkIGNhbWVyYSBpbmRleCB7cHJlZmVycmVkX2luZGV4fSAoaVBob25lIGFsbG93ZWQgaWYgc3BlY2lmaWVkKS4uLiIpCiAgICAgICAgYmFja2VuZCA9IGN2Mi5DQVBfQVZGT1VOREFUSU9OIGlmIGlzX21hYyBlbHNlIE5vbmUKICAgICAgICAKICAgICAgICBpZiBiYWNrZW5kOgogICAgICAgICAgICBjYXAgPSBjdjIuVmlkZW9DYXB0dXJlKHByZWZlcnJlZF9pbmRleCwgYmFja2VuZCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBjYXAgPSBjdjIuVmlkZW9DYXB0dXJlKHByZWZlcnJlZF9pbmRleCkKICAgICAgICAKICAgICAgICBpZiBjYXAuaXNPcGVuZWQoKToKICAgICAgICAgICAgcmV0LCBfID0gY2FwLnJlYWQoKQogICAgICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgICAgICB3aWR0aCA9IGludChjYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9XSURUSCkpCiAgICAgICAgICAgICAgICBoZWlnaHQgPSBpbnQoY2FwLmdldChjdjIuQ0FQX1BST1BfRlJBTUVfSEVJR0hUKSkKICAgICAgICAgICAgICAgIGNhcC5yZWxlYXNlKCkKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIFVzaW5nIHByZWZlcnJlZCBjYW1lcmEge3ByZWZlcnJlZF9pbmRleH0gKHt3aWR0aH14e2hlaWdodH0pIikKICAgICAgICAgICAgICAgIHJldHVybiBwcmVmZXJyZWRfaW5kZXgKICAgICAgICAgICAgY2FwLnJlbGVhc2UoKQogICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUHJlZmVycmVkIGNhbWVyYSB7cHJlZmVycmVkX2luZGV4fSBub3Qgd29ya2luZywgdHJ5aW5nIG90aGVyIG1ldGhvZHMuLi4iKQogICAgCiAgICAjIE1ldGhvZCAxOiBTZWFyY2ggYnkgbmFtZSBGSVJTVCAobW9zdCByZWxpYWJsZSBvbiBtYWNPUywgaWdub3JlcyBpbmRleCBjb25mdXNpb24pCiAgICAjIFRoaXMgaXMgdGhlIGtleSAtIHdlIHByaW9yaXRpemUgbmFtZSBzZWFyY2ggb3ZlciBpbmRleCB0byBhdm9pZCBtYWNPUyBpbmRleCBidWdzCiAgICAjIE9ubHkgZXhjbHVkZSBpUGhvbmUgaWYgYWxsb3dfaXBob25lIGlzIEZhbHNlCiAgICBpZiBIQVNfRU5VTUVSQVRFOgogICAgICAgIGxvZ2dlci5pbmZvKCLwn5SNIFNlYXJjaGluZyBmb3IgY2FtZXJhIGJ5IG5hbWUgKEMyNzAsIFVWQywgTG9naXRlY2gpLi4uIikKICAgICAgICBzZWFyY2hfa2V5d29yZHMgPSBbIkMyNzAiLCAiVVZDIiwgIkxvZ2l0ZWNoIiwgIlVTQiIsICJFeHRlcm5hbCJdCiAgICAgICAgaWYgYWxsb3dfaXBob25lOgogICAgICAgICAgICBzZWFyY2hfa2V5d29yZHMuZXh0ZW5kKFsiaVBob25lIiwgIkNvbnRpbnVpdHkiXSkKICAgICAgICBpbmRleCwgY2FwID0gZmluZF9jYW1lcmFfYnlfbmFtZShzZWFyY2hfa2V5d29yZHMsIGFsbG93X2lwaG9uZT1hbGxvd19pcGhvbmUpCiAgICAgICAgaWYgY2FwOgogICAgICAgICAgICAjIEdldCBhY3R1YWwgcmVzb2x1dGlvbiB0byB2ZXJpZnkKICAgICAgICAgICAgYWN0dWFsX3cgPSBpbnQoY2FwLmdldChjdjIuQ0FQX1BST1BfRlJBTUVfV0lEVEgpKQogICAgICAgICAgICBhY3R1YWxfaCA9IGludChjYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9IRUlHSFQpKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBGb3VuZCBleHRlcm5hbCBjYW1lcmEgYnkgbmFtZSBhdCBpbmRleCB7aW5kZXh9ICh7YWN0dWFsX3d9eHthY3R1YWxfaH0pIikKICAgICAgICAgICAgY2FwLnJlbGVhc2UoKQogICAgICAgICAgICByZXR1cm4gaW5kZXgKICAgIAogICAgCiAgICAjIE1ldGhvZCAzOiBTZWFyY2ggYnkgcmVzb2x1dGlvbiAoZmFsbGJhY2spCiAgICAKICAgICMgTWV0aG9kIDM6IFNlYXJjaCBieSByZXNvbHV0aW9uICgxOTIweDEwODAgPSBleHRlcm5hbCBjYW1lcmEpCiAgICBsb2dnZXIuaW5mbygi8J+UjSBTZWFyY2hpbmcgZm9yIGNhbWVyYSBieSByZXNvbHV0aW9uICgxOTIweDEwODApLi4uIikKICAgIGluZGV4LCBjYXAgPSBmaW5kX2NhbWVyYV9ieV9yZXNvbHV0aW9uKDE5MjAsIDEwODApCiAgICBpZiBjYXA6CiAgICAgICAgY2FwLnJlbGVhc2UoKQogICAgICAgIHJldHVybiBpbmRleAogICAgCiAgICAjIE1ldGhvZCA0OiBGYWxsYmFjayAtIHVzZSBhbnkgbm9uLXplcm8gY2FtZXJhIChpUGhvbmUgYWxyZWFkeSBleGNsdWRlZCBieSBlbnVtZXJhdGVfY2FtZXJhcykKICAgIGxvZ2dlci5pbmZvKCJGYWxsYmFjazogTG9va2luZyBmb3IgYW55IG5vbi1idWlsdC1pbiBjYW1lcmEuLi4iKQogICAgY2FtZXJhcyA9IGVudW1lcmF0ZV9jYW1lcmFzKCkKICAgIGV4dGVybmFsX2NhbWVyYXMgPSBbY2FtIGZvciBjYW0gaW4gY2FtZXJhcyBpZiBjYW1bJ2luZGV4J10gIT0gMF0KICAgIAogICAgaWYgZXh0ZXJuYWxfY2FtZXJhczoKICAgICAgICBiZXN0ID0gbWF4KGV4dGVybmFsX2NhbWVyYXMsIGtleT1sYW1iZGEgYzogY1snd2lkdGgnXSAqIGNbJ2hlaWdodCddKQogICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIFVzaW5nIGV4dGVybmFsIGNhbWVyYSB7YmVzdFsnaW5kZXgnXX0gKHtiZXN0Wyd3aWR0aCddfXh7YmVzdFsnaGVpZ2h0J119KSIpCiAgICAgICAgcmV0dXJuIGJlc3RbJ2luZGV4J10KICAgIAogICAgIyBMYXN0IHJlc29ydDogdXNlIGFueSBhdmFpbGFibGUgY2FtZXJhIChpbmNsdWRpbmcgYnVpbHQtaW4gaWYgdGhhdCdzIGFsbCB3ZSBoYXZlKQogICAgaWYgY2FtZXJhczoKICAgICAgICBmYWxsYmFjayA9IGNhbWVyYXNbMF1bJ2luZGV4J10KICAgICAgICBpZiBmYWxsYmFjayA9PSAwOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyAgT25seSBidWlsdC1pbiBjYW1lcmEgKGluZGV4IDApIGF2YWlsYWJsZSAtIHVzaW5nIGl0IGFzIGZhbGxiYWNrIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlVzaW5nIGNhbWVyYSB7ZmFsbGJhY2t9IChvbmx5IGNhbWVyYSBhdmFpbGFibGUpIikKICAgICAgICByZXR1cm4gZmFsbGJhY2sKICAgIAogICAgbG9nZ2VyLmVycm9yKCLinYwgTm8gY2FtZXJhcyBmb3VuZCIpCiAgICByZXR1cm4gTm9uZQoKCmRlZiBfcmVhZF9mcmFtZV93aXRoX3RpbWVvdXQoY2FwOiBjdjIuVmlkZW9DYXB0dXJlLCB0aW1lb3V0OiBmbG9hdCA9IDUuMCkgLT4gVHVwbGVbYm9vbCwgT3B0aW9uYWxbbnAubmRhcnJheV1dOgogICAgIiIiCiAgICBSZWFkcyBhIGZyYW1lIGZyb20gdGhlIGNhbWVyYSB3aXRoIGEgdGltZW91dC4KICAgIAogICAgQXJnczoKICAgICAgICBjYXA6IE9wZW5DViBWaWRlb0NhcHR1cmUgb2JqZWN0CiAgICAgICAgdGltZW91dDogTWF4aW11bSB0aW1lIHRvIHdhaXQgZm9yIGZyYW1lIChzZWNvbmRzKQogICAgICAgIAogICAgUmV0dXJuczoKICAgICAgICBUdXBsZSBvZiAoc3VjY2VzczogYm9vbCwgZnJhbWU6IE9wdGlvbmFsW25wLm5kYXJyYXldKQogICAgIiIiCiAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgIHdoaWxlIFRydWU6CiAgICAgICAgcmV0LCBmcmFtZSA9IGNhcC5yZWFkKCkKICAgICAgICBpZiByZXQgYW5kIGZyYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXR1cm4gVHJ1ZSwgZnJhbWUKICAgICAgICBpZiB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPiB0aW1lb3V0OgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyAgVGltZW91dCAoe3RpbWVvdXQ6LjFmfXMpIHJlYWNoZWQgd2hpbGUgcmVhZGluZyBmcmFtZS4iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UsIE5vbmUKICAgICAgICB0aW1lLnNsZWVwKDAuMDEpICAjIFNtYWxsIGRlbGF5IHRvIHByZXZlbnQgYnVzeS13YWl0aW5nCgoKZGVmIG9wZW5fY2FtZXJhKAogICAgc291cmNlOiBVbmlvbltpbnQsIHN0cl0sCiAgICByZXNvbHV0aW9uOiBPcHRpb25hbFtUdXBsZVtpbnQsIGludF1dID0gTm9uZSwKICAgIGJ1ZmZlcl9zaXplOiBPcHRpb25hbFtpbnRdID0gTm9uZSwKICAgIGJhY2tlbmQ6IE9wdGlvbmFsW2ludF0gPSBOb25lCikgLT4gT3B0aW9uYWxbY3YyLlZpZGVvQ2FwdHVyZV06CiAgICAiIiIKICAgIE9wZW4gY2FtZXJhIGZyb20gc291cmNlIChpbmRleCBvciBSVFNQIFVSTCkuCiAgICAKICAgIEFyZ3M6CiAgICAgICAgc291cmNlOiBDYW1lcmEgc291cmNlIC0gY2FuIGJlOgogICAgICAgICAgICAtIGludDogQ2FtZXJhIGluZGV4ICgwLCAxLCAyLi4uKSBmb3IgVVNCL3dlYmNhbQogICAgICAgICAgICAtIHN0cjogUlRTUCBVUkwgKGUuZy4sICJydHNwOi8vdXNlcjpwYXNzQGlwOnBvcnQvc3RyZWFtIikgZm9yIElQIGNhbWVyYXMKICAgICAgICByZXNvbHV0aW9uOiBPcHRpb25hbCAod2lkdGgsIGhlaWdodCkgdHVwbGUgdG8gc2V0IHJlc29sdXRpb24KICAgICAgICBidWZmZXJfc2l6ZTogT3B0aW9uYWwgYnVmZmVyIHNpemUgKGltcG9ydGFudCBmb3IgUlRTUCBzdHJlYW1zLCB1c2UgMSBmb3IgbG93IGxhdGVuY3kpCiAgICAgICAgYmFja2VuZDogT3B0aW9uYWwgT3BlbkNWIGJhY2tlbmQgKGUuZy4sIGN2Mi5DQVBfQVZGT1VOREFUSU9OIGZvciBtYWNPUykKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgY3YyLlZpZGVvQ2FwdHVyZSBvYmplY3QgaWYgc3VjY2Vzc2Z1bCwgTm9uZSBvdGhlcndpc2UKICAgICIiIgogICAgaXNfcnRzcCA9IGlzaW5zdGFuY2Uoc291cmNlLCBzdHIpIGFuZCBzb3VyY2Uuc3RhcnRzd2l0aCgncnRzcDovLycpCiAgICAKICAgIGlmIGlzX3J0c3A6CiAgICAgICAgbG9nZ2VyLmluZm8oZiJPcGVuaW5nIFJUU1Agc3RyZWFtOiB7c291cmNlWzo1MF19Li4uIikKICAgICAgICAKICAgICAgICAjIEZvciBSVFNQLCBhZGQgb3B0aW9ucyB0byBwcmV2ZW50IGJsb2NraW5nL3RpbWVvdXRzCiAgICAgICAgIyBVc2UgVENQIHRyYW5zcG9ydCBmb3IgcmVsaWFiaWxpdHkgKFVEUCBjYW4gYmUgZmFzdGVyIGJ1dCBsZXNzIHJlbGlhYmxlKQogICAgICAgICMgTm90ZTogU29tZSBjYW1lcmFzIG1heSBub3Qgc3VwcG9ydCBUQ1AsIHNvIHdlIHRyeSBib3RoCiAgICAgICAgcnRzcF93aXRoX3RjcCA9IGYie3NvdXJjZX0/cnRzcF90cmFuc3BvcnQ9dGNwIgogICAgICAgIAogICAgICAgICMgVHJ5IHdpdGggVENQIGZpcnN0IChtb3JlIHJlbGlhYmxlIGJ1dCBwb3RlbnRpYWxseSBzbG93ZXIpCiAgICAgICAgY2FwID0gY3YyLlZpZGVvQ2FwdHVyZShydHNwX3dpdGhfdGNwLCBjdjIuQ0FQX0ZGTVBFRykKICAgICAgICAKICAgICAgICBpZiBub3QgY2FwLmlzT3BlbmVkKCk6CiAgICAgICAgICAgICMgVHJ5IHdpdGhvdXQgVENQIHRyYW5zcG9ydCBhcyBmYWxsYmFjawogICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHdpdGggVENQIHRyYW5zcG9ydCwgdHJ5aW5nIGRlZmF1bHQuLi4iKQogICAgICAgICAgICBjYXAgPSBjdjIuVmlkZW9DYXB0dXJlKHNvdXJjZSwgY3YyLkNBUF9GRk1QRUcpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGNhcC5pc09wZW5lZCgpOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gb3BlbiBSVFNQIHN0cmVhbToge3NvdXJjZVs6NTBdfS4uLiIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgIyBTZXQgYnVmZmVyIHNpemUgZm9yIFJUU1AgKGNyaXRpY2FsIGZvciBsb3cgbGF0ZW5jeSkKICAgICAgICAjIEZvciBSVFNQLCBidWZmZXJfc2l6ZT0xIHByZXZlbnRzIGFjY3VtdWxhdGlvbiBvZiBvbGQgZnJhbWVzCiAgICAgICAgaWYgYnVmZmVyX3NpemUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGNhcC5zZXQoY3YyLkNBUF9QUk9QX0JVRkZFUlNJWkUsIGJ1ZmZlcl9zaXplKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlNldCBSVFNQIGJ1ZmZlciBzaXplOiB7YnVmZmVyX3NpemV9IikKICAgICAgICAKICAgICAgICAjIFNldCB0aW1lb3V0IHByb3BlcnRpZXMgZm9yIFJUU1AgKGluIG1pbGxpc2Vjb25kcykKICAgICAgICAjIE9wZW5DViBkb2Vzbid0IHN1cHBvcnQgZGlyZWN0IHRpbWVvdXQsIGJ1dCB3ZSBjYW4gc2V0IHJlYWQgdGltZW91dCB2aWEgZW52aXJvbm1lbnQKICAgICAgICAjIEZvciBub3csIHdlIHJlbHkgb24gYnVmZmVyX3NpemU9MSB0byBtaW5pbWl6ZSBkZWxheQogICAgICAgIAogICAgICAgICMgU2V0IHJlc29sdXRpb24gaWYgcHJvdmlkZWQKICAgICAgICBpZiByZXNvbHV0aW9uOgogICAgICAgICAgICB3LCBoID0gcmVzb2x1dGlvbgogICAgICAgICAgICBjYXAuc2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9XSURUSCwgdykKICAgICAgICAgICAgY2FwLnNldChjdjIuQ0FQX1BST1BfRlJBTUVfSEVJR0hULCBoKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlJlcXVlc3RlZCByZXNvbHV0aW9uOiB7d314e2h9IikKICAgICAgICAKICAgICAgICAjIFZlcmlmeSBjb25uZWN0aW9uIGJ5IHJlYWRpbmcgYSBmcmFtZQogICAgICAgICMg4pqg77iPIElNUE9SVEFOVEU6IFBhcmEgNEsgSEVWQyBlbiBNYWMgSW50ZWwsIGVsIHByaW1lciBmcmFtZSBwdWVkZSB0YXJkYXIgbcOhcyAoMTAtMTVzKQogICAgICAgICMgTG9zIGVycm9yZXMgSEVWQyBzb24gd2FybmluZ3MgZGUgRkZtcGVnLCBubyBibG9xdWVhbiwgcGVybyByYWxlbnRpemFuIGxhIGRlY29kaWZpY2FjacOzbgogICAgICAgIGxvZ2dlci5pbmZvKCJSZWFkaW5nIGZpcnN0IGZyYW1lICh0aGlzIG1heSB0YWtlIDEwLTE1cyBmb3IgNEsgSEVWQyBvbiBNYWMgSW50ZWwpLi4uIikKICAgICAgICByZXQsIGZyYW1lID0gX3JlYWRfZnJhbWVfd2l0aF90aW1lb3V0KGNhcCwgdGltZW91dD0xNS4wKSAgIyBJbmNyZWFzZWQgdGltZW91dCBmb3IgNEsgSEVWQwogICAgICAgIAogICAgICAgIGlmIG5vdCByZXQgb3IgZnJhbWUgaXMgTm9uZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIuKaoO+4jyAgUlRTUCBzdHJlYW0gb3BlbmVkIGJ1dCBmaXJzdCBmcmFtZSByZWFkIGZhaWxlZCBhZnRlciAxNXMgdGltZW91dCIpCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCIgICBGb3IgNEsgSEVWQyBvbiBNYWMgSW50ZWwsIHRoaXMgbWF5IGJlIG5vcm1hbCAoSEVWQyBkZWNvZGluZyBpcyBzbG93KSIpCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCIgICBUaGUgc3lzdGVtIHdpbGwgcmV0cnkgYXV0b21hdGljYWxseSBpbiB0aGUgbWFpbiBsb29wIikKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIiAgIOKaoO+4jyAgTm90ZTogSEVWQyBlcnJvcnMgaW4gbG9ncyBhcmUgd2FybmluZ3MsIG5vdCBmYXRhbCAtIHByb2Nlc3NpbmcgY29udGludWVzIikKICAgICAgICAgICAgIyBEb24ndCBmYWlsIGltbWVkaWF0ZWx5IC0gbGV0IHRoZSBtYWluIGxvb3AgaGFuZGxlIHJldHJpZXMKICAgICAgICAgICAgIyBTb21lIFJUU1Agc3RyZWFtcyBuZWVkIGEgZmV3IGF0dGVtcHRzIHRvIHN0YXJ0LCBlc3BlY2lhbGx5IDRLIEhFVkMKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBGaXJzdCBmcmFtZSByZWFkIHN1Y2Nlc3NmdWxseToge2ZyYW1lLnNoYXBlWzFdfXh7ZnJhbWUuc2hhcGVbMF19IikKICAgICAgICAKICAgICAgICAjIFN0aWxsIHJldHVybiB0aGUgY2FwIGV2ZW4gaWYgZmlyc3QgZnJhbWUgZmFpbHMgLSBtYWluIGxvb3Agd2lsbCBoYW5kbGUgcmV0cmllcwogICAgICAgIAogICAgICAgIGFjdHVhbF93ID0gaW50KGNhcC5nZXQoY3YyLkNBUF9QUk9QX0ZSQU1FX1dJRFRIKSkKICAgICAgICBhY3R1YWxfaCA9IGludChjYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9IRUlHSFQpKQogICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIFJUU1Agc3RyZWFtIG9wZW5lZDoge2FjdHVhbF93fXh7YWN0dWFsX2h9IikKICAgICAgICByZXR1cm4gY2FwCiAgICAKICAgIGVsc2U6CiAgICAgICAgIyBJbnRlZ2VyIGluZGV4IC0gVVNCL3dlYmNhbSBjYW1lcmEKICAgICAgICBjYW1lcmFfaW5kZXggPSBpbnQoc291cmNlKQogICAgICAgIGxvZ2dlci5pbmZvKGYiT3BlbmluZyBjYW1lcmEgaW5kZXg6IHtjYW1lcmFfaW5kZXh9IikKICAgICAgICAKICAgICAgICAjIFVzZSBiYWNrZW5kIGlmIHByb3ZpZGVkIChpbXBvcnRhbnQgZm9yIG1hY09TKQogICAgICAgIGlmIGJhY2tlbmQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGNhcCA9IGN2Mi5WaWRlb0NhcHR1cmUoY2FtZXJhX2luZGV4LCBiYWNrZW5kKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgQXV0by1kZXRlY3QgYmFja2VuZCBmb3IgbWFjT1MKICAgICAgICAgICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ0Rhcndpbic6CiAgICAgICAgICAgICAgICBjYXAgPSBjdjIuVmlkZW9DYXB0dXJlKGNhbWVyYV9pbmRleCwgY3YyLkNBUF9BVkZPVU5EQVRJT04pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjYXAgPSBjdjIuVmlkZW9DYXB0dXJlKGNhbWVyYV9pbmRleCkKICAgICAgICAKICAgICAgICBpZiBub3QgY2FwLmlzT3BlbmVkKCk6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBvcGVuIGNhbWVyYSBpbmRleCB7Y2FtZXJhX2luZGV4fSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgIyBTZXQgcmVzb2x1dGlvbiBpZiBwcm92aWRlZAogICAgICAgIGlmIHJlc29sdXRpb246CiAgICAgICAgICAgIHcsIGggPSByZXNvbHV0aW9uCiAgICAgICAgICAgIGNhcC5zZXQoY3YyLkNBUF9QUk9QX0ZSQU1FX1dJRFRILCB3KQogICAgICAgICAgICBjYXAuc2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9IRUlHSFQsIGgpCiAgICAgICAgCiAgICAgICAgIyBWZXJpZnkgYnkgcmVhZGluZyBhIGZyYW1lCiAgICAgICAgcmV0LCBmcmFtZSA9IGNhcC5yZWFkKCkKICAgICAgICBpZiBub3QgcmV0IG9yIGZyYW1lIGlzIE5vbmU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkNhbWVyYSB7Y2FtZXJhX2luZGV4fSBvcGVuZWQgYnV0IGNhbm5vdCByZWFkIGZyYW1lcyIpCiAgICAgICAgICAgIGNhcC5yZWxlYXNlKCkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgICAgICBhY3R1YWxfdyA9IGludChjYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9XSURUSCkpCiAgICAgICAgYWN0dWFsX2ggPSBpbnQoY2FwLmdldChjdjIuQ0FQX1BST1BfRlJBTUVfSEVJR0hUKSkKICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBDYW1lcmEge2NhbWVyYV9pbmRleH0gb3BlbmVkOiB7YWN0dWFsX3d9eHthY3R1YWxfaH0iKQogICAgICAgIHJldHVybiBjYXAKCgpkZWYgdGVzdF9jYW1lcmEoaW5kZXg6IGludCwgZHVyYXRpb25fc2Vjb25kczogaW50ID0gNSkgLT4gYm9vbDoKICAgICIiIgogICAgVGVzdCBjYW1lcmEgYnkgY2FwdHVyaW5nIGZyYW1lcyBmb3Igc3BlY2lmaWVkIGR1cmF0aW9uLgogICAgCiAgICBBcmdzOgogICAgICAgIGluZGV4OiBDYW1lcmEgaW5kZXggdG8gdGVzdAogICAgICAgIGR1cmF0aW9uX3NlY29uZHM6IEhvdyBsb25nIHRvIHRlc3QKICAgICAgICAKICAgIFJldHVybnM6CiAgICAgICAgVHJ1ZSBpZiBjYW1lcmEgd29ya3MsIEZhbHNlIG90aGVyd2lzZQogICAgIiIiCiAgICBsb2dnZXIuaW5mbyhmIlRlc3RpbmcgY2FtZXJhIHtpbmRleH0gZm9yIHtkdXJhdGlvbl9zZWNvbmRzfSBzZWNvbmRzLi4uIikKICAgIAogICAgY2FwID0gY3YyLlZpZGVvQ2FwdHVyZShpbmRleCkKICAgIAogICAgaWYgbm90IGNhcC5pc09wZW5lZCgpOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBvcGVuIGNhbWVyYSB7aW5kZXh9IikKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgaW1wb3J0IHRpbWUKICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgZnJhbWVfY291bnQgPSAwCiAgICAKICAgIHRyeToKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCBkdXJhdGlvbl9zZWNvbmRzOgogICAgICAgICAgICByZXQsIGZyYW1lID0gY2FwLnJlYWQoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHJldCBvciBmcmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRmFpbGVkIHRvIHJlYWQgZnJhbWUgZnJvbSBjYW1lcmEge2luZGV4fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGZyYW1lX2NvdW50ICs9IDEKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2hvdyBwcmV2aWV3CiAgICAgICAgICAgIGN2Mi5pbXNob3coZidDYW1lcmEge2luZGV4fSBUZXN0IC0gUHJlc3MgUSB0byBza2lwJywgZnJhbWUpCiAgICAgICAgICAgIGlmIGN2Mi53YWl0S2V5KDEpICYgMHhGRiA9PSBvcmQoJ3EnKToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgCiAgICAgICAgZnBzID0gZnJhbWVfY291bnQgLyBkdXJhdGlvbl9zZWNvbmRzCiAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUgQ2FtZXJhIHtpbmRleH0gd29ya2luZzoge2ZyYW1lX2NvdW50fSBmcmFtZXMgaW4ge2R1cmF0aW9uX3NlY29uZHN9cyAoe2ZwczouMWZ9IGZwcykiKQogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYiRXJyb3IgdGVzdGluZyBjYW1lcmEge2luZGV4fToge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgIGZpbmFsbHk6CiAgICAgICAgY2FwLnJlbGVhc2UoKQogICAgICAgIGN2Mi5kZXN0cm95QWxsV2luZG93cygpCgo=''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/camera_utils.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/camera_utils.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… camera_utils.py creado')

# storage_v2.py
print('ðŸ“¤ Creando storage_v2.py...')
data_chunks = [
    '''IiIiClN0b3JhZ2UgdXRpbGl0aWVzIGZvciAxVVAgLSBWMgpHZW5lcmF0ZXMgY3JvcHMgQUZURVIgQ2xhdWRlIGFuYWx5c2lzIChvbmx5IGZvciB1c2VmdWwgb2JqZWN0cykuClRoaXMgZWxpbWluYXRlcyB0aGUgbWFwcGluZyBwcm9ibGVtOiBuPTEgYWx3YXlzIGNvcnJlc3BvbmRzIHRvIG9ial8wMDEuanBnCk1heCAzNTAgbGluZXMuCiIiIgppbXBvcnQgY3YyCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmltcG9ydCBudW1weSBhcyBucApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIEFueSwgT3B0aW9uYWwKCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKCmRlZiBzYXZlX2Nyb3BzX2Zvcl91c2VmdWxfb2JqZWN0cygKICAgIGltYWdlOiBucC5uZGFycmF5LAogICAgYW5hbHlzZXM6IExpc3RbRGljdFtzdHIsIEFueV1dLAogICAgdXNlZnVsX29iamVjdHM6IExpc3RbRGljdFtzdHIsIEFueV1dLAogICAgb3V0cHV0X2Rpcjogc3RyLAogICAgdGltZXN0YW1wOiBzdHIsCiAgICBwcmVmaXg6IHN0ciA9ICJvYmoiCikgLT4gRGljdFtpbnQsIHN0cl06CiAgICAiIiIKICAgIEdlbmVyYXRlIGNyb3BzIE9OTFkgZm9yIHVzZWZ1bCBvYmplY3RzIEFGVEVSIENsYXVkZSBhbmFseXNpcy4KICAgIAogICAgVGhpcyBlbGltaW5hdGVzIG1hcHBpbmcgaXNzdWVzOiBuPTEg4oaSIG9ial8wMDEuanBnIChhbHdheXMgbWF0Y2hlcykuCiAgICAKICAgIEFyZ3M6CiAgICAgICAgaW1hZ2U6IEZ1bGwgc2NlbmUgaW1hZ2UgKEJHUikKICAgICAgICBhbmFseXNlczogTGlzdCBvZiBDbGF1ZGUgYW5hbHlzZXMgKGVhY2ggaGFzICduJyBmaWVsZCwgMS1pbmRleGVkLCBSRU5VTUJFUkVEIGNvbnNlY3V0aXZlbHkpCiAgICAgICAgdXNlZnVsX29iamVjdHM6IExpc3Qgb2YgdXNlZnVsIG9iamVjdHMgKGVhY2ggaGFzICdkZXRlY3Rpb24nIGFuZCAnZmlsdGVyZWRfaW5kZXgnKQogICAgICAgIG91dHB1dF9kaXI6IERpcmVjdG9yeSB0byBzYXZlIGNyb3BzCiAgICAgICAgdGltZXN0YW1wOiBTY2VuZSB0aW1lc3RhbXAgZm9yIGRpcmVjdG9yeSBuYW1pbmcKICAgICAgICBwcmVmaXg6IFByZWZpeCBmb3IgY3JvcCBmaWxlbmFtZXMgKGRlZmF1bHQ6ICJvYmoiKQogICAgICAgIAogICAgUmV0dXJuczoKICAgICAgICBEaWN0aW9uYXJ5IG1hcHBpbmcgbiAoMS1pbmRleGVkLCByZW51bWJlcmVkKSB0byBjcm9wX3BhdGgKICAgICIiIgogICAgY3JvcF9kaXIgPSBQYXRoKG91dHB1dF9kaXIpIC8gdGltZXN0YW1wCiAgICBjcm9wX2Rpci5ta2RpcihwYXJlbnRzPVRydWUsIGV4aXN0X29rPVRydWUpCiAgICAKICAgIG5fdG9fY3JvcCA9IHt9ICAjIG4gKDEtaW5kZXhlZCwgcmVudW1iZXJlZCkg4oaSIGNyb3BfcGF0aAogICAgcGFkZGluZyA9IDMwICAjIFNhbWUgcGFkZGluZyBhcyBiZWZvcmUKICAgIAogICAgIyBDUklUSUNBTDogVXNlIGJib3hlcyBkaXJlY3RseSBmcm9tIENsYXVkZSdzIGFuYWx5c2VzIChub3QgZnJvbSBTQU0gZGV0ZWN0aW9ucykKICAgICMgQ2xhdWRlIHByb3ZpZGVzIHByZWNpc2UgYmJveGVzIGZvciBzZW1hbnRpYyBvYmplY3RzLCBTQU0gb25seSBwcm92aWRlcyByZWdpb24gYmJveGVzCiAgICBpbWFnZV9oZWlnaHQsIGltYWdlX3dpZHRoID0gaW1hZ2Uuc2hhcGVbOjJdCiAgICAKICAgICMgQ1JJVElDQUwgRklYOiBVc2UgYW5hbHlzaXNbJ24nXSB0byBtYXAgZGlyZWN0bHkgdG8gdXNlZnVsX29iamVjdHMsIG5vdCBpbmRleCBpCiAgICAjIFRoaXMgZW5zdXJlcyBjb3JyZWN0IG1hcHBpbmcgZXZlbiBpZiBzb21lIG9iamVjdHMgYXJlIHNraXBwZWQKICAgIGZvciBpLCBhbmFseXNpcyBpbiBlbnVtZXJhdGUoYW5hbHlzZXMpOgogICAgICAgIG4gPSBhbmFseXNpcy5nZXQoJ24nLCAwKSAgIyBUaGlzIGlzIHRoZSByZW51bWJlcmVkIG4gKDEsIDIsIDMsIDQuLi4pCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBuIGlzIGluIHZhbGlkIHJhbmdlCiAgICAgICAgaWYgbiA8IDE6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICDimqDvuI8gIEludmFsaWQgbj17bn0sIHNraXBwaW5nIikKICAgICAgICAgICAgY29udGludWUKICAgICAgICAKICAgICAgICAjIENSSVRJQ0FMOiBHZXQgYmJveCBmcm9tIENsYXVkZSBmaXJzdCwgZmFsbGJhY2sgdG8gU0FNIGRldGVjdGlvbiBpZiBtaXNzaW5nCiAgICAgICAgIyBDbGF1ZGUgcHJvdmlkZXMgc2VtYW50aWMgb2JqZWN0IGJib3hlcyAobW9yZSBhY2N1cmF0ZSksIGJ1dCBTQU0gYmJveCBpcyBhbHdheXMgYXZhaWxhYmxlCiAgICAgICAgYmJveCA9IGFuYWx5c2lzLmdldCgnYmJveCcpCiAgICAgICAgc291cmNlID0gImNsYXVkZSIKICAgICAgICAKICAgICAgICAjIEZhbGxiYWNrOiBVc2UgU0FNIGRldGVjdGlvbiBiYm94IGlmIENsYXVkZSBkaWRuJ3QgcHJvdmlkZSBvbmUKICAgICAgICBpZiBub3QgYmJveCBvciBsZW4oYmJveCkgIT0gNDoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgIOKaoO+4jyAgQW5hbHlzaXMgbj17bn0gbWlzc2luZyBDbGF1ZGUgYmJveCwgdXNpbmcgU0FNIGZhbGxiYWNrLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ1JJVElDQUwgRklYOiBVc2UgaW5kZXggaSBkaXJlY3RseSAoYW5hbHlzZXNbaV0gY29ycmVzcG9uZHMgdG8gdXNlZnVsX29iamVjdHNbaV0pCiAgICAgICAgICAgICMgU2luY2Ugd2UgcmVudW1iZXJlZCBjb25zZWN1dGl2ZWx5LCBpIHNob3VsZCBtYXRjaCB0aGUgcG9zaXRpb24gaW4gdXNlZnVsX29iamVjdHMKICAgICAgICAgICAgaWYgaSA8IGxlbih1c2VmdWxfb2JqZWN0cyk6CiAgICAgICAgICAgICAgICBvYmogPSB1c2VmdWxfb2JqZWN0c1tpXQogICAgICAgICAgICAgICAgZGV0ZWN0aW9uID0gb2JqLmdldCgnZGV0ZWN0aW9uJywge30pCiAgICAgICAgICAgICAgICBzYW1fYmJveCA9IGRldGVjdGlvbi5nZXQoJ2Jib3gnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzYW1fYmJveCBhbmQgbGVuKHNhbV9iYm94KSA9PSA0OgogICAgICAgICAgICAgICAgICAgIGJib3ggPSBzYW1fYmJveAogICAgICAgICAgICAgICAgICAgIHNvdXJjZSA9ICJzYW1fZmFsbGJhY2siCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgICAgIOKchSBVc2luZyBTQU0gYmJveCBhcyBmYWxsYmFjayBmb3Igbj17bn0gKGZyb20gdXNlZnVsX29iamVjdHNbe2l9XSkiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiIgICAgIOKdjCBObyBTQU0gYmJveCBhdmFpbGFibGUgaW4gdXNlZnVsX29iamVjdHNbe2l9XSwgc2tpcHBpbmcgbj17bn0iKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiIgIOKdjCBJbmRleCB7aX0gb3V0IG9mIHJhbmdlIGZvciB1c2VmdWxfb2JqZWN0cyAoaGFzIHtsZW4odXNlZnVsX29iamVjdHMpfSBpdGVtcyksIHNraXBwaW5nIG49e259IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgeCwgeSwgdywgaCA9IGJib3gKICAgICAgICBiYm94X2FyZWEgPSB3ICogaAogICAgICAgIAogICAgICAgICMgVmFsaWRhdGUgbWluaW11bSBhcmVhIChSRUxBWEVEOiBhbGxvdyBzbWFsbGVyIG9iamVjdHMpCiAgICAgICAgaWYgYmJveF9hcmVhIDwgMTAwOiAgIyBwaXhlbHPCsiAocmVkdWNlZCBmcm9tIDUwMCB0byBhbGxvdyBzbWFsbGVyIG9iamVjdHMpCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICDimqDvuI8gIEJib3ggdG9vIHNtYWxsIGZvciBuPXtufSAoYXJlYT17YmJveF9hcmVhfXB4wrIpLCBza2lwcGluZyIpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBiYm94IGlzIHdpdGhpbiBpbWFnZSBib3VuZHMKICAgICAgICBpZiB4IDwgMCBvciB5IDwgMCBvciB4ICsgdyA+IGltYWdlX3dpZHRoIG9yIHkgKyBoID4gaW1hZ2VfaGVpZ2h0OgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIiAg4pqg77iPICBCYm94IG91dHNpZGUgaW1hZ2UgZm9yIG49e259LCBjbGlwcGluZyIpCiAgICAgICAgICAgIHggPSBtYXgoMCwgeCkKICAgICAgICAgICAgeSA9IG1heCgwLCB5KQogICAgICAgICAgICB3ID0gbWluKHcsIGltYWdlX3dpZHRoIC0geCkKICAgICAgICAgICAgaCA9IG1pbihoLCBpbWFnZV9oZWlnaHQgLSB5KQogICAgICAgICAgICBiYm94ID0gW3gsIHksIHcsIGhdCiAgICAgICAgCiAgICAgICAgIyBWZXJpZnkgY3JvcCBkaW1lbnNpb25zIGFyZSB2YWxpZAogICAgICAgIGlmIHcgPD0gMCBvciBoIDw9IDA6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICDimqDvuI8gIEludmFsaWQgY3JvcCBkaW1lbnNpb25zIGZvciBuPXtufSwgYmJveD0oe3h9LHt5fSx7d30se2h9KSIpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgIyBBcHBseSBwYWRkaW5nCiAgICAgICAgeDEgPSBtYXgoMCwgeCAtIHBhZGRpbmcpCiAgICAgICAgeTEgPSBtYXgoMCwgeSAtIHBhZGRpbmcpCiAgICAgICAgeDIgPSBtaW4oaW1hZ2Vfd2lkdGgsIHggKyB3ICsgcGFkZGluZykKICAgICAgICB5MiA9IG1pbihpbWFnZV9oZWlnaHQsIHkgKyBoICsgcGFkZGluZykKICAgICAgICAKICAgICAgICAjIFZlcmlmeSBjcm9wIGRpbWVuc2lvbnMgYXJlIHZhbGlkCiAgICAgICAgaWYgeDIgPD0geDEgb3IgeTIgPD0geTE6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICDimqDvuI8gIEludmFsaWQgY3JvcCBkaW1lbnNpb25zIGZvciBuPXtufSwgYmJveD0oe3h9LHt5fSx7d30se2h9KSIpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgIyBFeHRyYWN0IGNyb3AKICAgICAgICBjcm9wID0gaW1hZ2VbeTE6eTIsIHgxOngyXS5jb3B5KCkKICAgICAgICAKICAgICAgICAjIFNUQU5EQVJESVpFRCBDUk9QIFNJWkU6IFRvZG9zIGxvcyBjcm9wcyB0aWVuZW4gZWwgbWlzbW8gdGFtYcOxbwogICAgICAgICMgVGFtYcOxbyBlc3TDoW5kYXI6IDUxMng1MTIgKHN1ZmljaWVudGUgcGFyYSBlLWNvbW1lcmNlLCBidWVuYSBjYWxpZGFkKQogICAgICAgIFNUQU5EQVJEX0NST1BfU0laRSA9IDUxMgogICAgICAgIAogICAgICAgIGNyb3BfaGVpZ2h0LCBjcm9wX3dpZHRoID0gY3JvcC5zaGFwZVs6Ml0KICAgICAgICAKICAgICAgICAjIENhbGN1bGF0ZSBzY2FsZSB0byBmaXQgY3JvcCBpbnRvIHN0YW5kYXJkIHNpemUgd2hpbGUgbWFpbnRhaW5pbmcgYXNwZWN0IHJhdGlvCiAgICAgICAgIyBPYmplY3Qgd2lsbCBiZSBjZW50ZXJlZCBpbiB0aGUgNTEyeDUxMiBzcXVhcmUKICAgICAgICBzY2FsZSA9IG1pbihTVEFOREFSRF9DUk9QX1NJWkUgLyBjcm9wX3dpZHRoLCBTVEFOREFSRF9DUk9QX1NJWkUgLyBjcm9wX2hlaWdodCkKICAgICAgICBuZXdfdyA9IGludChjcm9wX3dpZHRoICogc2NhbGUpCiAgICAgICAgbmV3X2ggPSBpbnQoY3JvcF9oZWlnaHQgKiBzY2FsZSkKICAgICAgICAKICAgICAgICAjIFJlc2l6ZSBjcm9wIHRvIGZpdCB3aXRoaW4gc3RhbmRhcmQgc2l6ZSAobWFpbnRhaW5zIGFzcGVjdCByYXRpbykKICAgICAgICBpZiBuZXdfdyAhPSBjcm9wX3dpZHRoIG9yIG5ld19oICE9IGNyb3BfaGVpZ2h0OgogICAgICAgICAgICBjcm9wX3Jlc2l6ZWQgPSBjdjIucmVzaXplKGNyb3AsIChuZXdfdywgbmV3X2gpLCBpbnRlcnBvbGF0aW9uPWN2Mi5JTlRFUl9DVUJJQykKICAgICAgICBlbHNlOgogICAgICAgICAgICBjcm9wX3Jlc2l6ZWQgPSBjcm9wLmNvcHkoKQogICAgICAgIAogICAgICAgICMgR2V0IGF2ZXJhZ2UgYm9yZGVyIGNvbG9yIGZvciBwYWRkaW5nIChuYXR1cmFsIGxvb2spCiAgICAgICAgYm9yZGVyX2NvbG9yID0gX2dldF9ib3JkZXJfY29sb3IoY3JvcF9yZXNpemVkKQogICAgICAgIAogICAgICAgICMgQ3JlYXRlIHN0YW5kYXJkLXNpemVkIHNxdWFyZSBjcm9wICg1MTJ4NTEyKSB3aXRoIG9iamVjdCBjZW50ZXJlZAogICAgICAgIHNxdWFyZV9jcm9wID0gbnAuZnVsbCgoU1RBTkRBUkRfQ1JPUF9TSVpFLCBTVEFOREFSRF9DUk9QX1NJWkUsIDMpLCBib3JkZXJfY29sb3IsIGR0eXBlPW5wLnVpbnQ4KQogICAgICAgIAogICAgICAgICMgQ2VudGVyIHRoZSByZXNpemVkIGNyb3AgaW4gdGhlIHNxdWFyZQogICAgICAgIHhfb2Zmc2V0ID0gKFNUQU5EQVJEX0NST1BfU0laRSAtIG5ld193KSAvLyAyCiAgICAgICAgeV9vZmZzZXQgPSAoU1RBTkRBUkRfQ1JPUF9TSVpFIC0gbmV3X2gpIC8vIDIKICAgICAgICAKICAgICAgICAjIFBsYWNlIHJlc2l6ZWQgY3JvcCBjZW50ZXJlZCBpbiBzcXVhcmUKICAgICAgICBzcXVhcmVfY3JvcFt5X29mZnNldDp5X29mZnNldCArIG5ld19oLCB4X29mZnNldDp4X29mZnNldCArIG5ld193XSA9IGNyb3BfcmVzaXplZAogICAgICAgIAogICAgICAgICMgQ3JvcCBpcyBub3cgc3RhbmRhcmRpemVkOiA1MTJ4NTEyLCBvYmplY3QgY2VudGVyZWQKICAgICAgICAKICAgICAgICAjIFZBTElEQVRJT046IENoZWNrIGNyb3AgcXVhbGl0eSB1c2luZyBtYXRoZW1hdGljYWwgbWV0cmljcwogICAgICAgIGZyb20gaW1hZ2VfcXVhbGl0eSBpbXBvcnQgdmFsaWRhdGVfY3JvcF9xdWFsaXR5LCBjYWxjdWxhdGVfc2hhcnBuZXNzX3Njb3JlCiAgICAgICAgCiAgICAgICAgY3JvcF9tZWFuID0gc3F1YXJlX2Nyb3AubWVhbigpCiAgICAgICAgY3JvcF9zdGQgPSBzcXVhcmVfY3JvcC5zdGQoKQogICAgICAgIHNvdXJjZSA9ICJjbGF1ZGUiICAjIEFsbCBjcm9wcyBub3cgdXNlIENsYXVkZSdzIGJib3hlcwogICAgICAgIAogICAgICAgICMgVmFsaWRhdGlvbiAxOiBCYXNpYyBjb250ZW50IGNoZWNrIChxdWljayByZWplY3Rpb24gb2YgZW1wdHkgY3JvcHMpCiAgICAgICAgaXNfdmFsaWRfY3JvcCA9IFRydWUKICAgICAgICB2YWxpZGF0aW9uX3dhcm5pbmdzID0gW10KICAgICAgICAKICAgICAgICAjIFJFTEFYRUQgVEhSRVNIT0xEUzogQWxsb3cgZGFyayBvYmplY3RzIChrZXR0bGViZWxsLCBibGFjayBzaG9lcywgZXRjLikKICAgICAgICAjIE9ubHkgcmVqZWN0IGlmIGNvbXBsZXRlbHkgYmxhY2sgKG1lYW4gPCA1KSBvciBjb21wbGV0ZWx5IHdoaXRlIChtZWFuID4gMjUyKQogICAgICAgIGlmIGNyb3BfbWVhbiA8IDU6CiAgICAgICAgICAgIGlzX3ZhbGlkX2Nyb3AgPSBGYWxzZQogICAgICAgICAgICB2YWxpZGF0aW9uX3dhcm5pbmdzLmFwcGVuZChmImNvbXBsZXRlbHkgYmxhY2sgKG1lYW49e2Nyb3BfbWVhbjouMWZ9KSIpCiAgICAgICAgZWxpZiBjcm9wX21lYW4gPiAyNTI6CiAgICAgICAgICAgIGlzX3ZhbGlkX2Nyb3AgPSBGYWxzZQogICAgICAgICAgICB2YWxpZGF0aW9uX3dhcm5pbmdzLmFwcGVuZChmImNvbXBsZXRlbHkgd2hpdGUgKG1lYW49e2Nyb3BfbWVhbjouMWZ9KSIpCiAgICAgICAgCiAgICAgICAgIyBSRUxBWEVEOiBPbmx5IHJlamVjdCBpZiBWRVJZIGxvdyB2YXJpYXRpb24gKHN0ZCA8IDUgPSB0cnVseSBlbXB0eSkKICAgICAgICBpZiBjcm9wX3N0ZCA8IDU6CiAgICAgICAgICAgIGlzX3ZhbGlkX2Nyb3AgPSBGYWxzZQogICAgICAgICAgICB2YWxpZGF0aW9uX3dhcm5pbmdzLmFwcGVuZChmInZlcnkgbG93IHZhcmlhdGlvbiAoc3RkPXtjcm9wX3N0ZDouMWZ9LCBsaWtlbHkgZW1wdHkpIikKICAgICAgICAKICAgICAgICBpZiBub3QgaXNfdmFsaWRfY3JvcDoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiICDinYwgbj17bn06IElOVkFMSUQgQ1JPUCAtIHsnLCAnLmpvaW4odmFsaWRhdGlvbl93YXJuaW5ncyl9IikKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiICAgICBiYm94PXtiYm94fSwgYXJlYT17YmJveF9hcmVhfXB4wrIiKQogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiIgICAgIFJFSkVDVElORyB0aGlzIGNyb3AgLSB3aWxsIG5vdCBiZSBzYXZlZCIpCiAgICAgICAgICAgIGNvbnRpbnVlICAjIFNraXAgc2F2aW5nIHRoaXMgY3JvcAogICAgICAgIAogICAgICAgICMgVmFsaWRhdGlvbiAyOiBNYXRoZW1hdGljYWwgcXVhbGl0eSBjaGVjayAoc2hhcnBuZXNzKQogICAgICAgIGNyb3Bfc2hhcnBuZXNzID0gY2FsY3VsYXRlX3NoYXJwbmVzc19zY29yZShzcXVhcmVfY3JvcCkKICAgICAgICBtaW5fY3JvcF9zaGFycG5lc3MgPSAyMC4wICAjIExvd2VyIHRocmVzaG9sZCBmb3IgY3JvcHMgKHRoZXkncmUgc21hbGxlcikKICAgICAgICAKICAgICAgICBpZiBjcm9wX3NoYXJwbmVzcyA8IG1pbl9jcm9wX3NoYXJwbmVzczoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiIgIOKaoO+4jyAgbj17bn06IENyb3AgbXV5IGJvcnJvc28gKG5pdGlkZXo9e2Nyb3Bfc2hhcnBuZXNzOi4xZn0gPCB7bWluX2Nyb3Bfc2hhcnBuZXNzOi4xZn0pIikKICAgICAgICAgICAgIyBDb250aW51ZSBhbnl3YXkgKGxvZyB3YXJuaW5nKSAtIGNyb3BzIGJsdXJyeSBtaWdodCBzdGlsbCBiZSB1c2VmdWwgZm9yIGlkZW50aWZpY2F0aW9uCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0aW9uIDM6IFNpbXBsZSBtYXRoZW1hdGljYWwgY2hlY2sgdGhhdCBiYm94IHJlZ2lvbiBtYXRjaGVzIGNyb3AKICAgICAgICAjIEV4dHJhY3QgYmJveCByZWdpb24gZnJvbSBvcmlnaW5hbCBpbWFnZSBhbmQgY29tcGFyZSB3aXRoIGNyb3AKICAgICAgICB0cnk6CiAgICAgICAgICAgIHgsIHksIHcsIGggPSBiYm94CiAgICAgICAgICAgIGltZ19oZWlnaHQsIGltZ193aWR0aCA9IGltYWdlLnNoYXBlWzoyXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBWYWxpZGF0ZSBiYm94IGlzIHdpdGhpbiBpbWFnZSBib3VuZHMKICAgICAgICAgICAgaWYgeCA+PSAwIGFuZCB5ID49IDAgYW5kIHggKyB3IDw9IGltZ193aWR0aCBhbmQgeSArIGggPD0gaW1nX2hlaWdodDoKICAgICAgICAgICAgICAgICMgRXh0cmFjdCByZWdpb24gZnJvbSBvcmlnaW5hbCAod2l0aCBwYWRkaW5nIG1hdGNoaW5nIGNyb3AgZ2VuZXJhdGlvbikKICAgICAgICAgICAgICAgIHBhZGRpbmcgPSAzMAogICAgICAgICAgICAgICAgeDEgPSBtYXgoMCwgeCAtIHBhZGRpbmcpCiAgICAgICAgICAgICAgICB5MSA9IG1heCgwLCB5IC0gcGFkZGluZykKICAgICAgICAgICAgICAgIHgyID0gbWluKGltZ193aWR0aCwgeCArIHcgKyBwYWRkaW5nKQogICAgICAgICAgICAgICAgeTIgPSBtaW4oaW1nX2hlaWdodCwgeSArIGggKyBwYWRkaW5nKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBvcmlnaW5hbF9yZWdpb24gPSBpbWFnZVt5MTp5MiwgeDE6eDJdLmNvcHkoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBvcmlnaW5hbF9yZWdpb24uc2l6ZSA+IDA6CiAgICAgICAgICAgICAgICAgICAgIyBTaW1wbGUgdmFsaWRhdGlvbjogY29tcGFyZSBoaXN0b2dyYW0gY29ycmVsYXRpb24KICAgICAgICAgICAgICAgICAgICBjcm9wX2dyYXkgPSBjdjIuY3Z0Q29sb3Ioc3F1YXJlX2Nyb3AsIGN2Mi5DT0xPUl9CR1IyR1JBWSkgaWYgbGVuKHNxdWFyZV9jcm9wLnNoYXBlKSA9PSAzIGVsc2Ugc3F1YXJlX2Nyb3AKICAgICAgICAgICAgICAgICAgICBvcmlnX2dyYXkgPSBjdjIuY3Z0Q29sb3Iob3JpZ2luYWxfcmVnaW9uLCBjdjIuQ09MT1JfQkdSMkdSQVkpIGlmIGxlbihvcmlnaW5hbF9yZWdpb24uc2hhcGUpID09IDMgZWxzZSBvcmlnaW5hbF9yZWdpb24KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFJlc2l6ZSB0byBzYW1lIHNpemUgZm9yIGNvbXBhcmlzb24KICAgICAgICAgICAgICAgICAgICBtaW5fc2l6ZSA9IG1pbihjcm9wX2dyYXkuc2hhcGVbMF0sIGNyb3BfZ3JheS5zaGFwZVsxXSwgb3JpZ19ncmF5LnNoYXBlWzBdLCBvcmlnX2dyYXkuc2hhcGVbMV0pCiAgICAgICAgICAgICAgICAgICAgaWYgbWluX3NpemUgPiA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgY3JvcF9yZXNpemVkID0gY3YyLnJlc2l6ZShjcm9wX2dyYXksIChtaW5fc2l6ZSwgbWluX3NpemUpKQogICAgICAgICAgICAgICAgICAgICAgICBvcmlnX3Jlc2l6ZWQgPSBjdjIucmVzaXplKG9yaWdfZ3JheSwgKG1pbl9zaXplLCBtaW5fc2l6ZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIENvbXBhcmUgaGlzdG9ncmFtcwogICAgICAgICAgICAgICAgICAgICAgICBoaXN0X2Nyb3AgPSBjdjIuY2FsY0hpc3QoW2Nyb3BfcmVzaXplZF0sIFswXSwgTm9uZSwgWzI1Nl0sIFswLCAyNTZdKQogICAgICAgICAgICAgICAgICAgICAgICBoaXN0X29yaWcgPSBjdjIuY2FsY0hpc3QoW29yaWdfcmVzaXplZF0sIFswXSwgTm9uZSwgWzI1Nl0sIFswLCAyNTZdKQogICAgICAgICAgICAgICAgICAgICAgICBoaXN0X2NvcnIgPSBjdjIuY29tcGFyZUhpc3QoaGlzdF9jcm9wLCBoaXN0X29yaWcsIGN2Mi5ISVNUQ01QX0NPUlJFTCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgY29ycmVsYXRpb24gaXMgdmVyeSBsb3csIGNyb3AgbWF5IG5vdCBtYXRjaCBiYm94CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhpc3RfY29yciA8IDAuNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiICDimqDvuI8gIG49e259OiBQb3NpYmxlIGRpc2NyZXBhbmNpYSB0aHVtYm5haWwtYmJveCAoY29ycmVsYWNpw7NuIGhpc3RvZ3JhbWE9e2hpc3RfY29ycjouMmZ9KSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZiJFcnJvciBlbiB2YWxpZGFjacOzbiB0aHVtYm5haWwtYmJveCBwYXJhIG49e259OiB7ZX0iKQogICAgICAgIAogICAgICAgICMgU2F2ZSBjcm9wIHdpdGggbiBhcyBmaWxlbmFtZSAobiBpcyAxLWluZGV4ZWQsIHNvIG9ial8wMDEuanBnLCBvYmpfMDAyLmpwZywgZXRjLikKICAgICAgICBjcm9wX2ZpbGVuYW1lID0gZiJ7cHJlZml4fV97bjowM2R9LmpwZyIKICAgICAgICBjcm9wX3BhdGggPSBjcm9wX2RpciAvIGNyb3BfZmlsZW5hbWUKICAgICAgICBjdjIuaW13cml0ZShzdHIoY3JvcF9wYXRoKSwgc3F1YXJlX2Nyb3AsIFtjdjIuSU1XUklURV9KUEVHX1FVQUxJVFksIDk1XSkKICAgICAgICAKICAgICAgICAjIFN0b3JlIG1hcHBpbmc6IG4g4oaSIGNyb3BfcGF0aCAocmVsYXRpdmUgdG8gcHJvamVjdCByb290KQogICAgICAgIGNyb3BfcGF0aF9yZWwgPSBmImltYWdlcy9jcm9wcy97dGltZXN0YW1wfS97Y3JvcF9maWxlbmFtZX0iCiAgICAgICAgbl90b19jcm9wW25dID0gY3JvcF9wYXRoX3JlbAogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYiICDinIUgbj17bn06IGJib3g9e2Jib3h9LCBhcmVhPXtiYm94X2FyZWF9cHjCsiwgc291cmNlPXtzb3VyY2V9LCBtZWFuPXtjcm9wX21lYW46LjFmfSwgc3RkPXtjcm9wX3N0ZDouMWZ9LCBjcm9wPXtjcm9wX2ZpbGVuYW1lfSIpCiAgICAgICAgCiAgICAgICAgaWYgY3JvcF9tZWFuIDwgMjAgb3IgY3JvcF9tZWFuID4gMjQwOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIiAgICAg4pqg77iPICBDcm9wIG1heSBiZSBib3JkZXJsaW5lIChtZWFuPXtjcm9wX21lYW46LjFmfSwgc3RkPXtjcm9wX3N0ZDouMWZ9KSIpCiAgICAKICAgIGxvZ2dlci5pbmZvKGYi4pyC77iPICBHZW5lcmF0ZWQge2xlbihuX3RvX2Nyb3ApfSBjcm9wcyBmb3IgdXNlZnVsIG9iamVjdHMiKQogICAgcmV0dXJuIG5fdG9fY3JvcAoKCmRlZiBfZ2V0X2JvcmRlcl9jb2xvcihjcm9wOiBucC5uZGFycmF5KSAtPiB0dXBsZToKICAgICIiIkdldCBhdmVyYWdlIGJvcmRlciBjb2xvciBmcm9tIGNyb3AgZWRnZXMgZm9yIG5hdHVyYWwgcGFkZGluZy4iIiIKICAgIGgsIHcgPSBjcm9wLnNoYXBlWzoyXQogICAgaWYgaCA8IDMgb3IgdyA8IDM6CiAgICAgICAgcmV0dXJuICgyNTUsIDI1NSwgMjU1KQogICAgCiAgICBib3JkZXJfcGl4ZWxzID0gbnAuY29uY2F0ZW5hdGUoWwogICAgICAgIGNyb3BbMCwgOl0ucmVzaGFwZSgtMSwgMyksCiAgICAgICAgY3JvcFstMSwgOl0ucmVzaGFwZSgtMSwgMyksCiAgICAgICAgY3JvcFs6LCAwXS5yZXNoYXBlKC0xLCAzKSwKICAgICAgICBjcm9wWzosIC0xXS5yZXNoYXBlKC0xLCAzKQogICAgXSwgYXhpcz0wKQogICAgCiAgICBhdmdfY29sb3IgPSBucC5tZWFuKGJvcmRlcl9waXhlbHMsIGF4aXM9MCkuYXN0eXBlKG5wLnVpbnQ4KQogICAgcmV0dXJuIHR1cGxlKGF2Z19jb2xvci50b2xpc3QoKSkKCg==''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/storage_v2.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/storage_v2.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… storage_v2.py creado')

# storage.py
print('ðŸ“¤ Creando storage.py...')
data_chunks = [
    '''IiIiClN0b3JhZ2UgdXRpbGl0aWVzIGZvciAxVVAKSGFuZGxlcyBzYXZpbmcgaW1hZ2VzLCBjcm9wcywgYW5kIG1ldGFkYXRhLgpQcmVwYXJlZCBmb3IgZnV0dXJlIG11bHRpLWNhbWVyYSwgbXVsdGktdXNlciwgbXVsdGktc3lzdGVtIHN1cHBvcnQuCk1heCAzNTAgbGluZXMuCiIiIgppbXBvcnQgY3YyCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmltcG9ydCBudW1weSBhcyBucApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIEFueSwgT3B0aW9uYWwKCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKCmNsYXNzIEltYWdlU3RvcmFnZToKICAgICIiIkhhbmRsZXMgc2F2aW5nIGltYWdlcyBhbmQgY3JvcHMgd2l0aCBtZXRhZGF0YS4iIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvbmZpZzogRGljdFtzdHIsIEFueV0pOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgc3RvcmFnZSB3aXRoIGNvbmZpZ3VyYXRpb24uCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY29uZmlnOiBDb25maWd1cmF0aW9uIGRpY3Qgd2l0aCBwYXRocyBhbmQgc2V0dGluZ3MKICAgICAgICAiIiIKICAgICAgICBzZWxmLmNvbmZpZyA9IGNvbmZpZwogICAgICAgIHNlbGYucmF3X2ltYWdlc19kaXIgPSBQYXRoKGNvbmZpZ1sncGF0aHMnXVsncmF3X2ltYWdlcyddKQogICAgICAgIHNlbGYuY3JvcHNfZGlyID0gUGF0aChjb25maWdbJ3BhdGhzJ11bJ2Nyb3BzJ10pCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgZGlyZWN0b3JpZXMKICAgICAgICBzZWxmLnJhd19pbWFnZXNfZGlyLm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICBzZWxmLmNyb3BzX2Rpci5ta2RpcihwYXJlbnRzPVRydWUsIGV4aXN0X29rPVRydWUpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmRlYnVnKGYiU3RvcmFnZSBpbml0aWFsaXplZDogcmF3PXtzZWxmLnJhd19pbWFnZXNfZGlyfSwgY3JvcHM9e3NlbGYuY3JvcHNfZGlyfSIpCiAgICAKICAgIGRlZiBzYXZlX3NjZW5lKAogICAgICAgIHNlbGYsCiAgICAgICAgaW1hZ2U6IGN2Mi5NYXQsCiAgICAgICAgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0sCiAgICAgICAgY2FtZXJhX2lkOiBPcHRpb25hbFtzdHJdID0gTm9uZSwKICAgICAgICB1c2VyX2lkOiBPcHRpb25hbFtzdHJdID0gTm9uZSwKICAgICAgICBzeXN0ZW1faWQ6IE9wdGlvbmFsW3N0cl0gPSBOb25lLAogICAgICAgIG1ldGFkYXRhOiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV0gPSBOb25lCiAgICApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIFNhdmUgY29tcGxldGUgc2NlbmUgd2l0aCBhbGwgY3JvcHMuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgaW1hZ2U6IEZ1bGwgc2NlbmUgaW1hZ2UKICAgICAgICAgICAgZGV0ZWN0aW9uczogTGlzdCBvZiBkZXRlY3Rpb25zCiAgICAgICAgICAgIGNhbWVyYV9pZDogQ2FtZXJhIGlkZW50aWZpZXIgKGZvciBmdXR1cmUgbXVsdGktY2FtZXJhKQogICAgICAgICAgICB1c2VyX2lkOiBVc2VyIGlkZW50aWZpZXIgKGZvciBmdXR1cmUgbXVsdGktdXNlcikKICAgICAgICAgICAgc3lzdGVtX2lkOiBTeXN0ZW0gaWRlbnRpZmllciAoZm9yIGZ1dHVyZSBtdWx0aS1zeXN0ZW0pCiAgICAgICAgICAgIG1ldGFkYXRhOiBBZGRpdGlvbmFsIG1ldGFkYXRhCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Qgd2l0aCBzYXZlZCBwYXRocyBhbmQgc2NlbmUgaW5mbwogICAgICAgICIiIgogICAgICAgICMgSVNPIDg2MDEgZm9ybWF0OiBZWVlZLU1NLUREX0hILU1NLVNTIChzb3J0YWJsZSwgcmVhZGFibGUsIGZpbGVzeXN0ZW0tc2FmZSkKICAgICAgICBub3cgPSBkYXRldGltZS5ub3coKQogICAgICAgIHRpbWVzdGFtcCA9IG5vdy5zdHJmdGltZSgnJVktJW0tJWRfJUgtJU0tJVMnKQogICAgICAgIHRpbWVzdGFtcF9pc28gPSBub3cuaXNvZm9ybWF0KCkgICMgRnVsbCBJU08gODYwMSBmb3IgbWV0YWRhdGEKICAgICAgICAKICAgICAgICAjIEJ1aWxkIHNjZW5lIElEIHdpdGggb3B0aW9uYWwgaWRlbnRpZmllcnMKICAgICAgICAjIEZvcm1hdDogW0NBTXtjYW1lcmFfaWR9X11ZWVlZLU1NLUREX0hILU1NLVNTCiAgICAgICAgc2NlbmVfcGFydHMgPSBbdGltZXN0YW1wXQogICAgICAgIGlmIGNhbWVyYV9pZDoKICAgICAgICAgICAgc2NlbmVfcGFydHMuaW5zZXJ0KDAsIGYiY2Fte2NhbWVyYV9pZH0iKQogICAgICAgIGlmIHVzZXJfaWQ6CiAgICAgICAgICAgIHNjZW5lX3BhcnRzLmluc2VydCgwLCBmInVzZXJ7dXNlcl9pZH0iKQogICAgICAgIGlmIHN5c3RlbV9pZDoKICAgICAgICAgICAgc2NlbmVfcGFydHMuaW5zZXJ0KDAsIGYic3lze3N5c3RlbV9pZH0iKQogICAgICAgIAogICAgICAgIHNjZW5lX2lkID0gIl8iLmpvaW4oc2NlbmVfcGFydHMpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5K+IFNhdmluZyBzY2VuZToge3NjZW5lX2lkfSIpCiAgICAgICAgCiAgICAgICAgIyBWZXJpZnkgaW1hZ2UgaXMgdmFsaWQKICAgICAgICBpZiBpbWFnZSBpcyBOb25lIG9yIGltYWdlLnNpemUgPT0gMDoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIkludmFsaWQgaW1hZ2U6IHNoYXBlPXtpbWFnZS5zaGFwZSBpZiBpbWFnZSBpcyBub3QgTm9uZSBlbHNlIE5vbmV9IikKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIiAg8J+TuCBJbWFnZSBzaXplOiB7aW1hZ2Uuc2hhcGVbMV19eHtpbWFnZS5zaGFwZVswXX0iKQogICAgICAgIAogICAgICAgICMgU2F2ZSByYXcgaW1hZ2UKICAgICAgICByYXdfZmlsZW5hbWUgPSBmInNjZW5lX3tzY2VuZV9pZH0uanBnIgogICAgICAgIHJhd19wYXRoID0gc2VsZi5yYXdfaW1hZ2VzX2RpciAvIHJhd19maWxlbmFtZQogICAgICAgIHN1Y2Nlc3MgPSBjdjIuaW13cml0ZShzdHIocmF3X3BhdGgpLCBpbWFnZSkKICAgICAgICBpZiBub3Qgc3VjY2VzczoKICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKGYiRmFpbGVkIHRvIHNhdmUgaW1hZ2UgdG8ge3Jhd19wYXRofSIpCiAgICAgICAgbG9nZ2VyLmluZm8oZiIgIPCfk7ggUmF3IGltYWdlOiB7cmF3X3BhdGgubmFtZX0gKHtyYXdfcGF0aC5zdGF0KCkuc3Rfc2l6ZX0gYnl0ZXMpIikKICAgICAgICAKICAgICAgICAjIFNhdmUgdmlzdWFsaXphdGlvbiAod2l0aCBjb250b3VycykKICAgICAgICB2aXNfaW1hZ2UgPSBzZWxmLl9jcmVhdGVfdmlzdWFsaXphdGlvbihpbWFnZSwgZGV0ZWN0aW9ucykKICAgICAgICB2aXNfZmlsZW5hbWUgPSBmInNjZW5lX3tzY2VuZV9pZH1fdml6LmpwZyIKICAgICAgICB2aXNfcGF0aCA9IHNlbGYucmF3X2ltYWdlc19kaXIgLyB2aXNfZmlsZW5hbWUKICAgICAgICBjdjIuaW13cml0ZShzdHIodmlzX3BhdGgpLCB2aXNfaW1hZ2UpCiAgICAgICAgbG9nZ2VyLmluZm8oZiIgIPCfk4ogVmlzdWFsaXphdGlvbjoge3Zpc19wYXRoLm5hbWV9IikKICAgICAgICAKICAgICAgICAjIE5PVEU6IENyb3BzIGFyZSBnZW5lcmF0ZWQgQUZURVIgQ2xhdWRlIGFuYWx5c2lzIChvbmx5IGZvciB1c2VmdWwgb2JqZWN0cykKICAgICAgICAjIFRoaXMgZWxpbWluYXRlcyBtYXBwaW5nIGlzc3Vlcy4gU2VlIHN0b3JhZ2VfdjIuc2F2ZV9jcm9wc19mb3JfdXNlZnVsX29iamVjdHMoKQogICAgICAgICMgRE8gTk9UIGNhbGwgX3NhdmVfY3JvcHMoKSBoZXJlIC0gaXQgd291bGQgZ2VuZXJhdGUgY3JvcHMgd2l0aCBjb3JydXB0IG9yaWdpbmFsX2luZGV4CiAgICAgICAgY3JvcF9wYXRocyA9IFtdCiAgICAgICAgbG9nZ2VyLmluZm8oZiIgIOKcgu+4jyAgQ3JvcHM6IFdpbGwgYmUgZ2VuZXJhdGVkIGFmdGVyIENsYXVkZSBhbmFseXNpcyAob25seSBmb3IgdXNlZnVsIG9iamVjdHMpIikKICAgICAgICAKICAgICAgICAjIENyZWF0ZSBzY2VuZSBtZXRhZGF0YQogICAgICAgIHNjZW5lX2RhdGEgPSB7CiAgICAgICAgICAgICdzY2VuZV9pZCc6IHNjZW5lX2lkLAogICAgICAgICAgICAndGltZXN0YW1wJzogdGltZXN0YW1wLCAgIyBIdW1hbi1yZWFkYWJsZTogWVlZWS1NTS1ERF9ISC1NTS1TUwogICAgICAgICAgICAnZGF0ZXRpbWUnOiB0aW1lc3RhbXBfaXNvLCAgIyBJU08gODYwMSBmdWxsIGZvcm1hdAogICAgICAgICAgICAnZGF0ZSc6IG5vdy5zdHJmdGltZSgnJVktJW0tJWQnKSwKICAgICAgICAgICAgJ3RpbWUnOiBub3cuc3RyZnRpbWUoJyVIOiVNOiVTJyksCiAgICAgICAgICAgICdjYW1lcmFfaWQnOiBjYW1lcmFfaWQsCiAgICAgICAgICAgICd1c2VyX2lkJzogdXNlcl9pZCwKICAgICAgICAgICAgJ3N5c3RlbV9pZCc6IHN5c3RlbV9pZCwKICAgICAgICAgICAgJ3Jhd19pbWFnZSc6IHN0cihyYXdfcGF0aCksCiAgICAgICAgICAgICd2aXN1YWxpemF0aW9uJzogc3RyKHZpc19wYXRoKSwKICAgICAgICAgICAgJ251bV9vYmplY3RzJzogbGVuKGRldGVjdGlvbnMpLAogICAgICAgICAgICAnY3JvcHMnOiBjcm9wX3BhdGhzLAogICAgICAgICAgICAnZGV0ZWN0aW9ucyc6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnaWQnOiBkZXQuZ2V0KCdpZCcsIGkpLCAgIyBVc2UgaW5kZXggYXMgZmFsbGJhY2sgaWYgJ2lkJyBpcyBtaXNzaW5nCiAgICAgICAgICAgICAgICAgICAgJ2Jib3gnOiBkZXQuZ2V0KCdiYm94JywgWzAsIDAsIDAsIDBdKSwKICAgICAgICAgICAgICAgICAgICAnY29uZmlkZW5jZSc6IGRldC5nZXQoJ2NvbmZpZGVuY2UnLCAwLjApLAogICAgICAgICAgICAgICAgICAgICdhcmVhJzogZGV0LmdldCgnYXJlYScsIDApLAogICAgICAgICAgICAgICAgICAgICdjcm9wX3BhdGgnOiBjcm9wX3BhdGhzW2ldIGlmIGkgPCBsZW4oY3JvcF9wYXRocykgZWxzZSBOb25lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgaSwgZGV0IGluIGVudW1lcmF0ZShkZXRlY3Rpb25zKQogICAgICAgICAgICBdLAogICAgICAgICAgICAnbWV0YWRhdGEnOiBtZXRhZGF0YSBvciB7fQogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIFNhdmUgc2NlbmUgbWV0YWRhdGEgSlNPTgogICAgICAgIG1ldGFkYXRhX3BhdGggPSBzZWxmLnJhd19pbWFnZXNfZGlyIC8gZiJzY2VuZV97c2NlbmVfaWR9X21ldGEuanNvbiIKICAgICAgICB3aXRoIG9wZW4obWV0YWRhdGFfcGF0aCwgJ3cnKSBhcyBmOgogICAgICAgICAgICBqc29uLmR1bXAoc2NlbmVfZGF0YSwgZiwgaW5kZW50PTIpCiAgICAgICAgbG9nZ2VyLmluZm8oZiIgIPCfk4QgTWV0YWRhdGE6IHttZXRhZGF0YV9wYXRoLm5hbWV9IikKICAgICAgICAKICAgICAgICByZXR1cm4gc2NlbmVfZGF0YQogICAgCiAgICBkZWYgX2NyZWF0ZV92aXN1YWxpemF0aW9uKAogICAgICAgIHNlbGYsCiAgICAgICAgaW1hZ2U6IGN2Mi5NYXQsCiAgICAgICAgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0KICAgICkgLT4gY3YyLk1hdDoKICAgICAgICAiIiJDcmVhdGUgdmlzdWFsaXphdGlvbiB3aXRoIGNvbnRvdXJzIChsaWtlIE1ldGEgU0FNIDMpLiIiIgogICAgICAgIGltcG9ydCBudW1weSBhcyBucAogICAgICAgIAogICAgICAgIHZpcyA9IGltYWdlLmNvcHkoKQogICAgICAgIGNvbG9ycyA9IFsKICAgICAgICAgICAgKDAsIDI1NSwgMjU1KSwgKDI1NSwgMCwgMjU1KSwgKDAsIDI1NSwgMCksICgyNTUsIDI1NSwgMCksCiAgICAgICAgICAgICgyNTUsIDAsIDApLCAoMCwgMCwgMjU1KSwgKDI1NSwgMTI4LCAwKSwgKDEyOCwgMCwgMjU1KSwKICAgICAgICAgICAgKDAsIDI1NSwgMTI4KSwgKDI1NSwgMCwgMTI4KQogICAgICAgIF0KICAgICAgICAKICAgICAgICBvdmVybGF5ID0gbnAuemVyb3NfbGlrZSh2aXMsIGR0eXBlPW5wLmZsb2F0MzIpCiAgICAgICAgCiAgICAgICAgZm9yIGksIGRldGVjdGlvbiBpbiBlbnVtZXJhdGUoZGV0ZWN0aW9uc1s6MjBdKToKICAgICAgICAgICAgbWFzayA9IGRldGVjdGlvbi5nZXQoJ21hc2snKQogICAgICAgICAgICBjb2xvciA9IGNvbG9yc1tpICUgbGVuKGNvbG9ycyldCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBtYXNrIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgaWYgbWFzay5kdHlwZSAhPSBucC51aW50ODoKICAgICAgICAgICAgICAgICAgICBtYXNrX3VpbnQ4ID0gKG1hc2sgKiAyNTUpLmFzdHlwZShucC51aW50OCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbWFza191aW50OCA9IG1hc2sKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udG91cnMsIF8gPSBjdjIuZmluZENvbnRvdXJzKG1hc2tfdWludDgsIGN2Mi5SRVRSX0VYVEVSTkFMLCBjdjIuQ0hBSU5fQVBQUk9YX1NJTVBMRSkKICAgICAgICAgICAgICAgIGN2Mi5kcmF3Q29udG91cnModmlzLCBjb250b3VycywgLTEsIGNvbG9yLCA0KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWdodGVyX2NvbG9yID0gdHVwbGUobWluKDI1NSwgaW50KGMgKiAxLjQpKSBmb3IgYyBpbiBjb2xvcikKICAgICAgICAgICAgICAgIGN2Mi5kcmF3Q29udG91cnModmlzLCBjb250b3VycywgLTEsIGxpZ2h0ZXJfY29sb3IsIDIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG92ZXJsYXlbbWFza191aW50OCA+IDBdID0gbnAuYXJyYXkoY29sb3IsIGR0eXBlPW5wLmZsb2F0MzIpICogMC4xMgogICAgICAgIAogICAgICAgICMgQXBwbHkgc2NyZWVuIGJsZW5kaW5nCiAgICAgICAgYmFzZSA9IHZpcy5hc3R5cGUobnAuZmxvYXQzMikKICAgICAgICBzY3JlZW5fcmVzdWx0ID0gMjU1IC0gKCgyNTUgLSBiYXNlKSAqICgyNTUgLSBvdmVybGF5KSAvIDI1NSkKICAgICAgICB2aXMgPSBucC5jbGlwKHNjcmVlbl9yZXN1bHQsIDAsIDI1NSkuYXN0eXBlKG5wLnVpbnQ4KQogICAgICAgIAogICAgICAgIHJldHVybiB2aXMKICAgIAogICAgZGVmIF9zYXZlX2Nyb3BzKAogICAgICAgIHNlbGYsCiAgICAgICAgaW1hZ2U6IGN2Mi5NYXQsCiAgICAgICAgZGV0ZWN0aW9uczogTGlzdFtEaWN0W3N0ciwgQW55XV0sCiAgICAgICAgc2NlbmVfaWQ6IHN0cgogICAgKSAtPiBMaXN0W3N0cl06CiAgICAgICAgIiIiCiAgICAgICAgREVQUkVDQVRFRDogQ3JvcHMgYXJlIG5vdyBnZW5lcmF0ZWQgQUZURVIgQ2xhdWRlIGFuYWx5c2lzIChvbmx5IGZvciB1c2VmdWwgb2JqZWN0cykuCiAgICAgICAgU2VlIHN0b3JhZ2VfdjIuc2F2ZV9jcm9wc19mb3JfdXNlZnVsX29iamVjdHMoKSBpbnN0ZWFkLgogICAgICAgIAogICAgICAgIFRoaXMgbWV0aG9kIGlzIGtlcHQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgYnV0IHJldHVybnMgZW1wdHkgbGlzdC4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBpbWFnZTogRnVsbCBzY2VuZSBpbWFnZQogICAgICAgICAgICBkZXRlY3Rpb25zOiBMaXN0IG9mIGRldGVjdGlvbnMKICAgICAgICAgICAgc2NlbmVfaWQ6IFNjZW5lIGlkZW50aWZpZXIKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRW1wdHkgbGlzdCAoY3JvcHMgZ2VuZXJhdGVkIGxhdGVyKQogICAgICAgICIiIgogICAgICAgICMgRE8gTk9UIGdlbmVyYXRlIGNyb3BzIGhlcmUgLSB0aGV5IHdpbGwgYmUgZ2VuZXJhdGVkIGFmdGVyIENsYXVkZSBhbmFseXNpcwogICAgICAgICMgVGhpcyBwcmV2ZW50cyBtYXBwaW5nIGlzc3VlcyB3aXRoIGNvcnJ1cHQgb3JpZ2luYWxfaW5kZXgKICAgICAgICBsb2dnZXIuZGVidWcoZiIgIOKaoO+4jyAgX3NhdmVfY3JvcHMoKSBjYWxsZWQgYnV0IGNyb3BzIHdpbGwgYmUgZ2VuZXJhdGVkIGFmdGVyIENsYXVkZSBhbmFseXNpcyIpCiAgICAgICAgcmV0dXJuIFtdCiAgICAKICAgIGRlZiBfZ2V0X2JvcmRlcl9jb2xvcihzZWxmLCBjcm9wOiBucC5uZGFycmF5KSAtPiB0dXBsZToKICAgICAgICAiIiIKICAgICAgICBHZXQgYXZlcmFnZSBib3JkZXIgY29sb3IgZnJvbSBjcm9wIGVkZ2VzIGZvciBuYXR1cmFsIHBhZGRpbmcuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgY3JvcDogSW1hZ2UgY3JvcAogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBCR1IgY29sb3IgdHVwbGUgKEIsIEcsIFIpCiAgICAgICAgIiIiCiAgICAgICAgaCwgdyA9IGNyb3Auc2hhcGVbOjJdCiAgICAgICAgaWYgaCA8IDMgb3IgdyA8IDM6CiAgICAgICAgICAgIHJldHVybiAoMjU1LCAyNTUsIDI1NSkgICMgV2hpdGUgZmFsbGJhY2sKICAgICAgICAKICAgICAgICAjIFNhbXBsZSBib3JkZXIgcGl4ZWxzICh0b3AsIGJvdHRvbSwgbGVmdCwgcmlnaHQgZWRnZXMpCiAgICAgICAgYm9yZGVyX3BpeGVscyA9IG5wLmNvbmNhdGVuYXRlKFsKICAgICAgICAgICAgY3JvcFswLCA6XS5yZXNoYXBlKC0xLCAzKSwgICMgVG9wCiAgICAgICAgICAgIGNyb3BbLTEsIDpdLnJlc2hhcGUoLTEsIDMpLCAgIyBCb3R0b20KICAgICAgICAgICAgY3JvcFs6LCAwXS5yZXNoYXBlKC0xLCAzKSwgICMgTGVmdAogICAgICAgICAgICBjcm9wWzosIC0xXS5yZXNoYXBlKC0xLCAzKSAgIyBSaWdodAogICAgICAgIF0sIGF4aXM9MCkKICAgICAgICAKICAgICAgICAjIENhbGN1bGF0ZSBhdmVyYWdlIEJHUiBjb2xvcgogICAgICAgIGF2Z19jb2xvciA9IG5wLm1lYW4oYm9yZGVyX3BpeGVscywgYXhpcz0wKS5hc3R5cGUobnAudWludDgpCiAgICAgICAgcmV0dXJuIHR1cGxlKGF2Z19jb2xvci50b2xpc3QoKSkKICAgIAogICAgZGVmIGNsZWFudXBfb2xkX3NjZW5lcygKICAgICAgICBzZWxmLAogICAgICAgIGtlZXBfZGF5czogaW50ID0gNywKICAgICAgICBrZWVwX3VzZWZ1bF9vbmx5OiBib29sID0gVHJ1ZQogICAgKSAtPiBEaWN0W3N0ciwgaW50XToKICAgICAgICAiIiIKICAgICAgICBDbGVhbiB1cCBvbGQgc2NlbmUgaW1hZ2VzIGFuZCBjcm9wcy4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBrZWVwX2RheXM6IEtlZXAgc2NlbmVzIGZyb20gbGFzdCBOIGRheXMgKGRlZmF1bHQ6IDcpCiAgICAgICAgICAgIGtlZXBfdXNlZnVsX29ubHk6IElmIFRydWUsIG9ubHkga2VlcCBjcm9wcyBmcm9tIHVzZWZ1bCBvYmplY3RzCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Qgd2l0aCBjbGVhbnVwIHN0YXRpc3RpY3MKICAgICAgICAiIiIKICAgICAgICBmcm9tIGRhdGV0aW1lIGltcG9ydCB0aW1lZGVsdGEKICAgICAgICAKICAgICAgICBjdXRvZmZfZGF0ZSA9IGRhdGV0aW1lLm5vdygpIC0gdGltZWRlbHRhKGRheXM9a2VlcF9kYXlzKQogICAgICAgIGN1dG9mZl90aW1lc3RhbXAgPSBjdXRvZmZfZGF0ZS5zdHJmdGltZSgnJVktJW0tJWQnKQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYi8J+nuSBDbGVhbmluZyB1cCBzY2VuZXMgb2xkZXIgdGhhbiB7a2VlcF9kYXlzfSBkYXlzIChiZWZvcmUge2N1dG9mZl90aW1lc3RhbXB9KS4uLiIpCiAgICAgICAgCiAgICAgICAgc3RhdHMgPSB7CiAgICAgICAgICAgICdzY2VuZXNfZGVsZXRlZCc6IDAsCiAgICAgICAgICAgICdjcm9wc19kZWxldGVkJzogMCwKICAgICAgICAgICAgJ2ltYWdlc19kZWxldGVkJzogMCwKICAgICAgICAgICAgJ2J5dGVzX2ZyZWVkJzogMAogICAgICAgIH0KICAgICAgICAKICAgICAgICAjIExvYWQgZGF0YWJhc2UgdG8gY2hlY2sgd2hpY2ggY3JvcHMgYXJlIHVzZWZ1bAogICAgICAgIHVzZWZ1bF9jcm9wcyA9IHNldCgpCiAgICAgICAgaWYga2VlcF91c2VmdWxfb25seToKICAgICAgICAgICAgZGJfcGF0aCA9IFBhdGgoc2VsZi5jb25maWdbJ3BhdGhzJ11bJ2RhdGFiYXNlJ10pCiAgICAgICAgICAgIGlmIGRiX3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGRiX3BhdGgpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgIGRiID0ganNvbi5sb2FkKGYpCiAgICAgICAgICAgICAgICAgICAgZm9yIG9iaiBpbiBkYjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3RodW1ibmFpbCcgaW4gb2JqOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlZnVsX2Nyb3BzLmFkZChQYXRoKG9ialsndGh1bWJuYWlsJ10pLm5hbWUpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJDb3VsZCBub3QgbG9hZCBkYXRhYmFzZSBmb3IgY2xlYW51cDoge2V9IikKICAgICAgICAKICAgICAgICAjIENsZWFuIHJhdyBpbWFnZXMgKHNjZW5lcykKICAgICAgICBmb3IgaW1nX3BhdGggaW4gc2VsZi5yYXdfaW1hZ2VzX2Rpci5nbG9iKCJzY2VuZV8qLmpwZyIpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEV4dHJhY3QgZGF0ZSBmcm9tIGZpbGVuYW1lOiBzY2VuZV9ZWVlZLU1NLUREX0hILU1NLVNTLmpwZwogICAgICAgICAgICAgICAgcGFydHMgPSBpbWdfcGF0aC5zdGVtLnNwbGl0KCdfJykKICAgICAgICAgICAgICAgIGlmIGxlbihwYXJ0cykgPj0gMzoKICAgICAgICAgICAgICAgICAgICBkYXRlX3N0ciA9IHBhcnRzWy0yXSAgIyBZWVlZLU1NLURECiAgICAgICAgICAgICAgICAgICAgaWYgZGF0ZV9zdHIgPCBjdXRvZmZfdGltZXN0YW1wOgogICAgICAgICAgICAgICAgICAgICAgICBzaXplID0gaW1nX3BhdGguc3RhdCgpLnN0X3NpemUKICAgICAgICAgICAgICAgICAgICAgICAgaW1nX3BhdGgudW5saW5rKCkKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNbJ2ltYWdlc19kZWxldGVkJ10gKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1snYnl0ZXNfZnJlZWQnXSArPSBzaXplCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEFsc28gZGVsZXRlIGNvcnJlc3BvbmRpbmcgdml6IGFuZCBtZXRhZGF0YQogICAgICAgICAgICAgICAgICAgICAgICB2aXpfcGF0aCA9IGltZ19wYXRoLnBhcmVudCAvIGltZ19wYXRoLm5hbWUucmVwbGFjZSgnLmpwZycsICdfdml6LmpwZycpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZpel9wYXRoLmV4aXN0cygpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IHZpel9wYXRoLnN0YXQoKS5zdF9zaXplCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXpfcGF0aC51bmxpbmsoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNbJ2J5dGVzX2ZyZWVkJ10gKz0gc2l6ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YV9wYXRoID0gaW1nX3BhdGgucGFyZW50IC8gaW1nX3BhdGgubmFtZS5yZXBsYWNlKCcuanBnJywgJ19tZXRhLmpzb24nKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBtZXRhX3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhX3BhdGgudW5saW5rKCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzWydzY2VuZXNfZGVsZXRlZCddICs9IDEKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiRXJyb3IgcHJvY2Vzc2luZyB7aW1nX3BhdGh9OiB7ZX0iKQogICAgICAgIAogICAgICAgICMgQ2xlYW4gY3JvcCBkaXJlY3RvcmllcwogICAgICAgIGZvciBjcm9wX2RpciBpbiBzZWxmLmNyb3BzX2Rpci5pdGVyZGlyKCk6CiAgICAgICAgICAgIGlmIG5vdCBjcm9wX2Rpci5pc19kaXIoKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIEV4dHJhY3QgZGF0ZSBmcm9tIGRpciBuYW1lOiBZWVlZLU1NLUREX0hILU1NLVNTIG9yIGNhbTBfWVlZWS1NTS1ERF9ISC1NTS1TUwogICAgICAgICAgICAgICAgZGlyX3BhcnRzID0gY3JvcF9kaXIubmFtZS5zcGxpdCgnXycpCiAgICAgICAgICAgICAgICBkYXRlX3N0ciA9IE5vbmUKICAgICAgICAgICAgICAgIGZvciBwYXJ0IGluIGRpcl9wYXJ0czoKICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFydCkgPT0gMTAgYW5kIHBhcnQuY291bnQoJy0nKSA9PSAyOiAgIyBZWVlZLU1NLURECiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVfc3RyID0gcGFydAogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBkYXRlX3N0ciBhbmQgZGF0ZV9zdHIgPCBjdXRvZmZfdGltZXN0YW1wOgogICAgICAgICAgICAgICAgICAgICMgRGVsZXRlIGVudGlyZSBjcm9wIGRpcmVjdG9yeQogICAgICAgICAgICAgICAgICAgIGRpcl9zaXplID0gc3VtKGYuc3RhdCgpLnN0X3NpemUgZm9yIGYgaW4gY3JvcF9kaXIucmdsb2IoJyonKSBpZiBmLmlzX2ZpbGUoKSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIElmIGtlZXBfdXNlZnVsX29ubHksIGNoZWNrIGlmIGFueSBjcm9wcyBhcmUgdXNlZnVsCiAgICAgICAgICAgICAgICAgICAgaWYga2VlcF91c2VmdWxfb25seToKICAgICAgICAgICAgICAgICAgICAgICAgaGFzX3VzZWZ1bCA9IGFueShmLm5hbWUgaW4gdXNlZnVsX2Nyb3BzIGZvciBmIGluIGNyb3BfZGlyLmdsb2IoJyouanBnJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBoYXNfdXNlZnVsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IHNodXRpbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2h1dGlsLnJtdHJlZShjcm9wX2RpcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzWydjcm9wc19kZWxldGVkJ10gKz0gbGVuKGxpc3QoY3JvcF9kaXIuZ2xvYignKi5qcGcnKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0c1snYnl0ZXNfZnJlZWQnXSArPSBkaXJfc2l6ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBzaHV0aWwKICAgICAgICAgICAgICAgICAgICAgICAgc2h1dGlsLnJtdHJlZShjcm9wX2RpcikKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNbJ2Nyb3BzX2RlbGV0ZWQnXSArPSBsZW4obGlzdChjcm9wX2Rpci5nbG9iKCcqLmpwZycpKSkKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNbJ2J5dGVzX2ZyZWVkJ10gKz0gZGlyX3NpemUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiRXJyb3IgcHJvY2Vzc2luZyB7Y3JvcF9kaXJ9OiB7ZX0iKQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIENsZWFudXAgY29tcGxldGU6IikKICAgICAgICBsb2dnZXIuaW5mbyhmIiAgIFNjZW5lcyBkZWxldGVkOiB7c3RhdHNbJ3NjZW5lc19kZWxldGVkJ119IikKICAgICAgICBsb2dnZXIuaW5mbyhmIiAgIENyb3BzIGRlbGV0ZWQ6IHtzdGF0c1snY3JvcHNfZGVsZXRlZCddfSIpCiAgICAgICAgbG9nZ2VyLmluZm8oZiIgICBJbWFnZXMgZGVsZXRlZDoge3N0YXRzWydpbWFnZXNfZGVsZXRlZCddfSIpCiAgICAgICAgbG9nZ2VyLmluZm8oZiIgICBTcGFjZSBmcmVlZDoge3N0YXRzWydieXRlc19mcmVlZCddIC8gMTAyNCAvIDEwMjQ6LjJmfSBNQiIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHN0YXRzCiAgICAKICAgIGRlZiBkZWxldGVfc2NlbmUoc2VsZiwgc2NlbmVfZGF0YTogRGljdFtzdHIsIEFueV0pIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgRGVsZXRlIGEgc3BlY2lmaWMgc2NlbmUgYW5kIGFsbCBpdHMgYXNzb2NpYXRlZCBmaWxlcy4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBzY2VuZV9kYXRhOiBEaWN0IHJldHVybmVkIGZyb20gc2F2ZV9zY2VuZSgpIHdpdGggcGF0aHMgdG8gZGVsZXRlCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIFRydWUgaWYgc3VjY2Vzc2Z1bCwgRmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZWxldGVkID0gW10KICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGVsZXRlIHJhdyBpbWFnZQogICAgICAgICAgICBpZiAncmF3X2ltYWdlJyBpbiBzY2VuZV9kYXRhOgogICAgICAgICAgICAgICAgcmF3X3BhdGggPSBQYXRoKHNjZW5lX2RhdGFbJ3Jhd19pbWFnZSddKQogICAgICAgICAgICAgICAgaWYgcmF3X3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgcmF3X3BhdGgudW5saW5rKCkKICAgICAgICAgICAgICAgICAgICBkZWxldGVkLmFwcGVuZChmInJhdzoge3Jhd19wYXRoLm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGVsZXRlIHZpc3VhbGl6YXRpb24KICAgICAgICAgICAgaWYgJ3Zpc3VhbGl6YXRpb24nIGluIHNjZW5lX2RhdGE6CiAgICAgICAgICAgICAgICB2aXNfcGF0aCA9IFBhdGgoc2NlbmVfZGF0YVsndmlzdWFsaXphdGlvbiddKQogICAgICAgICAgICAgICAgaWYgdmlzX3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgdmlzX3BhdGgudW5saW5rKCkKICAgICAgICAgICAgICAgICAgICBkZWxldGVkLmFwcGVuZChmInZpejoge3Zpc19wYXRoLm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGVsZXRlIG1ldGFkYXRhCiAgICAgICAgICAgIGlmICdyYXdfaW1hZ2UnIGluIHNjZW5lX2RhdGE6CiAgICAgICAgICAgICAgICByYXdfcGF0aCA9IFBhdGgoc2NlbmVfZGF0YVsncmF3X2ltYWdlJ10pCiAgICAgICAgICAgICAgICBtZXRhX3BhdGggPSByYXdfcGF0aC5wYXJlbnQgLyByYXdfcGF0aC5uYW1lLnJlcGxhY2UoJy5qcGcnLCAnX21ldGEuanNvbicpCiAgICAgICAgICAgICAgICBpZiBtZXRhX3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgbWV0YV9wYXRoLnVubGluaygpCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZC5hcHBlbmQoZiJtZXRhOiB7bWV0YV9wYXRoLm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRGVsZXRlIGFsbCBjcm9wcwogICAgICAgICAgICBpZiAnY3JvcHMnIGluIHNjZW5lX2RhdGEgYW5kIHNjZW5lX2RhdGFbJ2Nyb3BzJ106CiAgICAgICAgICAgICAgICBjcm9wX2RpciA9IFBhdGgoc2NlbmVfZGF0YVsnY3JvcHMnXVswXSkucGFyZW50CiAgICAgICAgICAgICAgICBpZiBjcm9wX2Rpci5leGlzdHMoKSBhbmQgY3JvcF9kaXIuaXNfZGlyKCk6CiAgICAgICAgICAgICAgICAgICAgaW1wb3J0IHNodXRpbAogICAgICAgICAgICAgICAgICAgIHNodXRpbC5ybXRyZWUoY3JvcF9kaXIpCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZC5hcHBlbmQoZiJjcm9wczoge2Nyb3BfZGlyLm5hbWV9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGRlbGV0ZWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZiLwn6e5IERlbGV0ZWQgc2NlbmUgZmlsZXM6IHsnLCAnLmpvaW4oZGVsZXRlZCl9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRW5zdXJlIGRpcmVjdG9yaWVzIHN0aWxsIGV4aXN0IChkb24ndCBkZWxldGUgdGhlIHBhcmVudCBkaXJlY3RvcmllcykKICAgICAgICAgICAgc2VsZi5yYXdfaW1hZ2VzX2Rpci5ta2RpcihwYXJlbnRzPVRydWUsIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgIHNlbGYuY3JvcHNfZGlyLm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRmFpbGVkIHRvIGRlbGV0ZSBzY2VuZToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBjcmVhdGVfZGlzcGxheV9mcmFtZSgKICAgICAgICBzZWxmLAogICAgICAgIGltYWdlOiBjdjIuTWF0LAogICAgICAgIGRldGVjdGlvbnM6IExpc3RbRGljdFtzdHIsIEFueV1dLAogICAgICAgIG9iamVjdF9hbmFseXNlczogT3B0aW9uYWxbRGljdFtpbnQsIERpY3Rbc3RyLCBBbnldXV0gPSBOb25lCiAgICApIC0+IGN2Mi5NYXQ6CiAgICAgICAgIiIiCiAgICAgICAgQ3JlYXRlIGRpc3BsYXkgZnJhbWUgd2l0aCBhdXJhcy9tYXNrcyBhbmQgbGFiZWxzIChmb3IgbGl2ZSB2aWV3KS4KICAgICAgICBTaG93cyBtYXNrcyBhcyBzZW1pLXRyYW5zcGFyZW50IG92ZXJsYXlzIHdpdGggY29sb3JlZCBhdXJhcyBmb3IgYmV0dGVyIHZpc2liaWxpdHkuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgaW1hZ2U6IE9yaWdpbmFsIGltYWdlCiAgICAgICAgICAgIGRldGVjdGlvbnM6IExpc3Qgb2YgZGV0ZWN0aW9ucwogICAgICAgICAgICBvYmplY3RfYW5hbHlzZXM6IE9wdGlvbmFsIGRpY3Qgb2YgYW5hbHlzZXMgKG9ial9pZCAtPiBhbmFseXNpcykKICAgICAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGlzcGxheSBmcmFtZSB3aXRoIG1hc2tzLCBhdXJhcywgYW5kIGxhYmVscwogICAgICAgICIiIgogICAgICAgIGltcG9ydCBudW1weSBhcyBucAogICAgICAgIAogICAgICAgIGRpc3BsYXlfZnJhbWUgPSBpbWFnZS5jb3B5KCkKICAgICAgICBjb2xvcnMgPSBbCiAgICAgICAgICAgICgwLCAyNTUsIDI1NSksICgyNTUsIDAsIDI1NSksICgwLCAyNTUsIDApLCAoMjU1LCAyNTUsIDApLAogICAgICAgICAgICAoMjU1LCAwLCAwKSwgKDAsIDAsIDI1NSksICgyNTUsIDEyOCwgMCksICgxMjgsIDAsIDI1NSksCiAgICAgICAgICAgICgwLCAyNTUsIDEyOCksICgyNTUsIDAsIDEyOCksICgxMjgsIDI1NSwgMCksICgwLCAxMjgsIDI1NSksCiAgICAgICAgICAgICgyNTUsIDEyOCwgMTI4KSwgKDEyOCwgMjU1LCAxMjgpLCAoMTI4LCAxMjgsIDI1NSkKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgb3ZlcmxheSBmb3IgbWFzayBjb2xvcmluZyAobW9yZSB2aXNpYmxlKQogICAgICAgIG92ZXJsYXkgPSBucC56ZXJvc19saWtlKGRpc3BsYXlfZnJhbWUsIGR0eXBlPW5wLmZsb2F0MzIpCiAgICAgICAgCiAgICAgICAgIyBEcmF3IG1hc2tzIHdpdGggYXVyYXMgZm9yIGJldHRlciB2aXNpYmlsaXR5CiAgICAgICAgZm9yIGksIGRldGVjdGlvbiBpbiBlbnVtZXJhdGUoZGV0ZWN0aW9uc1s6NTBdKTogICMgU2hvdyB1cCB0byA1MCBvYmplY3RzCiAgICAgICAgICAgIHgsIHksIHcsIGggPSBkZXRlY3Rpb25bJ2Jib3gnXQogICAgICAgICAgICBjb25mID0gZGV0ZWN0aW9uWydjb25maWRlbmNlJ10KICAgICAgICAgICAgbWFzayA9IGRldGVjdGlvbi5nZXQoJ21hc2snKQogICAgICAgICAgICBjb2xvciA9IGNvbG9yc1tpICUgbGVuKGNvbG9ycyldCiAgICAgICAgICAgIGNvbG9yX2JnciA9IHR1cGxlKGludChjKSBmb3IgYyBpbiBjb2xvcikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG1hc2sgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAjIENvbnZlcnQgbWFzayB0byB1aW50OCBpZiBuZWVkZWQKICAgICAgICAgICAgICAgIGlmIG1hc2suZHR5cGUgIT0gbnAudWludDg6CiAgICAgICAgICAgICAgICAgICAgaWYgbWFzay5tYXgoKSA8PSAxLjA6CiAgICAgICAgICAgICAgICAgICAgbWFza191aW50OCA9IChtYXNrICogMjU1KS5hc3R5cGUobnAudWludDgpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbWFza191aW50OCA9IG1hc2suYXN0eXBlKG5wLnVpbnQ4KQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBtYXNrX3VpbnQ4ID0gbWFzawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEVuc3VyZSBtYXNrIGlzIGJpbmFyeQogICAgICAgICAgICAgICAgaWYgbWFza191aW50OC5tYXgoKSA+IDE6CiAgICAgICAgICAgICAgICAgICAgXywgbWFza191aW50OCA9IGN2Mi50aHJlc2hvbGQobWFza191aW50OCwgMTI3LCAyNTUsIGN2Mi5USFJFU0hfQklOQVJZKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFJlc2l6ZSBtYXNrIHRvIGltYWdlIHNpemUgaWYgbmVlZGVkCiAgICAgICAgICAgICAgICBpZiBtYXNrX3VpbnQ4LnNoYXBlWzoyXSAhPSBpbWFnZS5zaGFwZVs6Ml06CiAgICAgICAgICAgICAgICAgICAgbWFza191aW50OCA9IGN2Mi5yZXNpemUobWFza191aW50OCwgKGltYWdlLnNoYXBlWzFdLCBpbWFnZS5zaGFwZVswXSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJwb2xhdGlvbj1jdjIuSU5URVJfTkVBUkVTVCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDcmVhdGUgZGlsYXRlZCBtYXNrIGZvciBhdXJhIGVmZmVjdCAoZ2xvdyBhcm91bmQgb2JqZWN0KQogICAgICAgICAgICAgICAga2VybmVsX2F1cmEgPSBjdjIuZ2V0U3RydWN0dXJpbmdFbGVtZW50KGN2Mi5NT1JQSF9FTExJUFNFLCAoMTUsIDE1KSkKICAgICAgICAgICAgICAgIG1hc2tfZGlsYXRlZCA9IGN2Mi5kaWxhdGUobWFza191aW50OCwga2VybmVsX2F1cmEsIGl0ZXJhdGlvbnM9MikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEcmF3IGF1cmEgKGRpbGF0ZWQgbWFzaywgbGlnaHRlciBjb2xvciwgbW9yZSB0cmFuc3BhcmVudCkKICAgICAgICAgICAgICAgIGF1cmFfbWFzayA9IChtYXNrX2RpbGF0ZWQgPiAwKSAmIChtYXNrX3VpbnQ4ID09IDApICAjIE9ubHkgdGhlIGF1cmEsIG5vdCB0aGUgb2JqZWN0CiAgICAgICAgICAgICAgICBvdmVybGF5W2F1cmFfbWFza10gPSBucC5hcnJheShjb2xvciwgZHR5cGU9bnAuZmxvYXQzMikgKiAwLjE1ICAjIExpZ2h0IGF1cmEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEcmF3IG1hc2sgb3ZlcmxheSAob2JqZWN0IGl0c2VsZiwgbW9yZSB2aXNpYmxlKQogICAgICAgICAgICAgICAgbWFza19ib29sID0gbWFza191aW50OCA+IDAKICAgICAgICAgICAgICAgIG92ZXJsYXlbbWFza19ib29sXSA9IG5wLmFycmF5KGNvbG9yLCBkdHlwZT1ucC5mbG9hdDMyKSAqIDAuMjUgICMgTW9yZSB2aXNpYmxlIG92ZXJsYXkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEcmF3IGNvbnRvdXJzIGZvciBjbGVhciBlZGdlcwogICAgICAgICAgICAgICAgY29udG91cnMsIF8gPSBjdjIuZmluZENvbnRvdXJzKG1hc2tfdWludDgsIGN2Mi5SRVRSX0VYVEVSTkFMLCBjdjIuQ0hBSU5fQVBQUk9YX1NJTVBMRSkKICAgICAgICAgICAgICAgIGlmIGxlbihjb250b3VycykgPiAwOgogICAgICAgICAgICAgICAgICAgICMgT3V0ZXIgY29udG91ciAod2hpdGUsIHRoaWNrKSBmb3IgdmlzaWJpbGl0eQogICAgICAgICAgICAgICAgICAgIGN2Mi5kcmF3Q29udG91cnMoZGlzcGxheV9mcmFtZSwgY29udG91cnMsIC0xLCAoMjU1LCAyNTUsIDI1NSksIDMpCiAgICAgICAgICAgICAgICAgICAgIyBJbm5lciBjb250b3VyIChjb2xvcmVkLCBtZWRpdW0pCiAgICAgICAgICAgICAgICAgICAgY3YyLmRyYXdDb250b3VycyhkaXNwbGF5X2ZyYW1lLCBjb250b3VycywgLTEsIGNvbG9yX2JnciwgMikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6IGRyYXcgcmVjdGFuZ2xlIGlmIG5vIG1hc2sgYXZhaWxhYmxlCiAgICAgICAgICAgICAgICBjdjIucmVjdGFuZ2xlKGRpc3BsYXlfZnJhbWUsICh4LCB5KSwgKHggKyB3LCB5ICsgaCksIGNvbG9yX2JnciwgNCkKICAgICAgICAgICAgICAgICMgQWRkIHNlbWktdHJhbnNwYXJlbnQgZmlsbAogICAgICAgICAgICAgICAgb3ZlcmxheVt5OnkraCwgeDp4K3ddID0gbnAuYXJyYXkoY29sb3IsIGR0eXBlPW5wLmZsb2F0MzIpICogMC4xNQogICAgICAgIAogICAgICAgICMgQXBwbHkgb3ZlcmxheSB3aXRoIGFscGhhIGJsZW5kaW5nIGZvciBiZXR0ZXIgdmlzaWJpbGl0eQogICAgICAgIGJhc2UgPSBkaXNwbGF5X2ZyYW1lLmFzdHlwZShucC5mbG9hdDMyKQogICAgICAgICMgQmxlbmQ6IHJlc3VsdCA9IGJhc2UgKiAoMSAtIGFscGhhKSArIG92ZXJsYXkgKiBhbHBoYQogICAgICAgIGFscGhhID0gMC4zNSAgIyBNb3JlIHZpc2libGUgb3ZlcmxheQogICAgICAgIGRpc3BsYXlfZnJhbWUgPSAoYmFzZSAqICgxIC0gYWxwaGEpICsgb3ZlcmxheSAqIGFscGhhKS5hc3R5cGUobnAudWludDgpCiAgICAgICAgCiAgICAgICAgIyBEcmF3IGxhYmVscyB3aXRoIGJldHRlciB2aXNpYmlsaXR5CiAgICAgICAgaWYgb2JqZWN0X2FuYWx5c2VzOgogICAgICAgICAgICBmb3IgaSwgZGV0ZWN0aW9uIGluIGVudW1lcmF0ZShkZXRlY3Rpb25zWzo1MF0pOiAgIyBTaG93IGxhYmVscyBmb3IgdXAgdG8gNTAgb2JqZWN0cwogICAgICAgICAgICAgICAgeCwgeSwgdywgaCA9IGRldGVjdGlvblsnYmJveCddCiAgICAgICAgICAgICAgICBjb2xvcl9iZ3IgPSBjb2xvcnNbaSAlIGxlbihjb2xvcnMpXQogICAgICAgICAgICAgICAgY29sb3JfdHVwbGUgPSB0dXBsZShpbnQoYykgZm9yIGMgaW4gY29sb3JfYmdyKQogICAgICAgICAgICAgICAgb2JqX2lkID0gZGV0ZWN0aW9uWydpZCddCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG9ial9pZCBpbiBvYmplY3RfYW5hbHlzZXM6CiAgICAgICAgICAgICAgICAgICAgb2JqX25hbWUgPSBvYmplY3RfYW5hbHlzZXNbb2JqX2lkXS5nZXQoJ25hbWUnLCBmJyN7aSsxfScpCiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnkgPSBvYmplY3RfYW5hbHlzZXNbb2JqX2lkXS5nZXQoJ2NhdGVnb3J5JywgJycpCiAgICAgICAgICAgICAgICAgICAgaWYgY2F0ZWdvcnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gZiIje2krMX06IHtvYmpfbmFtZVs6MjBdfSBbe2NhdGVnb3J5WzoxMF19XSIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxhYmVsID0gZiIje2krMX06IHtvYmpfbmFtZVs6MjVdfSIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgY29uZiA9IGRldGVjdGlvbi5nZXQoJ2NvbmZpZGVuY2UnLCAwKQogICAgICAgICAgICAgICAgICAgIGxhYmVsID0gZiIje2krMX0gKGNvbmY6e2NvbmY6LjJmfSkiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ2FsY3VsYXRlIHRleHQgc2l6ZSBhbmQgcG9zaXRpb24KICAgICAgICAgICAgICAgIGZvbnRfc2NhbGUgPSAwLjcgaWYgaW1hZ2Uuc2hhcGVbMF0gPiAyMDAwIGVsc2UgMC41ICAjIFNjYWxlIGZvbnQgZm9yIDRLCiAgICAgICAgICAgICAgICB0aGlja25lc3MgPSAyIGlmIGltYWdlLnNoYXBlWzBdID4gMjAwMCBlbHNlIDEKICAgICAgICAgICAgICAgICh0ZXh0X3csIHRleHRfaCksIGJhc2VsaW5lID0gY3YyLmdldFRleHRTaXplKGxhYmVsLCBjdjIuRk9OVF9IRVJTSEVZX1NJTVBMRVgsIGZvbnRfc2NhbGUsIHRoaWNrbmVzcykKICAgICAgICAgICAgICAgIGxhYmVsX3kgPSBtYXgoeSAtIDUsIHRleHRfaCArIDEwKQogICAgICAgICAgICAgICAgbGFiZWxfeCA9IG1heCh4LCAwKQogICAgICAgICAgICAgICAgbGFiZWxfdyA9IHRleHRfdyArIDEwCiAgICAgICAgICAgICAgICBsYWJlbF9oID0gdGV4dF9oICsgYmFzZWxpbmUgKyAxMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEVuc3VyZSBsYWJlbCBmaXRzIHdpdGhpbiBpbWFnZSBib3VuZHMKICAgICAgICAgICAgICAgIGlmIGxhYmVsX3ggKyBsYWJlbF93ID4gaW1hZ2Uuc2hhcGVbMV06CiAgICAgICAgICAgICAgICAgICAgbGFiZWxfeCA9IGltYWdlLnNoYXBlWzFdIC0gbGFiZWxfdyAtIDUKICAgICAgICAgICAgICAgIGlmIGxhYmVsX3kgLSBsYWJlbF9oIDwgMDoKICAgICAgICAgICAgICAgICAgICBsYWJlbF95ID0gbGFiZWxfaCArIDUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEcmF3IHNlbWktdHJhbnNwYXJlbnQgYmFja2dyb3VuZCBmb3IgbGFiZWwgKGJsYWNrIHJlY3RhbmdsZSkKICAgICAgICAgICAgICAgIGxhYmVsX2JnX3kxID0gbGFiZWxfeSAtIGxhYmVsX2gKICAgICAgICAgICAgICAgIGxhYmVsX2JnX3kyID0gbGFiZWxfeQogICAgICAgICAgICAgICAgbGFiZWxfYmdfeDEgPSBsYWJlbF94CiAgICAgICAgICAgICAgICBsYWJlbF9iZ194MiA9IGxhYmVsX3ggKyBsYWJlbF93CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChsYWJlbF9iZ195MSA+PSAwIGFuZCBsYWJlbF9iZ195MiA8PSBpbWFnZS5zaGFwZVswXSBhbmQgCiAgICAgICAgICAgICAgICAgICAgbGFiZWxfYmdfeDEgPj0gMCBhbmQgbGFiZWxfYmdfeDIgPD0gaW1hZ2Uuc2hhcGVbMV0pOgogICAgICAgICAgICAgICAgICAgIHJvaSA9IGRpc3BsYXlfZnJhbWVbbGFiZWxfYmdfeTE6bGFiZWxfYmdfeTIsIGxhYmVsX2JnX3gxOmxhYmVsX2JnX3gyXQogICAgICAgICAgICAgICAgICAgIGlmIHJvaS5zaXplID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgIyBCbGVuZCB3aXRoIGJsYWNrIGJhY2tncm91bmQgKHNlbWktdHJhbnNwYXJlbnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhX2JnID0gMC43CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2JnID0gbnAuemVyb3NfbGlrZShyb2ksIGR0eXBlPW5wLmZsb2F0MzIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2JnWzpdID0gKDAsIDAsIDApICAjIEJsYWNrIGJhY2tncm91bmQKICAgICAgICAgICAgICAgICAgICAgICAgYmxlbmRlZCA9IChyb2kuYXN0eXBlKG5wLmZsb2F0MzIpICogKDEgLSBhbHBoYV9iZykgKyBsYWJlbF9iZyAqIGFscGhhX2JnKS5hc3R5cGUobnAudWludDgpCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlfZnJhbWVbbGFiZWxfYmdfeTE6bGFiZWxfYmdfeTIsIGxhYmVsX2JnX3gxOmxhYmVsX2JnX3gyXSA9IGJsZW5kZWQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEcmF3IGxhYmVsIHRleHQgKHdoaXRlIGZvciBjb250cmFzdCwgdGhlbiBjb2xvcmVkIGJvcmRlcikKICAgICAgICAgICAgICAgIHRleHRfeCA9IGxhYmVsX3ggKyA1CiAgICAgICAgICAgICAgICB0ZXh0X3kgPSBsYWJlbF95IC0gYmFzZWxpbmUgLSA1CiAgICAgICAgICAgICAgICBpZiB0ZXh0X3ggPj0gMCBhbmQgdGV4dF95ID49IDAgYW5kIHRleHRfeCArIHRleHRfdyA8PSBpbWFnZS5zaGFwZVsxXToKICAgICAgICAgICAgICAgICAgICAjIERyYXcgY29sb3JlZCBib3JkZXIgZmlyc3QgKHRoaWNrZXIsIGZvciB2aXNpYmlsaXR5KQogICAgICAgICAgICAgICAgICAgIGN2Mi5wdXRUZXh0KGRpc3BsYXlfZnJhbWUsIGxhYmVsLCAodGV4dF94LCB0ZXh0X3kpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3YyLkZPTlRfSEVSU0hFWV9TSU1QTEVYLCBmb250X3NjYWxlLCBjb2xvcl90dXBsZSwgdGhpY2tuZXNzICsgMikKICAgICAgICAgICAgICAgICAgICAjIERyYXcgd2hpdGUgdGV4dCBvbiB0b3AgKGJldHRlciBjb250cmFzdCkKICAgICAgICAgICAgICAgICAgICBjdjIucHV0VGV4dChkaXNwbGF5X2ZyYW1lLCBsYWJlbCwgKHRleHRfeCwgdGV4dF95KSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN2Mi5GT05UX0hFUlNIRVlfU0lNUExFWCwgZm9udF9zY2FsZSwgKDI1NSwgMjU1LCAyNTUpLCB0aGlja25lc3MpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIGRpc3BsYXlfZnJhbWUKCg==''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/storage.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/storage.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… storage.py creado')

# server/api.py
print('ðŸ“¤ Creando server/api.py...')
data_chunks = [
    '''IiIiCjFVUCBTZXJ2ZXIgQVBJIC0gRmFzdEFQSSBlbmRwb2ludCBmb3IgR1BVIHByb2Nlc3NpbmcKUmVjZWl2ZXMgNEsgaW1hZ2VzLCBwcm9jZXNzZXMgd2l0aCBTQU0zICsgQ2xhdWRlLCByZXR1cm5zIHJlc3VsdHMuCk1heCAzNTAgbGluZXMuCiIiIgppbXBvcnQgYmFzZTY0CmltcG9ydCBsb2dnaW5nCmltcG9ydCBvcwppbXBvcnQgc3lzCmltcG9ydCBjdjIKaW1wb3J0IG51bXB5IGFzIG5wCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aApmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgQW55LCBMaXN0CmZyb20gZmFzdGFwaSBpbXBvcnQgRmFzdEFQSSwgSFRUUEV4Y2VwdGlvbgpmcm9tIGZhc3RhcGkubWlkZGxld2FyZS5jb3JzIGltcG9ydCBDT1JTTWlkZGxld2FyZQpmcm9tIHB5ZGFudGljIGltcG9ydCBCYXNlTW9kZWwKaW1wb3J0IHlhbWwKCiMgQWRkIHBhcmVudCBkaXJlY3RvcnkgdG8gcGF0aCBmb3IgaW1wb3J0cwpwYXJlbnRfZGlyID0gUGF0aChfX2ZpbGVfXykucGFyZW50LnBhcmVudApzeXMucGF0aC5pbnNlcnQoMCwgc3RyKHBhcmVudF9kaXIpKQoKZnJvbSBkZXRlY3RvciBpbXBvcnQgU0FNM0RldGVjdG9yCmZyb20gYW5hbHl6ZXIgaW1wb3J0IENsYXVkZUFuYWx5emVyCmZyb20gc3RvcmFnZV92MiBpbXBvcnQgc2F2ZV9jcm9wc19mb3JfdXNlZnVsX29iamVjdHMKZnJvbSBmaWx0ZXJzIGltcG9ydCBmaWx0ZXJfb2JqZWN0cwppbXBvcnQganNvbgpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQoKbG9nZ2luZy5iYXNpY0NvbmZpZygKICAgIGxldmVsPWxvZ2dpbmcuSU5GTywKICAgIGZvcm1hdD0nJShhc2N0aW1lKXMgLSAlKG5hbWUpcyAtICUobGV2ZWxuYW1lKXMgLSAlKG1lc3NhZ2UpcycKKQpsb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCmFwcCA9IEZhc3RBUEkodGl0bGU9IjFVUCBEZXRlY3Rpb24gQVBJIiwgdmVyc2lvbj0iMS4wLjAiKQoKIyBDT1JTIG1pZGRsZXdhcmUKYXBwLmFkZF9taWRkbGV3YXJlKAogICAgQ09SU01pZGRsZXdhcmUsCiAgICBhbGxvd19vcmlnaW5zPVsiKiJdLAogICAgYWxsb3dfY3JlZGVudGlhbHM9VHJ1ZSwKICAgIGFsbG93X21ldGhvZHM9WyIqIl0sCiAgICBhbGxvd19oZWFkZXJzPVsiKiJdLAopCgojIEdsb2JhbCBkZXRlY3RvciBhbmQgYW5hbHl6ZXIKZGV0ZWN0b3IgPSBOb25lCmFuYWx5emVyID0gTm9uZQpjb25maWcgPSBOb25lCgoKY2xhc3MgRGV0ZWN0aW9uUmVxdWVzdChCYXNlTW9kZWwpOgogICAgIiIiUmVxdWVzdCBtb2RlbCBmb3IgZGV0ZWN0aW9uIGVuZHBvaW50LiIiIgogICAgaW1hZ2VfYmFzZTY0OiBzdHIgICMgQmFzZTY0IGVuY29kZWQgaW1hZ2UKICAgIHRpbWVzdGFtcDogc3RyICAjIFNjZW5lIHRpbWVzdGFtcAogICAgY29uZmlnX292ZXJyaWRlOiBEaWN0W3N0ciwgQW55XSA9IHt9ICAjIE9wdGlvbmFsIGNvbmZpZyBvdmVycmlkZXMKCgpjbGFzcyBEZXRlY3Rpb25SZXNwb25zZShCYXNlTW9kZWwpOgogICAgIiIiUmVzcG9uc2UgbW9kZWwgZm9yIGRldGVjdGlvbiBlbmRwb2ludC4iIiIKICAgIHN1Y2Nlc3M6IGJvb2wKICAgIGRldGVjdGlvbnM6IExpc3RbRGljdFtzdHIsIEFueV1dCiAgICBjcm9wczogRGljdFtzdHIsIHN0cl0gICMgbiAtPiBjcm9wX3BhdGgKICAgIG1ldGFkYXRhOiBEaWN0W3N0ciwgQW55XQogICAgZXJyb3I6IHN0ciA9IE5vbmUKCgpkZWYgbG9hZF9jb25maWcoKToKICAgICIiIkxvYWQgc2VydmVyIGNvbmZpZ3VyYXRpb24uIiIiCiAgICBjb25maWdfcGF0aCA9IFBhdGgoX19maWxlX18pLnBhcmVudCAvICJjb25maWdfc2VydmVyLnlhbWwiCiAgICBpZiBjb25maWdfcGF0aC5leGlzdHMoKToKICAgICAgICB3aXRoIG9wZW4oY29uZmlnX3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgcmV0dXJuIHlhbWwuc2FmZV9sb2FkKGYpCiAgICBlbHNlOgogICAgICAgICMgRGVmYXVsdCBjb25maWcgZm9yIFJ1blBvZCBHUFUKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnc2FtMyc6IHsKICAgICAgICAgICAgICAgICdkZXZpY2UnOiAnY3VkYScsCiAgICAgICAgICAgICAgICAnZmlsdGVyaW5nJzogeydlbmFibGVkJzogRmFsc2V9LAogICAgICAgICAgICAgICAgJ2VuaGFuY2VfaW1hZ2UnOiBUcnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdjbGF1ZGUnOiB7CiAgICAgICAgICAgICAgICAnYXBpX2tleV9lbnYnOiAnQ0xBVURFX0FQSV9LRVknLAogICAgICAgICAgICAgICAgJ21vZGVsJzogJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcsCiAgICAgICAgICAgICAgICAnbWF4X3Rva2Vucyc6IDE2MDAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdzdG9yYWdlJzogewogICAgICAgICAgICAgICAgJ2Nyb3BzX2Rpcic6ICdpbWFnZXMvY3JvcHMnLAogICAgICAgICAgICAgICAgJ3Jhd19kaXInOiAnaW1hZ2VzL3JhdycKICAgICAgICAgICAgfQogICAgICAgIH0KCgpkZWYgaW5pdGlhbGl6ZV9tb2RlbHMoKToKICAgICIiIkluaXRpYWxpemUgU0FNMyBkZXRlY3RvciBhbmQgQ2xhdWRlIGFuYWx5emVyLiIiIgogICAgZ2xvYmFsIGRldGVjdG9yLCBhbmFseXplciwgY29uZmlnCiAgICAKICAgIGNvbmZpZyA9IGxvYWRfY29uZmlnKCkKICAgIGxvZ2dlci5pbmZvKCJMb2FkaW5nIGNvbmZpZ3VyYXRpb24uLi4iKQogICAgCiAgICAjIEluaXRpYWxpemUgU0FNMyBkZXRlY3RvciAoR1BVL0NVREEpCiAgICB0cnk6CiAgICAgICAgZGV2aWNlID0gY29uZmlnWydzYW0zJ10uZ2V0KCdkZXZpY2UnLCAnY3VkYScpCiAgICAgICAgbG9nZ2VyLmluZm8oZiJJbml0aWFsaXppbmcgU0FNMyBkZXRlY3RvciBvbiB7ZGV2aWNlfS4uLiIpCiAgICAgICAgZGV0ZWN0b3IgPSBTQU0zRGV0ZWN0b3IoZGV2aWNlPWRldmljZSkKICAgICAgICBsb2dnZXIuaW5mbygi4pyFIFNBTTMgZGV0ZWN0b3IgaW5pdGlhbGl6ZWQiKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBpbml0aWFsaXplIFNBTTM6IHtlfSIpCiAgICAgICAgcmFpc2UKICAgIAogICAgIyBJbml0aWFsaXplIENsYXVkZSBhbmFseXplcgogICAgYXBpX2tleSA9IG9zLmVudmlyb24uZ2V0KGNvbmZpZ1snY2xhdWRlJ11bJ2FwaV9rZXlfZW52J10pCiAgICBpZiBub3QgYXBpX2tleToKICAgICAgICBsb2dnZXIud2FybmluZygi4pqg77iPICBDbGF1ZGUgQVBJIGtleSBub3QgZm91bmQsIGFuYWx5c2lzIGRpc2FibGVkIikKICAgICAgICBhbmFseXplciA9IE5vbmUKICAgIGVsc2U6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBhbmFseXplciA9IENsYXVkZUFuYWx5emVyKAogICAgICAgICAgICAgICAgYXBpX2tleT1hcGlfa2V5LAogICAgICAgICAgICAgICAgbW9kZWw9Y29uZmlnWydjbGF1ZGUnXS5nZXQoJ21vZGVsJywgJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCcpLAogICAgICAgICAgICAgICAgbWF4X3Rva2Vucz1jb25maWdbJ2NsYXVkZSddLmdldCgnbWF4X3Rva2VucycsIDE2MDAwKQogICAgICAgICAgICApCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLinIUgQ2xhdWRlIGFuYWx5emVyIGluaXRpYWxpemVkIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBpbml0aWFsaXplIENsYXVkZToge2V9IikKICAgICAgICAgICAgYW5hbHl6ZXIgPSBOb25lCgoKQGFwcC5vbl9ldmVudCgic3RhcnR1cCIpCmFzeW5jIGRlZiBzdGFydHVwX2V2ZW50KCk6CiAgICAiIiJJbml0aWFsaXplIG1vZGVscyBvbiBzdGFydHVwLiIiIgogICAgbG9nZ2VyLmluZm8oIvCfmoAgU3RhcnRpbmcgMVVQIERldGVjdGlvbiBBUEkuLi4iKQogICAgaW5pdGlhbGl6ZV9tb2RlbHMoKQogICAgbG9nZ2VyLmluZm8oIuKchSBBUEkgcmVhZHkiKQoKCkBhcHAuZ2V0KCIvaGVhbHRoIikKYXN5bmMgZGVmIGhlYWx0aCgpOgogICAgIiIiSGVhbHRoIGNoZWNrIGVuZHBvaW50LiIiIgogICAgcmV0dXJuIHsKICAgICAgICAic3RhdHVzIjogImhlYWx0aHkiLAogICAgICAgICJkZXRlY3Rvcl9yZWFkeSI6IGRldGVjdG9yIGlzIG5vdCBOb25lLAogICAgICAgICJhbmFseXplcl9yZWFkeSI6IGFuYWx5emVyIGlzIG5vdCBOb25lCiAgICB9CgoKQGFwcC5wb3N0KCIvZGV0ZWN0IiwgcmVzcG9uc2VfbW9kZWw9RGV0ZWN0aW9uUmVzcG9uc2UpCmFzeW5jIGRlZiBkZXRlY3Rfb2JqZWN0cyhyZXF1ZXN0OiBEZXRlY3Rpb25SZXF1ZXN0KToKICAgICIiIgogICAgUHJvY2VzcyBpbWFnZSB3aXRoIFNBTTMgKyBDbGF1ZGUsIHJldHVybiBkZXRlY3Rpb25zIGFuZCBjcm9wcy4KICAgICIiIgogICAgZ2xvYmFsIGRldGVjdG9yLCBhbmFseXplciwgY29uZmlnCiAgICAKICAgIGlmIGRldGVjdG9yIGlzIE5vbmU6CiAgICAgICAgcmFpc2UgSFRUUEV4Y2VwdGlvbihzdGF0dXNfY29kZT01MDAsIGRldGFpbD0iU0FNMyBkZXRlY3RvciBub3QgaW5pdGlhbGl6ZWQiKQogICAgCiAgICB0cnk6CiAgICAgICAgIyBEZWNvZGUgYmFzZTY0IGltYWdlCiAgICAgICAgaW1hZ2VfZGF0YSA9IGJhc2U2NC5iNjRkZWNvZGUocmVxdWVzdC5pbWFnZV9iYXNlNjQpCiAgICAgICAgbnBhcnIgPSBucC5mcm9tYnVmZmVyKGltYWdlX2RhdGEsIG5wLnVpbnQ4KQogICAgICAgIGltYWdlID0gY3YyLmltZGVjb2RlKG5wYXJyLCBjdjIuSU1SRUFEX0NPTE9SKQogICAgICAgIAogICAgICAgIGlmIGltYWdlIGlzIE5vbmU6CiAgICAgICAgICAgIHJhaXNlIEhUVFBFeGNlcHRpb24oc3RhdHVzX2NvZGU9NDAwLCBkZXRhaWw9IkludmFsaWQgaW1hZ2UgZGF0YSIpCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5O4IFByb2Nlc3NpbmcgaW1hZ2U6IHtpbWFnZS5zaGFwZVsxXX14e2ltYWdlLnNoYXBlWzBdfSIpCiAgICAgICAgCiAgICAgICAgIyBSdW4gU0FNMyBkZXRlY3Rpb24KICAgICAgICBmaWx0ZXJfY29uZmlnID0gY29uZmlnWydzYW0zJ10uZ2V0KCdmaWx0ZXJpbmcnLCB7fSkKICAgICAgICBlbmhhbmNlX2ltYWdlID0gY29uZmlnWydzYW0zJ10uZ2V0KCdlbmhhbmNlX2ltYWdlJywgRmFsc2UpCiAgICAgICAgCiAgICAgICAgZGV0ZWN0aW9ucyA9IGRldGVjdG9yLmRldGVjdF9vYmplY3RzKAogICAgICAgICAgICBpbWFnZSwKICAgICAgICAgICAgYXBwbHlfZmlsdGVyaW5nPWZpbHRlcl9jb25maWcuZ2V0KCdlbmFibGVkJywgRmFsc2UpLAogICAgICAgICAgICBlbmhhbmNlX2ltYWdlPWVuaGFuY2VfaW1hZ2UsCiAgICAgICAgICAgIHRleHRfcHJvbXB0PU5vbmUKICAgICAgICApCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5SNIFNBTTMgZGV0ZWN0ZWQge2xlbihkZXRlY3Rpb25zKX0gb2JqZWN0cyIpCiAgICAgICAgCiAgICAgICAgIyBDbGF1ZGUgYW5hbHlzaXMgKGlmIGF2YWlsYWJsZSkKICAgICAgICBhbmFseXNlcyA9IFtdCiAgICAgICAgdXNlZnVsX29iamVjdHMgPSBbXQogICAgICAgIAogICAgICAgIGlmIGFuYWx5emVyIGFuZCBkZXRlY3Rpb25zOgogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIvCfpJYgQW5hbHl6aW5nIHdpdGggQ2xhdWRlLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2F2ZSB0ZW1wb3Jhcnkgc2NlbmUgaW1hZ2UgZm9yIENsYXVkZQogICAgICAgICAgICB0ZW1wX2RpciA9IFBhdGgoY29uZmlnWydzdG9yYWdlJ11bJ3Jhd19kaXInXSkKICAgICAgICAgICAgdGVtcF9kaXIubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICBzY2VuZV9wYXRoID0gdGVtcF9kaXIgLyBmInRlbXBfc2NlbmVfe3JlcXVlc3QudGltZXN0YW1wfS5qcGciCiAgICAgICAgICAgIGN2Mi5pbXdyaXRlKHN0cihzY2VuZV9wYXRoKSwgaW1hZ2UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEFuYWx5emUgd2l0aCBDbGF1ZGUKICAgICAgICAgICAgYW5hbHlzZXMgPSBhbmFseXplci5hbmFseXplX3NjZW5lX3dpdGhfYmJveGVzKAogICAgICAgICAgICAgICAgc3RyKHNjZW5lX3BhdGgpLAogICAgICAgICAgICAgICAgZGV0ZWN0aW9ucywKICAgICAgICAgICAgICAgIGxhbmd1YWdlPSJzcGFuaXNoIgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEZpbHRlciB1c2VmdWwgb2JqZWN0cwogICAgICAgICAgICB1c2VmdWxfYW5hbHlzZXMgPSBbYSBmb3IgYSBpbiBhbmFseXNlcyBpZiBhLmdldCgndXNlZnVsJykgPT0gJ3llcyddCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIENsYXVkZSBmb3VuZCB7bGVuKHVzZWZ1bF9hbmFseXNlcyl9IHVzZWZ1bCBvYmplY3RzIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQXBwbHkgcG9zdC1maWx0ZXJzCiAgICAgICAgICAgIHVzZWZ1bF9hbmFseXNlcyA9IGZpbHRlcl9vYmplY3RzKHVzZWZ1bF9hbmFseXNlcywgaW1hZ2Uuc2hhcGUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEJ1aWxkIHVzZWZ1bF9vYmplY3RzIHN0cnVjdHVyZSAobmVlZGVkIGZvciBzYXZlX2Nyb3BzX2Zvcl91c2VmdWxfb2JqZWN0cykKICAgICAgICAgICAgIyBTdHJ1Y3R1cmU6IFt7J2RldGVjdGlvbic6IHsuLi59LCAnYW5hbHlzaXMnOiB7Li4ufSwgJ24nOiAuLi59XQogICAgICAgICAgICB1c2VmdWxfb2JqZWN0cyA9IFtdCiAgICAgICAgICAgIGZvciBpLCBhbmFseXNpcyBpbiBlbnVtZXJhdGUodXNlZnVsX2FuYWx5c2VzKToKICAgICAgICAgICAgICAgIG4gPSBhbmFseXNpcy5nZXQoJ24nLCBpICsgMSkKICAgICAgICAgICAgICAgICMgRmluZCBjb3JyZXNwb25kaW5nIGRldGVjdGlvbiBieSBuICgxLWluZGV4ZWQpCiAgICAgICAgICAgICAgICBkZXRfaWR4ID0gbiAtIDEKICAgICAgICAgICAgICAgIGlmIDAgPD0gZGV0X2lkeCA8IGxlbihkZXRlY3Rpb25zKToKICAgICAgICAgICAgICAgICAgICBkZXRlY3Rpb24gPSBkZXRlY3Rpb25zW2RldF9pZHhdCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6IHVzZSBmaXJzdCBkZXRlY3Rpb24gaWYgbiBpcyBvdXQgb2YgcmFuZ2UKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyAgbj17bn0gb3V0IG9mIHJhbmdlLCB1c2luZyBmaXJzdCBkZXRlY3Rpb24iKQogICAgICAgICAgICAgICAgICAgIGRldGVjdGlvbiA9IGRldGVjdGlvbnNbMF0gaWYgZGV0ZWN0aW9ucyBlbHNlIHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVzZWZ1bF9vYmplY3RzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgJ2RldGVjdGlvbic6IGRldGVjdGlvbiwKICAgICAgICAgICAgICAgICAgICAnYW5hbHlzaXMnOiBhbmFseXNpcywKICAgICAgICAgICAgICAgICAgICAnbic6IG4sCiAgICAgICAgICAgICAgICAgICAgJ2ZpbHRlcmVkX2luZGV4JzogaQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmVudW1iZXIgYW5hbHlzZXMgY29uc2VjdXRpdmVseSAoMSwgMiwgMywgNC4uLikKICAgICAgICAgICAgYW5hbHlzZXNfZm9yX2Nyb3BzID0gW10KICAgICAgICAgICAgZm9yIG5ld19uLCBvYmogaW4gZW51bWVyYXRlKHVzZWZ1bF9vYmplY3RzLCBzdGFydD0xKToKICAgICAgICAgICAgICAgIGFuYWx5c2lzID0gb2JqWydhbmFseXNpcyddLmNvcHkoKQogICAgICAgICAgICAgICAgYW5hbHlzaXNbJ24nXSA9IG5ld19uICAjIFJlbnVtYmVyIGNvbnNlY3V0aXZlbHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBFbnN1cmUgYmJveCBpcyBwcmVzZW50CiAgICAgICAgICAgICAgICBpZiBub3QgYW5hbHlzaXMuZ2V0KCdiYm94Jykgb3IgbGVuKGFuYWx5c2lzLmdldCgnYmJveCcsIFtdKSkgIT0gNDoKICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHRvIFNBTSBkZXRlY3Rpb24gYmJveAogICAgICAgICAgICAgICAgICAgIGRldGVjdGlvbiA9IG9iai5nZXQoJ2RldGVjdGlvbicsIHt9KQogICAgICAgICAgICAgICAgICAgIHNhbV9iYm94ID0gZGV0ZWN0aW9uLmdldCgnYmJveCcpCiAgICAgICAgICAgICAgICAgICAgaWYgc2FtX2Jib3ggYW5kIGxlbihzYW1fYmJveCkgPT0gNDoKICAgICAgICAgICAgICAgICAgICAgICAgYW5hbHlzaXNbJ2Jib3gnXSA9IHNhbV9iYm94CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiLimqDvuI8gIE5vIGJib3ggYXZhaWxhYmxlIGZvciBuPXtuZXdfbn0sIHNraXBwaW5nIikKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYW5hbHlzZXNfZm9yX2Nyb3BzLmFwcGVuZChhbmFseXNpcykKICAgICAgICAgICAgICAgIG9ialsnbmV3X24nXSA9IG5ld19uCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEdlbmVyYXRlIGNyb3BzIGZvciB1c2VmdWwgb2JqZWN0cwogICAgICAgICAgICBjcm9wc19kaXIgPSBjb25maWdbJ3N0b3JhZ2UnXVsnY3JvcHNfZGlyJ10KICAgICAgICAgICAgbl90b19jcm9wID0gc2F2ZV9jcm9wc19mb3JfdXNlZnVsX29iamVjdHMoCiAgICAgICAgICAgICAgICBpbWFnZSwKICAgICAgICAgICAgICAgIGFuYWx5c2VzX2Zvcl9jcm9wcywgICMgUmVudW1iZXJlZCBhbmFseXNlcwogICAgICAgICAgICAgICAgdXNlZnVsX29iamVjdHMsICAjIEZ1bGwgc3RydWN0dXJlIHdpdGggZGV0ZWN0aW9uIGFuZCBhbmFseXNpcwogICAgICAgICAgICAgICAgY3JvcHNfZGlyLAogICAgICAgICAgICAgICAgcmVxdWVzdC50aW1lc3RhbXAKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDb252ZXJ0IGNyb3AgcGF0aHMgdG8gcmVsYXRpdmUgc3RyaW5ncwogICAgICAgICAgICBjcm9wcyA9IHtzdHIobik6IHN0cihwYXRoKSBmb3IgbiwgcGF0aCBpbiBuX3RvX2Nyb3AuaXRlbXMoKX0KICAgICAgICBlbHNlOgogICAgICAgICAgICBjcm9wcyA9IHt9CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCLimqDvuI8gIENsYXVkZSBhbmFseXplciBub3QgYXZhaWxhYmxlLCBza2lwcGluZyBhbmFseXNpcyIpCiAgICAgICAgCiAgICAgICAgIyBQcmVwYXJlIHJlc3BvbnNlIChleHRyYWN0IGFuYWx5c2VzIGZyb20gdXNlZnVsX29iamVjdHMgaWYgYXZhaWxhYmxlKQogICAgICAgIGlmIGFuYWx5emVyIGFuZCB1c2VmdWxfb2JqZWN0czoKICAgICAgICAgICAgcmVzcG9uc2VfZGV0ZWN0aW9ucyA9IFtvYmpbJ2FuYWx5c2lzJ10gZm9yIG9iaiBpbiB1c2VmdWxfb2JqZWN0c10KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXNwb25zZV9kZXRlY3Rpb25zID0gZGV0ZWN0aW9ucwogICAgICAgIAogICAgICAgICMgQ29udmVydCBudW1weSBhcnJheXMgdG8gUHl0aG9uIGxpc3RzIGZvciBKU09OIHNlcmlhbGl6YXRpb24KICAgICAgICBkZWYgY29udmVydF9udW1weShvYmopOgogICAgICAgICAgICAiIiJSZWN1cnNpdmVseSBjb252ZXJ0IG51bXB5IGFycmF5cyB0byBsaXN0cy4iIiIKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIG5wLm5kYXJyYXkpOgogICAgICAgICAgICAgICAgcmV0dXJuIG9iai50b2xpc3QoKQogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob2JqLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldHVybiB7azogY29udmVydF9udW1weSh2KSBmb3IgaywgdiBpbiBvYmouaXRlbXMoKX0KICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgICAgICByZXR1cm4gW2NvbnZlcnRfbnVtcHkoaXRlbSkgZm9yIGl0ZW0gaW4gb2JqXQogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob2JqLCAobnAuaW50ZWdlciwgbnAuZmxvYXRpbmcpKToKICAgICAgICAgICAgICAgIHJldHVybiBvYmouaXRlbSgpCiAgICAgICAgICAgIHJldHVybiBvYmoKICAgICAgICAKICAgICAgICByZXNwb25zZV9kZXRlY3Rpb25zID0gY29udmVydF9udW1weShyZXNwb25zZV9kZXRlY3Rpb25zKQogICAgICAgIAogICAgICAgICMgUHJlcGFyZSByZXNwb25zZQogICAgICAgIHJlc3BvbnNlID0gRGV0ZWN0aW9uUmVzcG9uc2UoCiAgICAgICAgICAgIHN1Y2Nlc3M9VHJ1ZSwKICAgICAgICAgICAgZGV0ZWN0aW9ucz1yZXNwb25zZV9kZXRlY3Rpb25zLAogICAgICAgICAgICBjcm9wcz1jcm9wcywKICAgICAgICAgICAgbWV0YWRhdGE9ewogICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IHJlcXVlc3QudGltZXN0YW1wLAogICAgICAgICAgICAgICAgJ2ltYWdlX3NpemUnOiBmIntpbWFnZS5zaGFwZVsxXX14e2ltYWdlLnNoYXBlWzBdfSIsCiAgICAgICAgICAgICAgICAndG90YWxfZGV0ZWN0aW9ucyc6IGxlbihkZXRlY3Rpb25zKSwKICAgICAgICAgICAgICAgICd1c2VmdWxfb2JqZWN0cyc6IGxlbih1c2VmdWxfb2JqZWN0cykgaWYgYW5hbHl6ZXIgZWxzZSBsZW4oZGV0ZWN0aW9ucykKICAgICAgICAgICAgfQogICAgICAgICkKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBEZXRlY3Rpb24gY29tcGxldGU6IHtsZW4ocmVzcG9uc2UuZGV0ZWN0aW9ucyl9IG9iamVjdHMsIHtsZW4oY3JvcHMpfSBjcm9wcyIpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYi4p2MIEVycm9yIHByb2Nlc3NpbmcgaW1hZ2U6IHtlfSIsIGV4Y19pbmZvPVRydWUpCiAgICAgICAgcmV0dXJuIERldGVjdGlvblJlc3BvbnNlKAogICAgICAgICAgICBzdWNjZXNzPUZhbHNlLAogICAgICAgICAgICBkZXRlY3Rpb25zPVtdLAogICAgICAgICAgICBjcm9wcz17fSwKICAgICAgICAgICAgbWV0YWRhdGE9e30sCiAgICAgICAgICAgIGVycm9yPXN0cihlKQogICAgICAgICkKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgaW1wb3J0IHV2aWNvcm4KICAgIHV2aWNvcm4ucnVuKGFwcCwgaG9zdD0iMC4wLjAuMCIsIHBvcnQ9ODAwMCkK''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/server/api.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/server/api.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… server/api.py creado')

# client/capture_client.py
print('ðŸ“¤ Creando client/capture_client.py...')
data_chunks = [
    '''IiIiCjFVUCBDbGllbnQgLSBDYXB0dXJlcyBmcmFtZXMgZnJvbSBSZW9saW5rIGFuZCBzZW5kcyB0byBzZXJ2ZXIKQ2xpZW50LXNpZGUgY2FwdHVyZSBvbmx5LCBwcm9jZXNzaW5nIGhhcHBlbnMgb24gc2VydmVyLgpNYXggMzUwIGxpbmVzLgoiIiIKaW1wb3J0IHN5cwppbXBvcnQgY3YyCmltcG9ydCB5YW1sCmltcG9ydCBsb2dnaW5nCmltcG9ydCBiYXNlNjQKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBudW1weSBhcyBucApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsLCBEaWN0LCBBbnkKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCiMgQWRkIHBhcmVudCBkaXJlY3RvcnkgdG8gcGF0aApzeXMucGF0aC5pbnNlcnQoMCwgc3RyKFBhdGgoX19maWxlX18pLnBhcmVudC5wYXJlbnQpKQoKZnJvbSBjYW1lcmFfdXRpbHMgaW1wb3J0IG9wZW5fY2FtZXJhCmZyb20gaW1hZ2VfcXVhbGl0eSBpbXBvcnQgY2FsY3VsYXRlX3NoYXJwbmVzc19zY29yZQppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHRpbWUKCmxvZ2dpbmcuYmFzaWNDb25maWcoCiAgICBsZXZlbD1sb2dnaW5nLklORk8sCiAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShuYW1lKXMgLSAlKGxldmVsbmFtZSlzIC0gJShtZXNzYWdlKXMnCikKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgoKY2xhc3MgQ2FwdHVyZUNsaWVudDoKICAgICIiIkNsaWVudCBmb3IgY2FwdHVyaW5nIGZyYW1lcyBhbmQgc2VuZGluZyB0byBzZXJ2ZXIuIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb25maWdfcGF0aDogc3RyID0gImNsaWVudC9jb25maWdfY2xpZW50LnlhbWwiKToKICAgICAgICAiIiJJbml0aWFsaXplIGNsaWVudCB3aXRoIGNvbmZpZ3VyYXRpb24uIiIiCiAgICAgICAgY29uZmlnX2ZpbGUgPSBQYXRoKF9fZmlsZV9fKS5wYXJlbnQucGFyZW50IC8gY29uZmlnX3BhdGgKICAgICAgICBpZiBub3QgY29uZmlnX2ZpbGUuZXhpc3RzKCk6CiAgICAgICAgICAgIHJhaXNlIEZpbGVOb3RGb3VuZEVycm9yKGYiQ29uZmlnIGZpbGUgbm90IGZvdW5kOiB7Y29uZmlnX2ZpbGV9IikKICAgICAgICAKICAgICAgICB3aXRoIG9wZW4oY29uZmlnX2ZpbGUsICdyJykgYXMgZjoKICAgICAgICAgICAgc2VsZi5jb25maWcgPSB5YW1sLnNhZmVfbG9hZChmKQogICAgICAgIAogICAgICAgIHNlbGYuc2VydmVyX3VybCA9IHNlbGYuY29uZmlnWydzZXJ2ZXInXVsndXJsJ10KICAgICAgICBzZWxmLmNhbWVyYV9zb3VyY2UgPSBzZWxmLmNvbmZpZ1snY2FtZXJhJ11bJ3NvdXJjZSddCiAgICAgICAgc2VsZi5jYW1lcmFfcmVzb2x1dGlvbiA9IHNlbGYuY29uZmlnWydjYW1lcmEnXVsncmVzb2x1dGlvbiddCiAgICAgICAgc2VsZi5jYXAgPSBOb25lCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5OhIENsaWVudCBpbml0aWFsaXplZDogc2VydmVyPXtzZWxmLnNlcnZlcl91cmx9IikKICAgIAogICAgZGVmIG9wZW5fY2FtZXJhKHNlbGYpOgogICAgICAgICIiIk9wZW4gY2FtZXJhIGNvbm5lY3Rpb24uIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIvCfk7cgT3BlbmluZyBjYW1lcmEuLi4iKQogICAgICAgIAogICAgICAgIGJhY2tlbmQgPSBjdjIuQ0FQX0FWRk9VTkRBVElPTiBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnRGFyd2luJyBlbHNlIE5vbmUKICAgICAgICBzZWxmLmNhcCA9IG9wZW5fY2FtZXJhKAogICAgICAgICAgICBzb3VyY2U9c2VsZi5jYW1lcmFfc291cmNlLAogICAgICAgICAgICByZXNvbHV0aW9uPXNlbGYuY2FtZXJhX3Jlc29sdXRpb24sCiAgICAgICAgICAgIGJ1ZmZlcl9zaXplPXNlbGYuY29uZmlnWydjYW1lcmEnXS5nZXQoJ2J1ZmZlcl9zaXplJywgMSksCiAgICAgICAgICAgIGJhY2tlbmQ9YmFja2VuZAogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBzZWxmLmNhcCBpcyBOb25lOgogICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoIkZhaWxlZCB0byBvcGVuIGNhbWVyYSIpCiAgICAgICAgCiAgICAgICAgYWN0dWFsX3cgPSBpbnQoc2VsZi5jYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9XSURUSCkpCiAgICAgICAgYWN0dWFsX2ggPSBpbnQoc2VsZi5jYXAuZ2V0KGN2Mi5DQVBfUFJPUF9GUkFNRV9IRUlHSFQpKQogICAgICAgIGxvZ2dlci5pbmZvKGYi4pyFIENhbWVyYSBvcGVuZWQ6IHthY3R1YWxfd314e2FjdHVhbF9ofSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIFRydWUKICAgIAogICAgZGVmIGNhcHR1cmVfZnJhbWUoc2VsZikgLT4gT3B0aW9uYWxbbnAubmRhcnJheV06CiAgICAgICAgIiIiQ2FwdHVyZSBhIHNpbmdsZSBmcmFtZSBmcm9tIGNhbWVyYS4iIiIKICAgICAgICBpZiBzZWxmLmNhcCBpcyBOb25lOgogICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoIkNhbWVyYSBub3Qgb3BlbmVkIikKICAgICAgICAKICAgICAgICByZXQsIGZyYW1lID0gc2VsZi5jYXAucmVhZCgpCiAgICAgICAgaWYgbm90IHJldCBvciBmcmFtZSBpcyBOb25lIG9yIGZyYW1lLnNpemUgPT0gMDoKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIuKaoO+4jyAgRmFpbGVkIHRvIGNhcHR1cmUgZnJhbWUiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgICAgIHJldHVybiBmcmFtZQogICAgCiAgICBkZWYgdmFsaWRhdGVfZnJhbWUoc2VsZiwgZnJhbWU6IG5wLm5kYXJyYXkpIC0+IGJvb2w6CiAgICAgICAgIiIiVmFsaWRhdGUgZnJhbWUgcXVhbGl0eS4iIiIKICAgICAgICBxdWFsaXR5X2NvbmZpZyA9IHNlbGYuY29uZmlnWydjYW1lcmEnXS5nZXQoJ3F1YWxpdHlfY2hlY2snLCB7fSkKICAgICAgICBpZiBub3QgcXVhbGl0eV9jb25maWcuZ2V0KCdlbmFibGVkJywgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICAgICAgc2hhcnBuZXNzID0gY2FsY3VsYXRlX3NoYXJwbmVzc19zY29yZShmcmFtZSkKICAgICAgICBtaW5fc2hhcnBuZXNzID0gcXVhbGl0eV9jb25maWcuZ2V0KCdtaW5fc2hhcnBuZXNzJywgMjAuMCkKICAgICAgICAKICAgICAgICBpZiBzaGFycG5lc3MgPCBtaW5fc2hhcnBuZXNzOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyAgRnJhbWUgcmVqZWN0ZWQgKHNoYXJwbmVzcz17c2hhcnBuZXNzOi4xZn0gPCB7bWluX3NoYXJwbmVzc30pIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgcmV0dXJuIFRydWUKICAgIAogICAgZGVmIGVuY29kZV9pbWFnZShzZWxmLCBpbWFnZTogbnAubmRhcnJheSkgLT4gc3RyOgogICAgICAgICIiIkVuY29kZSBpbWFnZSBhcyBiYXNlNjQgc3RyaW5nLiIiIgogICAgICAgIF8sIGJ1ZmZlciA9IGN2Mi5pbWVuY29kZSgnLmpwZycsIGltYWdlLCBbY3YyLklNV1JJVEVfSlBFR19RVUFMSVRZLCA5NV0pCiAgICAgICAgaW1hZ2VfYmFzZTY0ID0gYmFzZTY0LmI2NGVuY29kZShidWZmZXIpLmRlY29kZSgndXRmLTgnKQogICAgICAgIHJldHVybiBpbWFnZV9iYXNlNjQKICAgIAogICAgZGVmIHNlbmRfdG9fc2VydmVyKHNlbGYsIGltYWdlOiBucC5uZGFycmF5LCB0aW1lc3RhbXA6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgU2VuZCBpbWFnZSB0byBzZXJ2ZXIgZm9yIHByb2Nlc3NpbmcuCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgU2VydmVyIHJlc3BvbnNlIHdpdGggZGV0ZWN0aW9ucyBhbmQgY3JvcHMKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk6QgU2VuZGluZyBpbWFnZSB0byBzZXJ2ZXI6IHtzZWxmLnNlcnZlcl91cmx9L2RldGVjdCIpCiAgICAgICAgCiAgICAgICAgaW1hZ2VfYmFzZTY0ID0gc2VsZi5lbmNvZGVfaW1hZ2UoaW1hZ2UpCiAgICAgICAgCiAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgImltYWdlX2Jhc2U2NCI6IGltYWdlX2Jhc2U2NCwKICAgICAgICAgICAgInRpbWVzdGFtcCI6IHRpbWVzdGFtcAogICAgICAgIH0KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgIGYie3NlbGYuc2VydmVyX3VybH0vZGV0ZWN0IiwKICAgICAgICAgICAgICAgIGpzb249cGF5bG9hZCwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTIwICAjIDIgbWludXRlcyB0aW1lb3V0CiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmVzdWx0LmdldCgnc3VjY2VzcycpOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUgU2VydmVyIHJlc3BvbnNlOiB7bGVuKHJlc3VsdC5nZXQoJ2RldGVjdGlvbnMnLCBbXSkpfSBvYmplY3RzLCB7bGVuKHJlc3VsdC5nZXQoJ2Nyb3BzJywge30pKX0gY3JvcHMiKQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZXJyb3IgPSByZXN1bHQuZ2V0KCdlcnJvcicsICdVbmtub3duIGVycm9yJykKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIuKdjCBTZXJ2ZXIgZXJyb3I6IHtlcnJvcn0iKQogICAgICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKGYiU2VydmVyIHByb2Nlc3NpbmcgZmFpbGVkOiB7ZXJyb3J9IikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYi4p2MIFJlcXVlc3QgZmFpbGVkOiB7ZX0iKQogICAgICAgICAgICByYWlzZQogICAgCiAgICBkZWYgY2hlY2tfc2VydmVyX2hlYWx0aChzZWxmKSAtPiBib29sOgogICAgICAgICIiIkNoZWNrIGlmIHNlcnZlciBpcyBhdmFpbGFibGUuIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmIntzZWxmLnNlcnZlcl91cmx9L2hlYWx0aCIsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIGhlYWx0aCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSBTZXJ2ZXIgaGVhbHRoOiB7aGVhbHRofSIpCiAgICAgICAgICAgIHJldHVybiBoZWFsdGguZ2V0KCdzdGF0dXMnKSA9PSAnaGVhbHRoeScKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIuKdjCBTZXJ2ZXIgaGVhbHRoIGNoZWNrIGZhaWxlZDoge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBjbG9zZShzZWxmKToKICAgICAgICAiIiJDbG9zZSBjYW1lcmEgY29ubmVjdGlvbi4iIiIKICAgICAgICBpZiBzZWxmLmNhcCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5jYXAucmVsZWFzZSgpCiAgICAgICAgICAgIHNlbGYuY2FwID0gTm9uZQogICAgICAgICAgICBsb2dnZXIuaW5mbygi8J+TtyBDYW1lcmEgY2xvc2VkIikKCgpkZWYgbWFpbigpOgogICAgIiIiTWFpbiBjbGllbnQgbG9vcC4iIiIKICAgIGNsaWVudCA9IENhcHR1cmVDbGllbnQoKQogICAgCiAgICAjIENoZWNrIHNlcnZlciBoZWFsdGgKICAgIGlmIG5vdCBjbGllbnQuY2hlY2tfc2VydmVyX2hlYWx0aCgpOgogICAgICAgIGxvZ2dlci5lcnJvcigi4p2MIFNlcnZlciBpcyBub3QgYXZhaWxhYmxlLiBQbGVhc2Ugc3RhcnQgdGhlIHNlcnZlciBmaXJzdC4iKQogICAgICAgIHJldHVybgogICAgCiAgICAjIE9wZW4gY2FtZXJhCiAgICB0cnk6CiAgICAgICAgY2xpZW50Lm9wZW5fY2FtZXJhKCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiLinYwgRmFpbGVkIHRvIG9wZW4gY2FtZXJhOiB7ZX0iKQogICAgICAgIHJldHVybgogICAgCiAgICBsb2dnZXIuaW5mbygiXG4iICsgIj0iKjYwKQogICAgbG9nZ2VyLmluZm8oIjFVUCBDTElFTlQgLSBTZXJ2ZXIgUHJvY2Vzc2luZyBNb2RlIikKICAgIGxvZ2dlci5pbmZvKCIgIFNQQUNFID0gQ2FwdHVyZSBhbmQgc2VuZCB0byBzZXJ2ZXIiKQogICAgbG9nZ2VyLmluZm8oIiAgUSA9IFF1aXQiKQogICAgbG9nZ2VyLmluZm8oIj0iKjYwICsgIlxuIikKICAgIAogICAgdHJ5OgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICMgUmVhZCBmcmFtZSBmb3IgcHJldmlldwogICAgICAgICAgICByZXQsIGZyYW1lID0gY2xpZW50LmNhcC5yZWFkKCkKICAgICAgICAgICAgaWYgbm90IHJldDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNob3cgcHJldmlldyAocmVzaXplIGZvciBkaXNwbGF5KQogICAgICAgICAgICBwcmV2aWV3ID0gY3YyLnJlc2l6ZShmcmFtZSwgKDEyODAsIDcyMCksIGludGVycG9sYXRpb249Y3YyLklOVEVSX0xBTkNaT1M0KQogICAgICAgICAgICBjdjIuaW1zaG93KCcxVVAgQ2xpZW50IC0gU1BBQ0U9Q2FwdHVyZSwgUT1RdWl0JywgcHJldmlldykKICAgICAgICAgICAgCiAgICAgICAgICAgIGtleSA9IGN2Mi53YWl0S2V5KDEpICYgMHhGRgogICAgICAgICAgICAKICAgICAgICAgICAgaWYga2V5ID09IG9yZCgnICcpOiAgIyBTUEFDRSAtIENhcHR1cmUgYW5kIHByb2Nlc3MKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJcbvCfk7ggQ2FwdHVyaW5nIGZyYW1lLi4uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBDYXB0dXJlIGZyZXNoIGZyYW1lCiAgICAgICAgICAgICAgICBjYXB0dXJlX2ZyYW1lID0gY2xpZW50LmNhcHR1cmVfZnJhbWUoKQogICAgICAgICAgICAgICAgaWYgY2FwdHVyZV9mcmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVmFsaWRhdGUgcXVhbGl0eQogICAgICAgICAgICAgICAgaWYgbm90IGNsaWVudC52YWxpZGF0ZV9mcmFtZShjYXB0dXJlX2ZyYW1lKToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygi4pqg77iPICBGcmFtZSByZWplY3RlZCwgdHJ5IGFnYWluIikKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEdlbmVyYXRlIHRpbWVzdGFtcAogICAgICAgICAgICAgICAgdGltZXN0YW1wID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVZJW0lZF8lSCVNJVMiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFNlbmQgdG8gc2VydmVyCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY2xpZW50LnNlbmRfdG9fc2VydmVyKGNhcHR1cmVfZnJhbWUsIHRpbWVzdGFtcCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIExvZyByZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgZGV0ZWN0aW9ucyA9IHJlc3VsdC5nZXQoJ2RldGVjdGlvbnMnLCBbXSkKICAgICAgICAgICAgICAgICAgICBjcm9wcyA9IHJlc3VsdC5nZXQoJ2Nyb3BzJywge30pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJcbuKchSBQcm9jZXNzaW5nIGNvbXBsZXRlOiIpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgICBPYmplY3RzOiB7bGVuKGRldGVjdGlvbnMpfSIpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgICBDcm9wczoge2xlbihjcm9wcyl9IikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIERpc3BsYXkgZmlyc3QgZmV3IG9iamVjdHMKICAgICAgICAgICAgICAgICAgICBmb3IgaSwgb2JqIGluIGVudW1lcmF0ZShkZXRlY3Rpb25zWzo1XSk6CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBvYmouZ2V0KCduYW1lJywgJ1Vua25vd24nKQogICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeSA9IG9iai5nZXQoJ2NhdGVnb3J5JywgJ04vQScpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiICAge2krMX0uIHtuYW1lfSAoe2NhdGVnb3J5fSkiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIuKdjCBQcm9jZXNzaW5nIGZhaWxlZDoge2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYga2V5ID09IG9yZCgncScpIG9yIGtleSA9PSBvcmQoJ1EnKToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAKICAgIGZpbmFsbHk6CiAgICAgICAgY2xpZW50LmNsb3NlKCkKICAgICAgICBjdjIuZGVzdHJveUFsbFdpbmRvd3MoKQogICAgICAgIGxvZ2dlci5pbmZvKCLwn5GLIENsaWVudCBjbG9zZWQiKQoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkK''',
]
data = ''.join(data_chunks)
Path('/root/1UP_2/client/capture_client.py').parent.mkdir(parents=True, exist_ok=True)
with open('/root/1UP_2/client/capture_client.py', 'wb') as f:
    f.write(base64.b64decode(data))
print('âœ… client/capture_client.py creado')

print('')
print('âœ… Todos los archivos creados!')
print('Verifica con: ls -la ~/1UP_2/*.py')